<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>志伟&amp;博客</title>
  
  <subtitle>Zhi-wei blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="%5Bobject%20Object%5D" rel="hub"/>
  <link href="https://chiwai.tang99.club/"/>
  <updated>2020-06-21T06:26:22.505Z</updated>
  <id>https://chiwai.tang99.club/</id>
  
  <author>
    <name>志伟</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vue-element-admin 配置后台api接口baseUrl</title>
    <link href="https://chiwai.tang99.club/posts/2166331827.html"/>
    <id>https://chiwai.tang99.club/posts/2166331827.html</id>
    <published>2020-06-01T12:24:28.000Z</published>
    <updated>2020-06-21T06:26:22.505Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、配置后台api接口"><a href="#一、配置后台api接口" class="headerlink" title="一、配置后台api接口"></a>一、配置后台api接口</h2><h3 id="1-1编辑development、production、staging-文件"><a href="#1-1编辑development、production、staging-文件" class="headerlink" title="1.1编辑development、production、staging 文件"></a>1.1编辑development、production、staging 文件</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620182921.png" alt><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620183127.png" alt></p><h3 id="1-2修改vue-config-js"><a href="#1-2修改vue-config-js" class="headerlink" title="1.2修改vue.config.js"></a>1.2修改vue.config.js</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620183239.png" alt></p><p>在<span style="color:red;">devServer</span>对象下配置<span style="color:red;">proxy(没有就添加)</span>，<a href="https://cli.vuejs.org/config/#devserver-proxy" target="_blank" rel="noopener">更多配置查看</a><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620183710.png" alt></p><p>注释掉<span style="color:red;">mock-server.js</span>注入<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620183756.png" alt></p><h3 id="1-3npm-run-dev重新运行，点击登录查看是否配置生效"><a href="#1-3npm-run-dev重新运行，点击登录查看是否配置生效" class="headerlink" title="1.3npm run dev重新运行，点击登录查看是否配置生效"></a>1.3npm run dev重新运行，点击登录查看是否配置生效</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620183851.png" alt></p><h2 id="二、跨域问题服务端解决办法-Request-header-field-Authorization-is-not-allowed-by-Access-Control-Allow-Headers"><a href="#二、跨域问题服务端解决办法-Request-header-field-Authorization-is-not-allowed-by-Access-Control-Allow-Headers" class="headerlink" title="二、跨域问题服务端解决办法 Request header field Authorization is not allowed by Access-Control-Allow-Headers"></a>二、跨域问题服务端解决办法 Request header field Authorization is not allowed by Access-Control-Allow-Headers</h2><p>在项目的<span style="color:red;">入口文件</span>中，加入以下代码</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin: *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Methods:*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Headers:*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Request-Headers: *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200620230036.png" alt><br><span style="display:none;"><a href="https://blog.csdn.net/root_miss/article/details/82740399?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">https://blog.csdn.net/root_miss/article/details/82740399?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase</a></span></p><h2 id="三、CORS-跨域与-TP5中跨域的解决方法"><a href="#三、CORS-跨域与-TP5中跨域的解决方法" class="headerlink" title="三、CORS 跨域与 TP5中跨域的解决方法"></a>三、CORS 跨域与 TP5中跨域的解决方法</h2><p><span style="color:red">CORS全称是”跨域资源共享”（Cross-origin resource sharing）</span></p><p>当一个请求 url 的协议、域名、端口三者之间，任意一与当前页面地址不同即为跨域。</p><h3 id="3-1-在后台入口文件添加本页面中的第二项代码"><a href="#3-1-在后台入口文件添加本页面中的第二项代码" class="headerlink" title="3.1 在后台入口文件添加本页面中的第二项代码"></a>3.1 在后台入口文件添加本页面中的第二项代码</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200621142015.png" alt></p><h3 id="3-2-在tp5-0框架中。在-application-gt-tags-php-文件中添加如下代码："><a href="#3-2-在tp5-0框架中。在-application-gt-tags-php-文件中添加如下代码：" class="headerlink" title="3.2 在tp5.0框架中。在 application-&gt;tags.php 文件中添加如下代码："></a>3.2 在tp5.0框架中。在 application-&gt;tags.php 文件中添加如下代码：</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200621142158.png" alt><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200621142231.png" alt="添加如上代码"></p><h3 id="3-3-新建文件-application-gt-api-gt-behavior-gt-CORS-php"><a href="#3-3-新建文件-application-gt-api-gt-behavior-gt-CORS-php" class="headerlink" title="3.3 新建文件 application-&gt;api-&gt;behavior-&gt;CORS.php"></a>3.3 新建文件 application-&gt;api-&gt;behavior-&gt;CORS.php</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200621142313.png" alt><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200621142353.png" alt="添加如上代码"></p><blockquote><p>网上所说的使用：exit();使用后绝对报错，所以这里我直接请求返回200;</p></blockquote><p>参考：<a href="https://blog.csdn.net/weixin_43953710/article/details/97623897" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43953710/article/details/97623897</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="https://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Vue" scheme="https://chiwai.tang99.club/tags/Vue/"/>
    
      <category term="vue-element-admin" scheme="https://chiwai.tang99.club/tags/vue-element-admin/"/>
    
  </entry>
  
  <entry>
    <title>phpstorm线上代码同步</title>
    <link href="https://chiwai.tang99.club/posts/3455613001.html"/>
    <id>https://chiwai.tang99.club/posts/3455613001.html</id>
    <published>2020-05-24T11:48:53.000Z</published>
    <updated>2020-05-28T07:07:57.404Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="实现phpstorm与线上代码同步"><a href="#实现phpstorm与线上代码同步" class="headerlink" title="实现phpstorm与线上代码同步"></a>实现phpstorm与线上代码同步</h1><h1 id="导航栏中找到工具，Deploymnt，configuration"><a href="#导航栏中找到工具，Deploymnt，configuration" class="headerlink" title="导航栏中找到工具，Deploymnt，configuration"></a>导航栏中找到工具，Deploymnt，configuration</h1><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528145219.png" alt></p><h1 id="点击‘-’号，选择SFTP，自定义名称"><a href="#点击‘-’号，选择SFTP，自定义名称" class="headerlink" title="点击‘+’号，选择SFTP，自定义名称"></a>点击‘+’号，选择SFTP，自定义名称</h1><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528145457.png" alt></p><h1 id="设置本地需要同步的项目地址路径"><a href="#设置本地需要同步的项目地址路径" class="headerlink" title="设置本地需要同步的项目地址路径"></a>设置本地需要同步的项目地址路径</h1><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528150013.png" alt></p><h1 id="输入以下配置信息"><a href="#输入以下配置信息" class="headerlink" title="输入以下配置信息"></a>输入以下配置信息</h1><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528145753.png" alt></p><h1 id="首次代码更新"><a href="#首次代码更新" class="headerlink" title="首次代码更新"></a>首次代码更新</h1><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528150715.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="phpstorm" scheme="https://chiwai.tang99.club/categories/phpstorm/"/>
    
    
      <category term="线上代码同步" scheme="https://chiwai.tang99.club/tags/%E7%BA%BF%E4%B8%8A%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>linux安装redis</title>
    <link href="https://chiwai.tang99.club/posts/2051437431.html"/>
    <id>https://chiwai.tang99.club/posts/2051437431.html</id>
    <published>2020-05-16T07:30:53.000Z</published>
    <updated>2020-05-17T14:57:26.980Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux下载、解压redis"><a href="#Linux下载、解压redis" class="headerlink" title="Linux下载、解压redis"></a>Linux下载、解压redis</h1><p>下载地址：<a href="http://download.redis.io/releases/redis-6.0.1.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-6.0.1.tar.gz</a></p><pre class="line-numbers language-ini"><code class="language-ini">wget http://download.redis.io/releases/redis-6.0.1.tar.gz# 解压redistar -zxvf redis-6.0.1.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="编译和安装redis"><a href="#编译和安装redis" class="headerlink" title="编译和安装redis"></a>编译和安装redis</h1><h2 id="进入到解压后的redis安装源码"><a href="#进入到解压后的redis安装源码" class="headerlink" title="进入到解压后的redis安装源码"></a>进入到解压后的redis安装源码</h2><pre class="line-numbers language-ini"><code class="language-ini">cd redis-6.0.1.tar.gz# 安装到/usr/local/redismake &amp;&amp; make PREFIX<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/redis install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="安装redis报错解决"><a href="#安装redis报错解决" class="headerlink" title="安装redis报错解决"></a>安装redis报错解决</h1><p>报错信息如下：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200516201432.png" alt="错误信息"></p><p>解决方法：查看是否安装了<code>gcc</code>，如果安装了检查<code>gcc</code>的版本是否过低。</p><pre class="line-numbers language-ini"><code class="language-ini"># 查看gcc版本gcc -v# 如果没安装gcc，执行以下语句yum install gcc# 如果安装了，执行升级操作yum -y install centos-release-sclyum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutilsscl enable devtoolset-9 bash# 以上为临时启用，如果要长期使用gcc 9.1的话：echo "source /opt/rh/devtoolset-9/enable" >>/etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="再次安装redis"><a href="#再次安装redis" class="headerlink" title="再次安装redis"></a>再次安装redis</h2><pre class="line-numbers language-ini"><code class="language-ini">make &amp;&amp; make PREFIX<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/redis install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装成功：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517180254.png" alt="产生bin文件"></p><h1 id="复制配置文件到安装目录对应的文件中"><a href="#复制配置文件到安装目录对应的文件中" class="headerlink" title="复制配置文件到安装目录对应的文件中"></a>复制配置文件到安装目录对应的文件中</h1><pre class="line-numbers language-ini"><code class="language-ini"># 在redis安装目录下，创建etc文件夹mkdir usr/local/redis/etc# 下载的源码包中复制redis.conf文件到安装目录下新建的etc文件夹下cp src/redis-6.0.1/redis.conf usr/local/redis/etc/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="启动或关闭redis"><a href="#启动或关闭redis" class="headerlink" title="启动或关闭redis"></a>启动或关闭redis</h1><p>启动文件在安装目录下的bin目录下</p><pre class="line-numbers language-ini"><code class="language-ini"># 启动redis/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf# 关闭redispkill redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用redis-server命令和指定配置文件来启动<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517183816.png" alt="启动成功"></p><h1 id="以后台运行的方式来启动redis"><a href="#以后台运行的方式来启动redis" class="headerlink" title="以后台运行的方式来启动redis"></a>以后台运行的方式来启动redis</h1><p>修改redis.conf文件，将<code>daemonize no</code> 改成 <code>daemonize yes</code>。</p><pre class="line-numbers language-ini"><code class="language-ini">vi etc/redis.conf <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517184915.png" alt="修改成yes"></p><p>修改完毕后，保存退出，在重新启动redis，此时服务就是后台运行。</p><h2 id="查看redis服务是否正常"><a href="#查看redis服务是否正常" class="headerlink" title="查看redis服务是否正常"></a>查看redis服务是否正常</h2><pre class="line-numbers language-ini"><code class="language-ini"># 检查端口号netstat -tunpl|grep 6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517185520.png" alt="服务正常"></p><h1 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h1><blockquote><p>如果发现连接客户端<code>redis-cli</code>没有反应，重新启动计算机就好了</p></blockquote><pre class="line-numbers language-ini"><code class="language-ini">reboot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重启后，重新连接客户端</p><pre class="line-numbers language-ini"><code class="language-ini">./redis-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517201134.png" alt="连接成功"></p><h1 id="使用redis-desktop-manager图形化工具连接redis"><a href="#使用redis-desktop-manager图形化工具连接redis" class="headerlink" title="使用redis-desktop-manager图形化工具连接redis"></a>使用redis-desktop-manager图形化工具连接redis</h1><h2 id="下载地址："><a href="#下载地址：" class="headerlink" title="下载地址："></a>下载地址：</h2><p>链接：<a href="https://pan.baidu.com/s/10rBVrRguo4WSyNObBeWJoQ" target="_blank" rel="noopener">https://pan.baidu.com/s/10rBVrRguo4WSyNObBeWJoQ</a><br>提取码：vkpc<br>复制这段内容后打开百度网盘手机App，操作更方便哦</p><h2 id="连接测试"><a href="#连接测试" class="headerlink" title="连接测试"></a>连接测试</h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517221843.png" alt><br><span style="color:red;">最终发现连接不上。</span></p><h2 id="解决连接不上问题"><a href="#解决连接不上问题" class="headerlink" title="解决连接不上问题"></a>解决连接不上问题</h2><p>两种连接不上的问题：<br><b style="font-size:18px;">1.</b>防火墙拦截<br>解决方法：<span style="color:red;">开放6379端口</span></p><p><b style="font-size:18px;">1.1.</b>查看6379端口是否启用<span styke="color:red;">(no表示没启动)</span></p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --query-port<span class="token attr-value"><span class="token punctuation">=</span>6379/tcp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">1.2.</b>如果没开启，开启端口,并重启防火墙</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --add-port<span class="token attr-value"><span class="token punctuation">=</span>6379/tcp --permanent </span>#重启防火墙systemctl restart firewalld     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517225143.png" alt></p><p><b style="font-size:18px;">2.</b>启动服务是指定连接的IP<br>解决方法：<span style="color:red;">查看服务器端，服务绑定的网卡地址</span></p><pre class="line-numbers language-ini"><code class="language-ini">netstat -tunpl|grep 6379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最终发现绑定地址为127.0.0.1，需要修改成允许所有的网卡都能访问。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517223206.png" alt></p><p><b style="font-size:18px;">2.1.</b>修改<code>redis.conf</code>配置文件，允许所有网卡访问。</p><pre class="line-numbers language-ini"><code class="language-ini">vi redis-conf# 找到bind属性，将127.0.0.1修改成0.0.0.0bind 0.0.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517224001.png" alt></p><p><b style="font-size:18px;">2.2.</b>修改完后，干掉redis服务，然后再启动</p><pre class="line-numbers language-ini"><code class="language-ini"># 干掉pkill redis# 启动/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf# 再查看是否是0.0.0.0netstat -tunpl|grep 6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517224514.png" alt></p><p><b style="font-size:18px;">3. </b>在图形工具测试连接，连接成功！<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200517225230.png" alt="连接成功"></p><p>到这里就结束了！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="redis" scheme="https://chiwai.tang99.club/categories/redis/"/>
    
    
      <category term="redis" scheme="https://chiwai.tang99.club/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>MySQL读写分离实现</title>
    <link href="https://chiwai.tang99.club/posts/2900512620.html"/>
    <id>https://chiwai.tang99.club/posts/2900512620.html</id>
    <published>2020-05-07T13:23:05.000Z</published>
    <updated>2020-05-10T10:15:19.120Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MySQL读写分离实现"><a href="#MySQL读写分离实现" class="headerlink" title="MySQL读写分离实现"></a>MySQL读写分离实现</h1><blockquote><p>MySQL实现读写分离的前提是要先实现主从复制。<br>可以参考我上一篇文章 <a href="http://chiwai.tang99.club/posts/3460765769.html">http://chiwai.tang99.club/posts/3460765769.html</a></p></blockquote><h2 id="什么是读写分离"><a href="#什么是读写分离" class="headerlink" title="什么是读写分离"></a>什么是读写分离</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;MySQL读写分离的原理其实就是让主服务器处理<span style="color:red;">增、删、改、更新</span>的操作，而从服务器则只完成<span style="color:red;">读</span>操作。</p><h2 id="实现读写分离的四种方式"><a href="#实现读写分离的四种方式" class="headerlink" title="实现读写分离的四种方式"></a>实现读写分离的四种方式</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;实现读写分离可以基于第三方插件，也可以通过修改代码的方式实现。常见的方式有如下4种：</p><p><span style="color:red">Amoeba读写分离； MySQL-Proxy读写分离； Mycat读写分离； 基于程序读写分离(效率很高，实施难度大，开发改代码)；</span></p><h2 id="本次实验系统环境"><a href="#本次实验系统环境" class="headerlink" title="本次实验系统环境"></a>本次实验系统环境</h2><p>MySQL主机：192.168.178.129<br>MySQL从机：192.168.178.130<br>MyCat服务器：192.168.178.131</p><h2 id="安装java-jdk"><a href="#安装java-jdk" class="headerlink" title="安装java-jdk"></a>安装java-jdk</h2><p>因为mycat是用java语言写的，所以需要安装java环境</p><h3 id="下载、解压jdk地址"><a href="#下载、解压jdk地址" class="headerlink" title="下载、解压jdk地址"></a>下载、解压jdk地址</h3><p><span style="font-size:18px;"><b>1.</b></span>jdk下载地址<br><a href="https://www.oracle.com/java/technologies/javase-jdk14-downloads.html" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/javase-jdk14-downloads.html</a></p><p>下载好之后通过<code>flashfxp</code>工具传到linux上。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200509163501.png" alt></p><p><span style="font-size:18px;"><b>2.</b></span>解压jdk</p><pre class="line-numbers language-ini"><code class="language-ini">tar -zxvf jdk-14.0.1_linux-x64_bin.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="font-size:18px;"><b>3.</b></span>重命名jdk、并移动到/usr/目录下</p><pre class="line-numbers language-ini"><code class="language-ini">mv jdk-14.0.1/ jdk14# 移动到/usr/目录下mv jdk14 /usr/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>4.</b></span>配置环境变量</p><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/profile# 在最底层加上以下内容，输入wq保存<span class="token constant">JAVA_HOME</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/jdk14</span><span class="token constant">CLASSPATH</span><span class="token attr-value"><span class="token punctuation">=</span>%JAVA_HOME%/lib:JAVA_HOME%/jre/lib</span><span class="token constant">PATH</span><span class="token attr-value"><span class="token punctuation">=</span>$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin</span>export path CLASSPATH JAVA_HOME# 更新环境变量source /etc/profile# 查看是否成功java -version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200509164903.png" alt="成功"></p><h2 id="安装MyCat"><a href="#安装MyCat" class="headerlink" title="安装MyCat"></a>安装MyCat</h2><p>MyCat下载地址：<a href="http://www.mycat.org.cn/" target="_blank" rel="noopener">http://www.mycat.org.cn/</a></p><h3 id="下载解压mycat"><a href="#下载解压mycat" class="headerlink" title="下载解压mycat"></a>下载解压mycat</h3><pre class="line-numbers language-ini"><code class="language-ini">wget http://dl.mycat.org.cn/1.6.7.1/Mycat-server-1.6.7.1-release-20200209222254-linux.tar.gz# 解压tar -zxvf Mycat-server-1.6.7.1-release-20200209222254-linux.tar.gz# 将mycat移动到/usr/local/目录下mv mycat /usr/local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置mycat环境变量"><a href="#配置mycat环境变量" class="headerlink" title="配置mycat环境变量"></a>配置mycat环境变量</h3><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/profile# 添加如下内容export MYCAT_HOME<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/mycat</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200509232024.png" alt><br>按Esc，输入:wq保存退出</p><pre class="line-numbers language-ini"><code class="language-ini"># 刷新环境变量文件source /etc/profile#切换目录cd /usr/local/mycat/bin/#启动mycat./mycat start# 查看mycat状态./mycat status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span style="color:red">发现mycat无法启动(坑死)</span><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510151627.png" alt="无法启动"></p><h3 id="mycat无法启动解决"><a href="#mycat无法启动解决" class="headerlink" title="mycat无法启动解决"></a>mycat无法启动解决</h3><p><span style="font-size:18px;"><b>1.</b></span>查看错误日志，看看查错(错误日志在<code>logs</code>目录下)</p><pre class="line-numbers language-ini"><code class="language-ini">cat wrapper.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>错误信息：<br><span style="color:red">Java HotSpot(TM) 64-Bit Server VM warning: Ignoring option MaxPermSize; support was removed in 8.0</span><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510151952.png" alt="错误信息"></p><p>大致意思是java8以后不支持MaxPermSize的配置。</p><p>找到该配置项，在<code>mycat/conf</code>里面的<code>wrapper.conf</code>文件。</p><pre class="line-numbers language-ini"><code class="language-ini"># 编辑wrapper.conf文件vi wrapper.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>找到<code>wrapper.java.additional.3=-XX:MaxPermSize=64M</code>配置项，注释掉即可。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510153015.png" alt></p><p>然后在启动mycat，成功运行。</p><pre class="line-numbers language-ini"><code class="language-ini">./mycat start./mycat status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510153225.png" alt="成功"></p><h3 id="配置Mycat的连接信息-server-xml文件"><a href="#配置Mycat的连接信息-server-xml文件" class="headerlink" title="配置Mycat的连接信息(server.xml文件)"></a>配置Mycat的连接信息(server.xml文件)</h3><p>文件地址在<code>conf/</code>目录下</p><p>只需要配置以下内容：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510153903.png" alt="server.xml文件"></p><h3 id="配置读写分离信息-schema-xml文件"><a href="#配置读写分离信息-schema-xml文件" class="headerlink" title="配置读写分离信息(schema.xml文件)"></a>配置读写分离信息(schema.xml文件)</h3><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510170152.png" alt="schema.xml"></p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510170729.png" alt="schema.xml"><br>注：图片中有一处错误，要将<datahost>标签中<code>balance=0</code>参数修改成<code>balance=1</code></datahost></p><p><span style="color:red;">对于&lt;dataHost&gt;标签，参数说明如下：</span></p><blockquote><p><span style="color:red;">balance指的负载均衡类型，目前的取值有4种： </span><br>1.balance=”0”, 不开启读写分离机制，所有读操作都发送到当前可用的writeHost上。<br>2.balance=”1”，全部的readHost与stand bywriteHost参与select语句的负载均衡，简单的说，当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且M1与 M2互为主备)，正常情况下，M2,S1,S2都参与select语句的负载均衡。<br>3.balance=”2”，所有读操作都随机的在writeHost、readhost上分发。<br>4.balance=”3”，所有读请求随机的分发到wiriterHost对应的readhost执行，writerHost不负担读压力 </p></blockquote><blockquote><p><span style="color:red;">writeType属性： </span><br>1.writeType=”0”,所有写操作发送到配置的第一个writeHost,第一个挂了切到还生存的第二个writeHost,重新启动后以切换后的为准，切换记录在配置文件中:dnindex.properties.<br>2.writeType=”1”,所有写操作都随机地发送到配置的writeHost。</p></blockquote><blockquote><p><span style="color:red;">switchType指的是切换的模式，目前的取值也有4种： </span><br> 1.switchType=’-1’ 表示不自动切换<br> 2.switchType=’1’ 默认值，表示自动切换<br> 3.switchType=’2’ 基于MySQL主从同步的状态决定是否切换,心跳语句为 show slave status<br> 4.switchType=’3’基于MySQLgalary cluster的切换机制（适合集群）（1.4.1），心跳语句为 show status like ‘wsrep%’。</p></blockquote><p><span style="font-size:18px;"><b>5.</b></span>重启mycat。</p><pre class="line-numbers language-ini"><code class="language-ini"># 切换目录cd /usr/local/mycat/bin# 重启mycat./mycat restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p><span style="font-size:18px;"><b>1.</b></span>将mycat的日志模式改成debug模式，方便找坑。</p><pre class="line-numbers language-ini"><code class="language-ini">vi /usr/local/mycat/conf/log4j2.xml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510160806.png" alt></p><p><span style="font-size:18px;"><b>2.</b></span>mycat两种登陆方式</p><p><span style="color:red">管理端口：</span>mysql -uroot -proot -P9066 -h192.168.178.131</p><p><span style="color:red">数据端口：</span>mysql -uroot -proot -P8066 -h192.168.178.131</p><p><span style="font-size:18px;"><b>3.</b></span>登录mycat，查看数据库信息。</p><pre class="line-numbers language-ini"><code class="language-ini">mysql -uroot -proot -P8066 -h192.168.178.131show databases;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510163323.png" alt></p><p><span style="font-size:18px;"><b>2.</b></span>查看datasource;</p><pre class="line-numbers language-ini"><code class="language-ini">show datasource;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200510181419.png" alt></p><p>踩坑参考：<br><a href="https://www.pianshen.com/article/1428298232/" target="_blank" rel="noopener">https://www.pianshen.com/article/1428298232/</a></p><p>配置参考：<br><a href="https://blog.csdn.net/qq_15006743/article/details/104093195" target="_blank" rel="noopener">https://blog.csdn.net/qq_15006743/article/details/104093195</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="MySQL" scheme="https://chiwai.tang99.club/categories/MySQL/"/>
    
    
      <category term="读写分离" scheme="https://chiwai.tang99.club/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/"/>
    
  </entry>
  
  <entry>
    <title>MySQL主从复制实现</title>
    <link href="https://chiwai.tang99.club/posts/3460765769.html"/>
    <id>https://chiwai.tang99.club/posts/3460765769.html</id>
    <published>2020-05-06T12:24:34.000Z</published>
    <updated>2020-05-07T13:22:20.992Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux下安装MySQL方法"><a href="#Linux下安装MySQL方法" class="headerlink" title="Linux下安装MySQL方法"></a>Linux下安装MySQL方法</h1><p><a href="http://chiwai.tang99.club/posts/2332524092.html">http://chiwai.tang99.club/posts/2332524092.html</a></p><blockquote><p>系统环境：centos7<br>服务器：<br>主(192.168.178.129)<br>从(192.168.178.130)</p></blockquote><h1 id="主从复制实现"><a href="#主从复制实现" class="headerlink" title="主从复制实现"></a>主从复制实现</h1><p>什么是主从复制？为什么要实现主从复制？</p><blockquote><p><span style="color:red;">什么是主从复制？</span>主从复制就是将一个MySQL数据库服务器（主服务器）的数据复制到另外一个或多个MySQL数据库服务器（从服务器）。说白了就是一种数据库备份方案。<br><span style="color:red;">为什么要实现？</span> 当主数据库出现问题时，可以当从数据库代替主数据库，可以避免数据的丢失。而且也可以实现读写分离。</p></blockquote><p>主从复制的方式</p><blockquote><p>主从复制是异步的，主服务只需要完成自己的数据库操作，至于从服务是否完成复制操作，主服务不需要操心了。</p></blockquote><p>工作原理<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506232656.png" alt><br>1.数据库的所有操作(sql语句)都会被记录到bin-log二进制文件。<br>2.从库开启一个I/O线程，读取bin-log中的内容<br>3.将读取到的内容写入中继日志中，也就是从库的日志文件。<br>4.SQL Thread会读取中继日志，并顺序执行该日志中的SQL事件，从而与主数据库中的数据保持一致。</p><h2 id="主服务器配置"><a href="#主服务器配置" class="headerlink" title="主服务器配置"></a>主服务器配置</h2><p><span style="font-size:18px;"><b>1.</b></span>编辑MySQL的<span style="color:red;">my.cnf</span>配置文件<br>添加以下内容：</p><pre class="line-numbers language-ini"><code class="language-ini">#主从复制配置#日志文件的名字<span class="token constant">log-bin</span><span class="token attr-value"><span class="token punctuation">=</span>master-a-bin</span>#日志文件的格式<span class="token constant">binlog-format</span><span class="token attr-value"><span class="token punctuation">=</span>Row</span>#服务器的id,唯一的<span class="token constant">server-id</span><span class="token attr-value"><span class="token punctuation">=</span>1</span>#对应需要实现主从复制的数据库,ksf为数据库名<span class="token constant">binlog-do-db</span><span class="token attr-value"><span class="token punctuation">=</span>ksf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506211004.png" alt></p><p><span style="font-size:18px;"><b>2.</b></span> 添加完之后需要登录主服务器给从服务器授权</p><pre class="line-numbers language-ini"><code class="language-ini"># 登录MySQLmysql -uroot -p# 授权命令grant replication slave on *.* to 'root'@'192.168.178.%' identified by 'root';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506211310.png" alt="Query OK"></p><p>拆分说明：<br><span style="color:red">192.168.178.%</span> 表示以178结尾的主机都可以授权</p><p><span style="color:red">by ‘root’ </span>表示你数据库的密码,我的密码就是root</p><p><span style="font-size:18px;"><b>3.</b></span>刷新权限</p><pre class="line-numbers language-ini"><code class="language-ini"># 刷新系统权限表flush PRIVILEGES;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="从服务器配置"><a href="#从服务器配置" class="headerlink" title="从服务器配置"></a>从服务器配置</h2><p><span style="font-size:18px;"><b>1.</b></span>编辑MySQL的my.cnf配置文件<br>添加以下内容：</p><pre class="line-numbers language-ini"><code class="language-ini">#主从复制配置#日志文件的名字<span class="token constant">log-bin</span><span class="token attr-value"><span class="token punctuation">=</span>master-a-bin</span>#日志文件的格式<span class="token constant">binlog-format</span><span class="token attr-value"><span class="token punctuation">=</span>Row</span>#服务器的id,唯一的<span class="token constant">server-id</span><span class="token attr-value"><span class="token punctuation">=</span>2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="验证主从复制状态"><a href="#验证主从复制状态" class="headerlink" title="验证主从复制状态"></a>验证主从复制状态</h2><p><span style="font-size:18px;"><b>1.</b></span> 重启两台服务器</p><pre class="line-numbers language-ini"><code class="language-ini">service mysqld restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="font-size:18px;"><b>2.</b></span>查看主服务器的状态</p><pre class="line-numbers language-ini"><code class="language-ini">show  master status;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506213403.png" alt><br>解释说明：<br><span style="color:red">File：</span> 表示生成的日志文件名</p><p><span style="color:red">Position：</span> 表示文件名所处的一个位置（偏移量）</p><p><span style="color:red">Binlog_Do_DB：</span> 表示需要实现主从复制的数据库</p><h2 id="设置从服务器如何找到主服务器"><a href="#设置从服务器如何找到主服务器" class="headerlink" title="设置从服务器如何找到主服务器"></a>设置从服务器如何找到主服务器</h2><p><span style="font-size:18px;"><b>1.</b></span>设置主从复制的日志和偏移量（在从服务器下操作）<br>先登录MySQL，然后输入以下内容：</p><pre class="line-numbers language-ini"><code class="language-ini">change master to master_host<span class="token attr-value"><span class="token punctuation">=</span>'192.168.178.129',master_port=3306,master_user='root',master_password='root',master_log_file='master-a-bin.000001',master_log_pos=154;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解释说明：<br><span style="color:red;">change master</span> 表示查找主服务器</p><p><span style="color:red;">master_host</span> 表示主服务器的地址</p><p><span style="color:red;">master_prot</span> 表示端口号</p><p><span style="color:red;">master_user</span> 表示主服务器用户名</p><p><span style="color:red;">master_password</span> 表示主服务器的密码</p><p><span style="color:red;">master_log_file</span> 表示主服务器生成的日志名称</p><p><span style="color:red;">master_log_pos</span> 表示日志位置</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506215536.png" alt></p><p><span style="font-size:18px;"><b>2.</b></span>启动slave的数据同步（在从服务器下操作）</p><pre class="line-numbers language-ini"><code class="language-ini">#启动数据同步start slave;#停止数据同步stop slave;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>3.</b></span>查看salve的配置信息</p><pre class="line-numbers language-ini"><code class="language-ini">show slave status\G;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506220050.png" alt></p><p>可以使用<span style="color:red;">Navicat客户端</span>进行连接测试：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506221319.png" alt></p><p><span style="font-size:18px;"><b>4.</b></span> 解决正在连接中的问题</p><blockquote><p>分析说明：<br>1.防火墙的问题<br>2.端口未开放<br>3.未授权</p></blockquote><p><span style="color:red;">防火墙解决方法：</span>关闭防火墙就好了，但是关闭防火墙不安全</p><p><span style="color:red;">开放端口(建议)：</span>(主服务器操作)</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --zone<span class="token attr-value"><span class="token punctuation">=</span>public --add-port=3306/tcp --permanent</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重新载入防火墙</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506221416.png" alt="连接成功"></p><p><span style="color:red;">还需要授权（不然无法获取到所有表）</span>(主服务器操作)</p><pre class="line-numbers language-ini"><code class="language-ini">grant all privileges on *.* to root@'%' identified by 'root' with grant option;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506222149.png" alt></p><p>然后关闭数据同步，在启动数据同步(从服务器操作)</p><pre class="line-numbers language-ini"><code class="language-ini">stop slave;start slave;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>查看状态：</p><pre class="line-numbers language-ini"><code class="language-ini">show slave status\G;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看出现两个yes，表示成功<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506222902.png" alt="主从复制成功"></p><h2 id="终极测试"><a href="#终极测试" class="headerlink" title="终极测试"></a>终极测试</h2><p>在主服务器创建一张表:</p><pre class="line-numbers language-ini"><code class="language-ini">create table test(id int primary key auto_increment,name varchar(32) not null)charset<span class="token attr-value"><span class="token punctuation">=</span>'utf8';</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后去从服务器上查看，发现也会出现一张表<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200506223754.png" alt></p><p>主从同步成功。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="MySQL" scheme="https://chiwai.tang99.club/categories/MySQL/"/>
    
    
      <category term="主从复制" scheme="https://chiwai.tang99.club/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>Linux下安装MySQL</title>
    <link href="https://chiwai.tang99.club/posts/2332524092.html"/>
    <id>https://chiwai.tang99.club/posts/2332524092.html</id>
    <published>2020-05-01T10:56:55.000Z</published>
    <updated>2020-05-09T15:55:13.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h1><p><span style="font-size:18px;"><b>1.</b></span>检查是否已经安装过mysql，执行以下命令：</p><pre class="line-numbers language-ini"><code class="language-ini">rpm -qa | grep mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200504103152.png" alt><br>如果存在，执行以下命令</p><pre class="line-numbers language-ini"><code class="language-ini">rpm -e --nodeps mysql-libs-5.1.73-5.el6_6.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="font-size:18px;"><b>2.</b></span> 查找所有mysql相关的文件夹</p><pre class="line-numbers language-ini"><code class="language-ini">whereis mysqlfind / -name mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果存在，执行以下命令删除：</p><pre class="line-numbers language-ini"><code class="language-ini">rm -rf 文件地址1 文件地址2  文件地址2 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="MySQL下载地址"><a href="#MySQL下载地址" class="headerlink" title="MySQL下载地址"></a>MySQL下载地址</h1><p>MySQL官方下载地址：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a></p><h1 id="下载安装MySQL"><a href="#下载安装MySQL" class="headerlink" title="下载安装MySQL"></a>下载安装MySQL</h1><p><span style="font-size:18px;"><b>1.</b></span>下载并移动MySQL至<code>/usr/local/</code>目录下</p><pre class="line-numbers language-ini"><code class="language-ini"># 下载mysqlwget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.30-linux-glibc2.12-x86_64.tar.gz# 下载完成后解压MySQLtar -xzvf mysql-5.7.30-linux-glibc2.12-x86_64.tar.gz# 将解压好的文件移动到/usr/local/目录下mv mysql-5.7.30-linux-glibc2.12-x86_64 /usr/local/cd /usr/local/# 重命名为mysqlmv mysql-5.7.30-linux-glibc2.12-x86_64 mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503202825.png" alt></p><p><span style="font-size:18px;"><b>2.</b></span>在/usr/local/mysql目录下创建data目录</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/local/mysqlmkdir data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>3.</b></span>更改mysql目录下所有的目录及文件夹所属的用户组和用户，以及权限</p><pre class="line-numbers language-ini"><code class="language-ini">chown -R mysql:mysql /usr/local/mysqlchmod -R 755 /usr/local/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果出现<span style="color:red">chown: 无效的用户: “mysql:mysql”</span>的错误，需要先创建组和用户。</p><pre class="line-numbers language-ini"><code class="language-ini">#创建mysql组groupadd mysql#创建mysql用户添加到mysql组useradd -r -g mysql mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>4.</b></span>编译安装并初始化mysql,务必记住初始化输出日志末尾的密码（数据库管理员临时密码）</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/local/mysql/bin./mysqld --initialize --user<span class="token attr-value"><span class="token punctuation">=</span>mysql --datadir=/usr/local/mysql/data --basedir=/usr/local/mysql</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>5.</b></span>运行初始化命令成功后，输出日志如下：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503210305.png" alt><br>记住末尾那段字符串，此字符串为mysql管理员临时登陆密码。</p><p><span style="font-size:18px;"><b>6.</b></span>编辑配置文件my.cnf，添加配置如下</p><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/my.cnf<span class="token selector">[mysqld]</span><span class="token constant">datadir</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/mysql/data</span><span class="token constant">basedir</span> <span class="token attr-value"><span class="token punctuation">=</span> /usr/local/mysql</span><span class="token constant">character-set-server</span><span class="token attr-value"><span class="token punctuation">=</span>utf8</span><span class="token constant">socket</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/mysql/mysql.sock</span># Disabling symbolic-links is recommended to prevent assorted security risks<span class="token constant">symbolic-links</span><span class="token attr-value"><span class="token punctuation">=</span>0</span># Settings user and group are ignored when systemd is used.# If you need to run mysqld under a different user or group,# customize your systemd unit file for mariadb according to the# instructions in http://fedoraproject.org/wiki/Systemd<span class="token selector">[mysqld_safe]</span><span class="token constant">log-error</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/mysql/data/mariadb/mariadb.log</span><span class="token constant">pid-file</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/mysql/data/mariadb/mariadb.pid</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503224413.png" alt></p><p><span style="font-size:18px;"><b>7.</b></span>启动mysql服务器</p><pre class="line-numbers language-ini"><code class="language-ini">/usr/local/mysql/support-files/mysql.server start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>显示如下，则代表成功<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503224618.png" alt></p><p>如果出现如下错误，<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503224752.png" alt><br>出现错误原因说明:<br><b>1.</b> 在这个目录下没有这个目录或文件，并且用户权限不够，无法自动创建。</p><p><b>2.</b> 说白了也就是权限不够，无法创建socket套接字连接文件</p><p>解决方法：<br><span style="font-size:16px;"><b>7.1</b></span>需要在/usr/local/mysql/data/创建目录<code>mariadb</code>以及文件<code>mariadb.log</code></p><pre class="line-numbers language-ini"><code class="language-ini">mkdir mariadbcd mariadbtouch mariadb.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span style="font-size:16px;"><b>7.2</b></span>给/usr/local/mysql/下的data目录升权限</p><pre class="line-numbers language-ini"><code class="language-ini">chmod -R 777 data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="font-size:16px;"><b>7.3</b></span>给/var/lib下的mysql目录升权限</p><pre class="line-numbers language-ini"><code class="language-ini">chmod -R 777 mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="font-size:18px;"><b>8.</b></span>添加软连接，并重启mysql服务</p><pre class="line-numbers language-ini"><code class="language-ini">ln -s /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqlln -s /usr/local/mysql/bin/mysql /usr/bin/mysqlservice mysql restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>9.</b></span>登录mysql，修改密码(密码为第5步的临时密码)</p><pre class="line-numbers language-ini"><code class="language-ini">mysql -u root -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输入完密码后，如果报以下错误：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503232659.png" alt><br>是因为你my.cnf 配置文件中设置了 [mysqld] 的参数 socket ，而没有设置[client]的参数socket。</p><p>解决方法：<br>添加 [client] 配置项，如下所示</p><pre class="line-numbers language-ini"><code class="language-ini"><span class="token selector">[client]</span><span class="token constant">port</span><span class="token attr-value"><span class="token punctuation">=</span>3306</span><span class="token constant">socket</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/mysql/mysql.sock</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503232744.png" alt="红圈的是新添加的"><br>然后重启服务</p><pre class="line-numbers language-ini"><code class="language-ini">service mysql restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再次重新输入密码后就成功了。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503232850.png" alt="成功进入"></p><p><span style="font-size:18px;"><b>10.</b></span>修改密码</p><pre class="line-numbers language-ini"><code class="language-ini">set password for root@localhost <span class="token attr-value"><span class="token punctuation">=</span> password('yourpass');</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503233023.png" alt></p><p><span style="font-size:18px;"><b>11.</b></span>开放远程连接</p><pre class="line-numbers language-ini"><code class="language-ini">use mysql;update user set user.Host<span class="token attr-value"><span class="token punctuation">=</span>'%' where user.User='root';</span>flush privileges;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200503233159.png" alt></p><p><span style="font-size:18px;"><b>12.</b></span>设置开机自动启动</p><pre class="line-numbers language-ini"><code class="language-ini">1、将服务文件拷贝到init.d下，并重命名为mysqlcp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld2、赋予可执行权限chmod +x /etc/init.d/mysqld3、添加服务chkconfig --add mysqld4、显示服务列表chkconfig --list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>到这里就结束了，过程很坎坷，步步报错，还好都解决了。</p><p>参考:<br><a href="https://www.jianshu.com/p/276d59cbc529" target="_blank" rel="noopener">https://www.jianshu.com/p/276d59cbc529</a><br><a href="https://www.jb51.net/article/174244.htm" target="_blank" rel="noopener">https://www.jb51.net/article/174244.htm</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="MySQL" scheme="https://chiwai.tang99.club/categories/MySQL/"/>
    
    
      <category term="MySQL安装" scheme="https://chiwai.tang99.club/tags/MySQL%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>Linux下安装PHP环境</title>
    <link href="https://chiwai.tang99.club/posts/3625623890.html"/>
    <id>https://chiwai.tang99.club/posts/3625623890.html</id>
    <published>2020-04-20T12:20:07.000Z</published>
    <updated>2020-06-20T06:09:24.993Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux安装PHP环境-LNMP"><a href="#Linux安装PHP环境-LNMP" class="headerlink" title="Linux安装PHP环境_LNMP"></a>Linux安装PHP环境_LNMP</h1><h1 id="安装PHP"><a href="#安装PHP" class="headerlink" title="安装PHP"></a>安装PHP</h1><h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token shell-comment comment">#安装php依赖包：</span>yum install libxml2yum install libxml2<span class="token operator">-</span>devel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="下载php7文件"><a href="#下载php7文件" class="headerlink" title="下载php7文件"></a>下载php7文件</h2><p>下载地址<code>https://www.php.net/distributions/php-7.2.31.tar.gz</code></p><pre class="line-numbers language-ini"><code class="language-ini"># 通过wget命令，将文件下载到/usr/local/目录下cd /usr/localwget https://www.php.net/distributions/php-7.2.31.tar.gz#解压下载好的文件,修改名字为phptar -zxvf php-7.2.31.tar.gzmv php-7.2.31 php#进入解压好的php文件，编译安装cd php#编译安装./configure --prefix<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/php --with-zlib --enable-zip --with-openssl --enable-fpm --enable-mbstring --with-libdir=lib64</span>make &amp;&amp; make install# 设置.ini文件和启动脚本cp php.ini-production /usr/local/php/lib/php.inicp sapi/fpm/php-fpm /etc/init.d/php-fpm#添加执行权限chmod +x /etc/init.d/php-fpm#php-fpm的配置文件cp etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.confcp etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf#设置默认启动php-fpm子进程数和最大启动数vi /usr/local/php/etc/php-fpm.d/www.conf<span class="token constant">pm.max_children</span> <span class="token attr-value"><span class="token punctuation">=</span> 200</span><span class="token constant">pm.start_servers</span> <span class="token attr-value"><span class="token punctuation">=</span> 20</span><span class="token constant">pm.min_spare_servers</span> <span class="token attr-value"><span class="token punctuation">=</span> 10</span><span class="token constant">pm.max_spare_servers</span> <span class="token attr-value"><span class="token punctuation">=</span> 30</span>#设置环境变量vi /etc/profile#最后一行加入export PATH<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/php/bin:$PATH</span>#刷新环境变量source /etc/profile#启动/etc/init.d/php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/1590636663(1).jpg" alt></p><blockquote><p>参数说明<br>–prefix=安装目录<br>–with-使用包名称[=包目录]<br>–enable-需要激活的功能</p></blockquote><h2 id="重启php-fpm"><a href="#重启php-fpm" class="headerlink" title="重启php-fpm"></a>重启php-fpm</h2><pre class="line-numbers language-ini"><code class="language-ini">#找到master的进程IDps -ef | grep php# 杀死进程kill -9 ID#然后再次启动/etc/init.d/php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="重启时报错"><a href="#重启时报错" class="headerlink" title="重启时报错"></a><span style="color:red;">重启时报错</span></h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528114048.png" alt></p><blockquote><p>中文翻译如下：<br>错误：无法绑定监听套接字地址的127.0.0.1:9000：地址已使用（98）<br>错误：程序初始化失败</p></blockquote><p>解决方法：<br>1、查看9000端口是否监听</p><pre class="line-numbers language-ini"><code class="language-ini">netstat -lntup | grep 9000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2、杀掉所有的php-fpm进程</p><pre class="line-numbers language-ini"><code class="language-ini">killall php-fpm <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果出现:<span style="color:red">-bash: killall: command not found</span>,执行以下命令安装</p><pre class="line-numbers language-ini"><code class="language-ini"># centos 下yum install psmisc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3、重启php-fpm</p><pre class="line-numbers language-ini"><code class="language-ini">/etc/init.d/php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动成功！</p><h1 id="配置nginx支持php-修改nginx配置文件"><a href="#配置nginx支持php-修改nginx配置文件" class="headerlink" title="配置nginx支持php,修改nginx配置文件"></a>配置nginx支持php,修改nginx配置文件</h1><p>我的配置文件目录在<code>/usr/local/nginx/conf/</code>目录下</p><p>编辑nginx.conf配置文件</p><pre class="line-numbers language-ini"><code class="language-ini">vi /usr/local/nginx/conf/nginx.conf#修改配置文件，设置匹配规则,见下图。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528134822.png" alt><br>访问成功！<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200528134908.png" alt></p><p>#安装composer</p><pre class="line-numbers language-ini"><code class="language-ini">curl -sS https://getcomposer.org/installer | php#将composer.phar文件移动到bin目录以便全局使用composer命令mv composer.phar /usr/local/bin/composer#切换国内源composer config -g repo.packagist composer https://packagist.phpcomposer.com#如果提示：Do not run Composer as root/super user! Seehttps://getcomposer.org/rootfor details#是因为composer不希望我们用root账号去操作，则需要创建一个账号useradd -g root tzw#切换到tzw账号su tzw#使用composer账号进行composer命令操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h1><p>安装mysql教程看另外一篇内容：<a href="https://chiwai.tang99.club/posts/2332524092.html">https://chiwai.tang99.club/posts/2332524092.html</a></p><h1 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h1><p>安装redis教程看另外一篇内容：<br><a href="https://chiwai.tang99.club/posts/2051437431.html">https://chiwai.tang99.club/posts/2051437431.html</a></p><h1 id="配置nginx支持thinkphp路由"><a href="#配置nginx支持thinkphp路由" class="headerlink" title="配置nginx支持thinkphp路由"></a>配置nginx支持thinkphp路由</h1><p> 修改nginx配置</p><pre class="line-numbers language-ini"><code class="language-ini">vi /usr/local/nginx/conf/nginx.confserver {    listen       80;    root        /myvue/public;    server_name  localhost;    location / {                index  index.html index.htm index.php;                if (!-e $request_filename) {                    rewrite  ^/(.*)$  /index.php?s<span class="token attr-value"><span class="token punctuation">=</span>$1  last;</span>                    break;                }    }    location ~ \.php/?.*$ {        fastcgi_pass   127.0.0.1:9000;        fastcgi_index  index.php;        include        fastcgi.conf;        set $fastcgi_script_name2 $fastcgi_script_name;        if ($fastcgi_script_name ~ "^(.+\.php)(/.+)$") {            set $fastcgi_script_name2 $1;            set $path_info $2;        }        fastcgi_param   PATH_INFO $path_info;        #下面两句是给fastcgi权限，可以支持 ?s<span class="token attr-value"><span class="token punctuation">=</span>/module/controller/action的url访问模式</span>        fastcgi_split_path_info  ^((?U).+\.php)(/?.+)$;        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;        #下面两句才能真正支持 index.php/index/index/index的pathinfo模式        fastcgi_param   SCRIPT_FILENAME   $document_root$fastcgi_script_name2;        fastcgi_param   SCRIPT_NAME   $fastcgi_script_name2;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>暂时结束！</p><p>参考资料：<a href="https://blog.csdn.net/mxdzchallpp/article/details/82867681" target="_blank" rel="noopener">https://blog.csdn.net/mxdzchallpp/article/details/82867681</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/categories/PHP/"/>
    
    
      <category term="安装php" scheme="https://chiwai.tang99.club/tags/%E5%AE%89%E8%A3%85php/"/>
    
  </entry>
  
  <entry>
    <title>keepalived出现主备机同时绑定vip的解决方法</title>
    <link href="https://chiwai.tang99.club/posts/4120007045.html"/>
    <id>https://chiwai.tang99.club/posts/4120007045.html</id>
    <published>2020-04-15T14:44:19.000Z</published>
    <updated>2020-05-03T11:14:30.081Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>配置完keepalived之后出现一点小问题，就是启动keepalived之后，发现主备机上同时绑定了虚拟IP，跟预期结果不一样。</p><p><span style="color:red;"><b>1.</b></span>检查keepalived.conf配置文件，是否配置出现问题。</p><p>主机配置(192.168.178.129)：</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_one}vrrp_script chk_nginx{    script "/etc/keepalived/nginx_check.sh"    interval 2    weight -20}vrrp_instance VI_1 {    state MASTER    interface ens33    mcast_src_ip 192.168.178.129    virtual_router_id 51    priority 100    nopreempt    advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script{    chk_nginx     }    virtual_ipaddress {        192.168.178.125    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备机配置(192.168.178.130)：</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_two}vrrp_script chk_nginx{    script "/etc/keepalived/nginx_check.sh"    interval 2    weight -20}vrrp_instance VI_1 {    state BACKUP    interface ens33    virtual_router_id 51    mcast_src_ip 192.168.178.130    priority 90    nopreempt     advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script{    chk_nginx    }    virtual_ipaddress {        192.168.178.125    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过检查对比发现没有什么问题。</p><p><span style="color:red;"><b>2.</b></span>通过tcpdump抓包检查,同时在主、备机(129、130)都监听一遍ens33网卡</p><p>输入如下命令:</p><pre class="line-numbers language-ini"><code class="language-ini">sudo tcpdump -i ens33 vrrp -n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502230223.png" alt></p><p>结果你会发现129（主机）和130（备份机）两台机器在轮询往224.0.0.18（vrrp的组播地址）发送报文。<br>理论上来说，主机处于活跃状态的时候，备份机收到报文之后是不会发送组播消息的，这个很明显就是备份机没收到主机的组播报文。</p><p><span style="color:red;"><b>3.</b></span>开启组播通信<br>注意：我的防火墙是<code>firewall</code>,如果防火墙是<code>iptables</code>可能不受用(猜测的，没试过)</p><p>运行以下命令<span style="color:red;">(主、备机都要运行)</span>:</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface ens33 --destination 224.0.0.18 --protocol vrrp -j ACCEPTfirewall-cmd --reload; # 刷新防火墙<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中<span style="color:red">INPUT 0 –in-interface ens33</span>,这段的<span style="color:red;">ens33</span>是绑定得vip的网卡，替换成你自己的网卡就可以了。</p><p>运行之后，再查看vip绑定情况，发现已经恢复正常:</p><p>(主机仍然绑定)<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502231437.png" alt="主机仍然绑定"></p><p>(备机解除绑定)<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502231609.png" alt="备机解除绑定"></p><p>再监控一下ens33网卡报文情况：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502231646.png" alt="一切正常"></p><p>参考：<br><a href="https://blog.csdn.net/liu1160848595/article/details/104653226/" target="_blank" rel="noopener">https://blog.csdn.net/liu1160848595/article/details/104653226/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="keepalived" scheme="https://chiwai.tang99.club/categories/keepalived/"/>
    
    
      <category term="keepalived" scheme="https://chiwai.tang99.club/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>nginx+keepalived可用热备负载均衡</title>
    <link href="https://chiwai.tang99.club/posts/2236109518.html"/>
    <id>https://chiwai.tang99.club/posts/2236109518.html</id>
    <published>2020-04-12T15:33:28.000Z</published>
    <updated>2020-05-03T11:13:58.596Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="nginx-keepalived可用热备负载均衡"><a href="#nginx-keepalived可用热备负载均衡" class="headerlink" title="nginx+keepalived可用热备负载均衡"></a>nginx+keepalived可用热备负载均衡</h1><h1 id="Linux下安装nginx"><a href="#Linux下安装nginx" class="headerlink" title="Linux下安装nginx"></a>Linux下安装nginx</h1><p>安装方法请查看我另外写的一篇内容。<br><a href="http://chiwai.tang99.club/posts/3979785611.html">http://chiwai.tang99.club/posts/3979785611.html</a></p><h1 id="什么是负载均衡呢？"><a href="#什么是负载均衡呢？" class="headerlink" title="什么是负载均衡呢？"></a>什么是负载均衡呢？</h1><p>经过资料查阅，做一个简单的总结。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;负载均衡是集群技术的一种应用。负载均衡可以将工作任务分摊到多个处理单元。就是我们需要一个调度者，保证所有后端服务器都能将性能充分发挥，从而保持服务器集群的整体性能。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;由于单个处理节点发生故障不影响整个服务，负载均衡集群同时也实现了<span style="color:red;">高可用性</span>。</p><p>举个简单的例子，我们每天早上上班挤地铁，由于人特别多，你会注意到地铁工作人员拿个大喇叭喊话:着急的人请走B口，B口人少。而这个地铁工作人员就是负载均衡，负责分发客流量。</p><h1 id="集群分类"><a href="#集群分类" class="headerlink" title="集群分类"></a>集群分类</h1><ul><li><p><span style="color:red;">高性能集群</span>：将多台计算机的计算能力合并到一起，就像是一个超级计算机，从而实现一个超越单台计算机计算能力的强力系统。</p></li><li><p><span style="color:red;">高可用集群</span>：当其中一个服务出现故障时，系统会立刻分发到另外一个服务。提高冗余单元，避免单点故障。</p></li><li><p><span style="color:red;">负载均衡集群</span>：将大量的并发请求分担到多个处理节点。</p></li></ul><h1 id="常用的负载均衡"><a href="#常用的负载均衡" class="headerlink" title="常用的负载均衡"></a>常用的负载均衡</h1><ul><li><p><span style="color:red;">HTTP重定向</span><br>&nbsp;&nbsp;&nbsp;在日常web开发中，我们常用会用它来完成自动跳转，比如登录成功后跳转到其他页面。<br>&nbsp;&nbsp;&nbsp;这种重定向完全由HTTP定义，并且由HTTP代理和web服务器共同实现。简单来说当浏览器向web服务器请求某个URL后，Web服务器可以通过HTTP响应头信息中的Location标记来返回一个新的URL，这就意味着HTTP代理需要继续请求这个新的URL，这便完成了自动跳转。也正是因为这种重定向具备请求转移和自动跳转的本领，可以用来实现负载均衡。</p></li><li><p><span style="color:red;">DNS负载均衡</span><br>&nbsp;&nbsp;&nbsp;以域名作为访问入口，通过配置多条DNS A记录使得请求可以分配到不同的服务器。<br>&nbsp;&nbsp;&nbsp;但是有一个问题，似乎是解决了负载均衡，但是怎么保持你的会话在一台服务器上，还有一个问题就是，当服务器出现问题后，是不是还要改DNS配置，我们都知道，在配置当中有一个TTL时间，是不能将时间改为0的，所以，这是一种弊端。</p></li><li><p><span style="color:red;">反向代理负载均衡</span></p><blockquote><p>代理分为<span style="color:red;">正向代理</span>和<span style="color:red;">反向代理</span><br><span style="color:red;">正向代理</span>：用户将请求交给代理服务器，代理服务器访问网站获取数据，之后代理服务器在将数据返回给用户。在这个过程中，应用服务器并不知道用户的存在，只知道代理服务器的访问。VPN就是我们常用的一种代理，正向代理。<br><span style="color:red;">反向代理</span>：是服务器端的代理，代理服务器接收用户的请求，再转发给真实服务器，之后在返回给代理服务器，由代理服务器返回给用户，在这个过程中，用户并不知道真实服务器的存在。</p></blockquote></li></ul><p>&nbsp;&nbsp;&nbsp;一句话概括为代理服务器将请求均匀转发给内部多台Web服务器之一，从而达到负载均衡的目的。</p><h1 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h1><ul><li><p><span style="color:red;">轮询法</span><br>将请求按顺序轮流分配到后端服务器上，它均衡的对待后端的每一台服务器，而不关心服务器的实际连接数和当前系统的负载。<span style="color:red;">(默认为轮询法)</span><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501095119.png" alt="轮询法"></p></li><li><p><span style="color:red;">加权轮询法</span><br>不同的后端服务器可能机器的配置不同和当前系统的负载也不同，因此他们的服务器性能不统一。将性能好的服务器分配更高的权重，让其处理更多的请求，将性能低的服务器分配较低的权重，降低服务器的压力。<br>属性：<span style="color:red;">(weight)</span><br>如下配置轮询三台服务。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501105229.png" alt="加权轮询法"></p></li><li><p><span style="color:red;">源地址哈希法</span><br>通过对访问用户的IP进行哈希计算，根据得出的结果进行分配该请求哪台服务器，这样每一个用户固定请求同一个后端服务器，能够保持用户的会话存储。例如：用户A第一次访问的是列表中第一台服务器，那么用户第二次请求还会访问第一台服务器。（ip_hash可以和weight配合使用）<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501111113.png" alt="源地址哈希法"></p></li><li><p><span style="color:red;">最少连接法</span><br>将请求分配到连接数最少的服务上。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501121147.png" alt="最少连接法"></p></li><li><p><span style="color:red;">fair法</span><br>按照服务器响应时间的长短来进行分发的，服务器响应时间越短，优先分发</p><blockquote><p>fair为非官方模块，如过没有安装会报错，安装方法自行百度，挺简单的。</p></blockquote></li></ul><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501141826.png" alt="fair法"></p><h1 id="负载均衡实现方式"><a href="#负载均衡实现方式" class="headerlink" title="负载均衡实现方式"></a>负载均衡实现方式</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;我有3台虚拟主机和一台服务器，IP分别为：<span style="color:red;">192.168.178.129</span>，<span style="color:red;">192.168.178.130</span>，<span style="color:red;">192.168.**.1</span>，<span style="color:red;">47.103.*.**</span>端口号都默认为80端口。<br>&nbsp;&nbsp;&nbsp;&nbsp;其中，我以IP为<span style="color:red;">192.168.178.129</span>的作为负载均衡服务器，分别将请求分发给另外三个服务器。配置方式如下：</p><ol><li>进入到nginx安装目录，找到<code>nginx.conf</code>配置文件。编辑nginx.conf文件(192.168.178.129)<pre class="line-numbers language-ini"><code class="language-ini">vi nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501091046.png" alt><br>在http配置项里面将会看到include到其它配置文件，根据引入的地址，找到.conf相关文件。这里不是唯一的，根据每个人配置情况而定，也可以不引入，直接在里面配置也行。</li></ol><pre class="line-numbers language-ini"><code class="language-ini">cd conf.dvi default.conf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501092007.png" alt></p><ol start="2"><li><p>配置如下代码<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501092804.png" alt></p></li><li><p>结果说明，在浏览器中输入IP为<code>192.168.178.129</code>，第一次请求将展示<code>upstream</code>模块的第一个ip地址，刷新浏览器，第二次将转换到<code>upstream</code>模块的第二个ip地址，第三次为第三个地址，以此类推，按顺序轮询展示，这是因为<code>upstream</code>模块默认就是轮询法，每个ip分发一次。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501094400.png" alt="第一次"><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501094511.png" alt="第二次"><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501094534.png" alt="第三次"></p></li><li><p>默认为轮询法，其它方法请看上面的<code># 负载均衡算法</code> 说明。</p></li></ol><h1 id="高可用keepalived安装与搭建"><a href="#高可用keepalived安装与搭建" class="headerlink" title="高可用keepalived安装与搭建"></a>高可用keepalived安装与搭建</h1><p>地址：<a href="http://chiwai.tang99.club/posts/2566092336.html#toc-heading-2">http://chiwai.tang99.club/posts/2566092336.html#toc-heading-2</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="nginx" scheme="https://chiwai.tang99.club/categories/nginx/"/>
    
    
      <category term="负载均衡" scheme="https://chiwai.tang99.club/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>Linux下安装keepalived与配置</title>
    <link href="https://chiwai.tang99.club/posts/2566092336.html"/>
    <id>https://chiwai.tang99.club/posts/2566092336.html</id>
    <published>2020-04-11T09:22:19.000Z</published>
    <updated>2020-05-03T11:19:00.868Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>nginx搭建负载均衡可查看 <a href="http://chiwai.tang99.club/posts/2236109518.html">http://chiwai.tang99.club/posts/2236109518.html</a></p></blockquote><p>keepalived下载地址：<a href="https://www.keepalived.org/download.html" target="_blank" rel="noopener">https://www.keepalived.org/download.html</a></p><h2 id="下载、安装keepalived"><a href="#下载、安装keepalived" class="headerlink" title="下载、安装keepalived"></a>下载、安装keepalived</h2><p><b style="font-size:18px;">1.</b>&nbsp;&nbsp;下载到<code>/usr/local/src</code>目录。</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/local/srcwget https://www.keepalived.org/software/keepalived-2.0.20.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">2.</b>&nbsp;&nbsp;解压安装</p><pre class="line-numbers language-ini"><code class="language-ini">tar -zxvf keepalived-2.0.20.tar.gzcd keepalived-2.0.20/# 指定安装在/usr/local/keepalived 路径下./configure --prefix<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/keepalived</span># 编译+安装make &amp;&amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>./configure</code>的时候出现以下警告信息<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501202316.png" alt><br>警告如上解决如下：</p></blockquote><pre class="line-numbers language-ini"><code class="language-ini">yum -y install libnl libnl-develyum install -y libnfnetlink-devel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">3.</b>&nbsp;&nbsp;将 keepalived 安装成 Linux 系统服务</p><p>因为没有使用 keepalived 的默认路径安装（默认是/usr/local） ,安装完成之后，需要做一些工作复制默认配置文件到默认路径</p><pre class="line-numbers language-ini"><code class="language-ini">mkdir /etc/keepalived# 将配置文件放到默认路径下cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>复制 keepalived 服务脚本到默认的地址</p><pre class="line-numbers language-ini"><code class="language-ini"># keepalived启动脚本(源码目录下)，放到/etc/init.d/目录下就可以使用service命令便捷调用cp /usr/local/src/keepalived-2.0.20/keepalived/etc/init.d/keepalived /etc/init.d/# keepalived启动脚本变量引用文件，默认文件路径是/etc/sysconfig/，也可以不做软链接，直接修改启动脚本中文件路径即可（安装目录下）cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/# 将keepalived主程序加入到环境变量，ln命令类似于cp，意思是为某一个文件在另外一个位置建立一个同步的链接，好处是不必重复的占用磁盘空间。ln -s /usr/local/keepalived/sbin/keepalived /usr/sbin/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">4.</b>&nbsp;&nbsp;启动</p><ul><li>开机启动：<code>chkconfig keepalived on</code></li><li>加为系统服务：<code>chkconfig –add keepalived</code></li><li>启动、关闭、重启<code>service keepalived start|stop|restart</code></li></ul><h2 id="配置文件参数介绍"><a href="#配置文件参数介绍" class="headerlink" title="配置文件参数介绍"></a>配置文件参数介绍</h2><p><b style="font-size:18px;">5.</b>&nbsp;&nbsp;配置文件参数介绍</p><pre class="line-numbers language-ini"><code class="language-ini"># 全局定义块global_defs {   notification_email {     #指定keepalived在发生事件时，发送邮件给哪些用户       1551685913@qq.com          #设置报警邮件地址，可以设置多个，每行一个。 需开启本机的sendmail服务。 建议用独立的监控或第三方 SMTP   }   notification_email_from 1551685913@qq.com    #指定发件人   smtp_server 192.168.200.1           #指定发送email的smtp服务器   smtp_connect_timeout 30          #设置连接smtp server的超时时间   router_id LVS_DEVEL         #运行keepalived的机器的一个标识，通常可设为hostname。   vrrp_skip_check_adv_addr   #默认是不跳过检查。检查收到的VRRP通告中的所有地址可能会比较耗时，设置此命令的意思是，如果通告与接收的上一个通告来自相同的master路由器，则不执行检查(跳过检查)。   vrrp_strict              #严格遵守VRRP协议。下列情况将会阻止启动Keepalived：1. 没有VIP地址。2. 单播邻居。3. 在VRRP版本2中有IPv6地址。   vrrp_garp_interval 0   #在一个接口发送的两个免费ARP之间的延迟。可以精确到毫秒级。默认是0.   vrrp_gna_interval 0}# 定义虚拟路由， VI_1 为虚拟路由的标示符，自己定义名称vrrp_instance VI_1 {  #keepalived在同一virtual_router_id中priority（0-255）最大的会成为master，也就是接管VIP，当priority最大的主机发生故障后次priority将会接管    state MASTER    #主节点为 MASTER， 对应的备份节点为 BACKUP    interface eth0   #绑定虚拟 IP 的网络接口，与本机 IP 地址所在的网络接口相同， 如：eth0，eth1。可通过ip addr查看    virtual_router_id 51  #虚拟路由的ID号，每个节点设置必须一样，可选择IP最后一段使用，相同的 VRID 为一个组，他将决定多播的 MAC 地址。MASTER和BACKUP必须是一致的,范围是0-255.    priority 100   #指定优先级，优先级高的将成为MASTER。    advert_int 1    # 设定MASTER与BACKUP负载均衡器之间同步检查的时间间隔，单位是秒    authentication {   # 验证类型和验证密码,主从必须一样        auth_type PASS   #设置vrrp验证类型，主要有PASS和AH两种        auth_pass 1111   #设置vrrp验证密码，在同一个vrrp_instance下，MASTER与BACKUP必须使用相同的密码才能正常通信    }    #虚拟 IP 池, 两个节点设置必须一样    virtual_ipaddress {        192.168.200.16          192.168.200.17   虚拟 ip，可以定义多个        192.168.200.18    }}#定义一个虚拟服务器，这个ip是virtual_ipaddress中定义的其中一个，后面一个空格，然后加上虚拟服务的端口号。virtual_server 192.168.200.100 443 {    #VIP地址，要和vrrp_instance模块中的virtual_ipaddress地址一致    delay_loop 6   #健康检查时间间隔，单位：秒    lb_algo rr  # 负载均衡调度算法，互联网应用常用方式为wlc或rr。rr|wrr|lc|wlc|lblc|sh|dh     lb_kind NAT  #负载均衡转发规则NAT|DR|RUN     persistence_timeout 50  #会话保持时间     protocol TCP  #转发协议，分为TCP和UDP两种    sorry_server 192.168.200.200 1358    #备用机，所有realserver失效后启用    #真实服务器IP和端口，可以定义多个    real_server 192.168.201.100 443 {        weight 1  #  负载权重，值越大，转发的优先级越高        SSL_GET {            url {  #检查url，可以指定多个              path /                digest ff20ad2481f97b1754ef3e12ecd3a9cc  #检查后的摘要信息            }            url {              path /mrtg/              digest 9b3a0c85a887a256d6939da88aabd8cd            }            connect_timeout 3  #连接超时时间            retry 3            delay_before_retry 3  #重连间隔时间        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">6.</b>&nbsp;&nbsp;修改keepalived配置文件</p><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/keepalived/keepalived.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>&nbsp;&nbsp;<b style="font-size:16px;">6.1</b>&nbsp;&nbsp;MASTER 节点配置文件（192.168.178.129）</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_one  #标识本节点的字条串，通常为 hostname}# keepalived 会定时执行脚本并对脚本执行的结果进行分析，动态调整 vrrp_instance 的优先级。如果脚本执行结果为 0，并且 weight 配置的值大于 0，则优先级相应的增加。如果脚本执行结果非 0，并且 weight配置的值小于 0，则优先级相应的减少。其他情况，维持原本配置的优先级，即配置文件中 priority 对应的值。vrrp_script chk_nginx{    script "/etc/keepalived/nginx_check.sh"  #检测nginx状态脚本路径    interval 2  #检测时间间隔    weight -20  #如果条件成立，权重-20}#定义虚拟路由，VI_I为虚拟路由标示符，自己定义vrrp_instance VI_1 {    state MASTER      #主节点为MASTER ,对应的备份节点是BACKUP    interface ens33  #绑定虚拟IP的网络接口，与本机的IP地址所在的网卡接口相同    virtual_router_id 51  #虚拟路由的ID号，两个节点必须一致    mcast_src_ip 192.168.178.129 ## 本机 IP 地址    priority 100   #节点优先级，范围在0-254     nopreempt  #优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题    advert_int 1  # 组播信息发送间隔，两个节点设置必须一样， 默认 1s    # 设置验证信息，两个节点必须一致    authentication {        auth_type PASS        auth_pass 1111    }    #将 track_script 块加入 instance 配置块    track_script{        chk_nginx   # 执行 Nginx 监控的服务    }    # 虚拟 IP 池, 两个节点设置必须一样    virtual_ipaddress {        192.168.178.125   # 虚拟IP，可以定义多个    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>&nbsp;&nbsp;<b style="font-size:16px;">6.2</b>&nbsp;&nbsp;BACKUP  节点配置文件（192.168.178.130）</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_two}vrrp_script chk_nginx{        script "/etc/keepalived/nginx_check.sh"        interval 2        weight -20}vrrp_instance VI_1 {    state BACKUP    interface ens33    virtual_router_id 51    mcast_src_ip 192.168.178.130    priority 90    nopreempt    advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script{        chk_nginx    }       virtual_ipaddress {        192.168.178.125    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="编写-Nginx-状态检测脚本"><a href="#编写-Nginx-状态检测脚本" class="headerlink" title="编写 Nginx 状态检测脚本"></a>编写 Nginx 状态检测脚本</h2><p>编写 Nginx 状态检测脚本 /etc/keepalived/nginx_check.sh (已在 keepalived.conf 中配置)脚本要求：如果 nginx 停止运行，尝试启动，如果无法启动则杀死本机的 keepalived 进程， keepalied将虚拟 ip 绑定到 BACKUP 机器上。 内容如下：</p><pre class="line-numbers language-ini"><code class="language-ini"># 编辑nginx_check.sh文件vi /etc/keepalived/nginx_check.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-ini"><code class="language-ini">#!/bin/bash<span class="token constant">A</span><span class="token attr-value"><span class="token punctuation">=</span>`ps -C nginx –no-header |wc -l`</span>if [ $A -eq 0 ];then/usr/local/nginx/sbin/nginx  sleep 2if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then    killall keepalivedfifi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>保存后，给脚本赋执行权限： </p><pre class="line-numbers language-ini"><code class="language-ini">chmod +x /etc/keepalived/nginx_check.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="启动-Keepalived"><a href="#启动-Keepalived" class="headerlink" title="启动 Keepalived"></a>启动 Keepalived</h2><pre class="line-numbers language-ini"><code class="language-ini">service keepalived start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502152245.png" alt="Starting keepalived: [ OK ]"></p><h2 id="Keepalived-Nginx-的高可用测试"><a href="#Keepalived-Nginx-的高可用测试" class="headerlink" title="Keepalived+Nginx 的高可用测试"></a>Keepalived+Nginx 的高可用测试</h2><p><span style="font-size:18px;"><b>1.<b></b></b></span>同时启动192.168.178.129和192.168.178.130上的Nginx和Keepalived，我们通过VIP(192.168.178.125)来访问Nginx,如下：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502165703.png" alt></p><p><span style="font-size:18px;"><b>2.<b></b></b></span>我们关闭192.168.178.129上的Keepalived和Nginx</p><pre class="line-numbers language-ini"><code class="language-ini">service keepalived stop/usr/sbin/nginx -s stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>3.<b></b></b></span>此时，再通过VIP(192.168.178.125)来访问Nginx,如下<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502173819.png" alt><br>我这个显示结果和上面一样是因为我这台服务器没绑，结果是成功得。</p><p><span style="font-size:18px;"><b>4.<b></b></b></span>我们再开启192.168.178.129上的Keepalived和Nginx</p><pre class="line-numbers language-ini"><code class="language-ini">/usr/sbin/nginxservice keepalived start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或者只执行</p><pre class="line-numbers language-ini"><code class="language-ini">service keepalived start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为我们写了脚本nginx_check.sh，这个脚本会为我们自动启动nginx<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502181315.png" alt></p><p>到此为止,keepalived+nginx实现高可用web负载均衡搭建完毕。</p><p>参考：<br>(主参考)<a href="https://blog.csdn.net/l1028386804/article/details/72801492" target="_blank" rel="noopener">https://blog.csdn.net/l1028386804/article/details/72801492</a><br>(附参考)<a href="https://blog.csdn.net/u012599988/article/details/82152224?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3" target="_blank" rel="noopener">https://blog.csdn.net/u012599988/article/details/82152224?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3</a><br>(主配置详解参考)<a href="https://blog.csdn.net/mofiu/article/details/76644012" target="_blank" rel="noopener">https://blog.csdn.net/mofiu/article/details/76644012</a><br>(附配置详解参考)<a href="https://www.cnblogs.com/along1226/p/5027838.html" target="_blank" rel="noopener">https://www.cnblogs.com/along1226/p/5027838.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="keepalived" scheme="https://chiwai.tang99.club/categories/keepalived/"/>
    
    
      <category term="keepalived" scheme="https://chiwai.tang99.club/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>Linux下安装nginx</title>
    <link href="https://chiwai.tang99.club/posts/3979785611.html"/>
    <id>https://chiwai.tang99.club/posts/3979785611.html</id>
    <published>2020-04-10T17:27:23.000Z</published>
    <updated>2020-05-03T11:12:51.987Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux-下安装nginx"><a href="#Linux-下安装nginx" class="headerlink" title="Linux 下安装nginx"></a>Linux 下安装nginx</h1><p>两种安装方式:第一种是通过nginx官网提供的存储库安装，第二种是编译安装。</p><h1 id="yum存储库安装nginx"><a href="#yum存储库安装nginx" class="headerlink" title="yum存储库安装nginx"></a>yum存储库安装nginx</h1><p><b style="font-size:18px;">1.</b>&nbsp;&nbsp;通过nginx官网安装最新稳定版nginx，上面提供了安装方法,地址:<a href="http://nginx.org/en/linux_packages.html#stable" target="_blank" rel="noopener">http://nginx.org/en/linux_packages.html#stable</a></p><p><b style="font-size:18px;">2.</b>&nbsp;&nbsp;找到以下位置：</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428014416.png" alt><br><b style="font-size:16px;">2.1.</b>&nbsp;&nbsp;分为几种不同的操作系统安装方式，是CentOS系统就选CentOS的,然后执行以下命令。</p><pre class="line-numbers language-ini"><code class="language-ini">sudo yum install yum-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="color:red;">yum-utils</span>表示是用于管理yum 存储库，安装调试软件包，源软件包，来自存储库的扩展信息和管理的工具和程序的集合。</p><p><b style="font-size:16px;">2.2.</b>&nbsp;&nbsp;<span style="color:red;">To set up the yum repository, create the file named /etc/yum.repos.d/nginx.repo with the following contents</span></p><p>这句话的意思是在<code>/etc/yum.repos.d</code>这个目录下创建<code>nginx.repo</code>文件。</p><pre class="line-numbers language-ini"><code class="language-ini"># 创建nginx.repo文件touch nginx.repo   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>创建完之后将以下内容写入到<code>nginx.repo</code>文件。</p><p>其中<code>[nginx-stable]</code>表示稳定仓库，而<code>[nginx-mainline]</code>表示主线仓库，用哪个仓库写哪个仓库。</p><pre class="line-numbers language-ini"><code class="language-ini"># 将以下内容写入到nginx.repo文件。<span class="token selector">[nginx-stable]</span><span class="token constant">name</span><span class="token attr-value"><span class="token punctuation">=</span>nginx stable repo</span><span class="token constant">baseurl</span><span class="token attr-value"><span class="token punctuation">=</span>http://nginx.org/packages/centos/$releasever/$basearch/</span><span class="token constant">gpgcheck</span><span class="token attr-value"><span class="token punctuation">=</span>1</span><span class="token constant">enabled</span><span class="token attr-value"><span class="token punctuation">=</span>1</span><span class="token constant">gpgkey</span><span class="token attr-value"><span class="token punctuation">=</span>https://nginx.org/keys/nginx_signing.key</span><span class="token constant">module_hotfixes</span><span class="token attr-value"><span class="token punctuation">=</span>true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:16px;">2.3.</b>&nbsp;&nbsp;执行以下命令安装nginx</p><pre class="line-numbers language-ini"><code class="language-ini">sudo yum install nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:16px;">2.4.</b>&nbsp;&nbsp;查看nginx版本</p><pre class="line-numbers language-ini"><code class="language-ini"># 查看nginx版本nginx -v# 查看编译参数nginx -V<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:16px;">2.5.</b>&nbsp;&nbsp;查看安装目录</p><pre class="line-numbers language-ini"><code class="language-ini">rpm -ql nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">3.</b>&nbsp;&nbsp;一键安装依赖包，执行以下命令:</p><pre class="line-numbers language-ini"><code class="language-ini">yum -y install gcc pcre-devel zlib-devel openssl openssl-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">4.</b>&nbsp;&nbsp;测试一下是否安装成功，进入<code>cd usr/sbin/</code>这个目录，不一定都是这个目录，根据你安装路径来确定。</p><pre class="line-numbers language-ini"><code class="language-ini">nginx -t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>出现以下内容，则成功<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428021621.png" alt="成功效果"></p><p><b style="font-size:18px;">5.</b>&nbsp;&nbsp;查看nginx进程是否启动：</p><pre class="line-numbers language-ini"><code class="language-ini">ps -ef | grep nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428021750.png" alt></p><p>如果没启动，启动nginx</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/sbin/# 启动nginx./nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">6.</b>&nbsp;&nbsp;这个时候，如果你想要在浏览器中访问nginx是访问不了的，因为你的80端口还没有启动。</p><p>验证80端口是否启动：</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --query-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428224920.png" alt="no表示没启动"></p><p><b style="font-size:18px;">7.</b>&nbsp;&nbsp;开启80端口,重启防火墙</p><pre class="line-numbers language-ini"><code class="language-ini"># 开端口, --permanent表示永久生效，没有此参数重启后失效firewall-cmd --add-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp --permanent </span># 重启防火墙systemctl restart firewalld     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428022324.png" alt="访问成功"></p><h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><p><b style="font-size:18px;">1.</b>&nbsp;&nbsp;一键安装依赖包，执行以下命令:</p><pre class="line-numbers language-ini"><code class="language-ini">yum -y install gcc pcre-devel zlib-devel openssl openssl-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">2.</b>&nbsp;&nbsp;在usr/local目录下新建nginx文件夹</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/localmkdir nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">3.</b>&nbsp;&nbsp;进入nginx文件夹，下载nginx的tar包，可以去<a href="http://nginx.org" target="_blank" rel="noopener">http://nginx.org</a> 里面找你想要的版本。</p><pre class="line-numbers language-ini"><code class="language-ini">cd nginxwget http://nginx.org/download/nginx-1.18.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">4.</b>&nbsp;&nbsp;解压tar</p><pre class="line-numbers language-ini"><code class="language-ini">tar -xvf nginx-1.18.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">5.</b>&nbsp;&nbsp;配置安装nginx，执行make，执行make install</p><pre class="line-numbers language-ini"><code class="language-ini">./configure --prefix<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/nginx</span>makemake install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">6.</b>&nbsp;&nbsp;测试是否安装成功,进入到刚才配置的安装目录</p><pre class="line-numbers language-ini"><code class="language-ini">./sbin/nginx -t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428224426.png" alt="安装成功!"></p><p><b style="font-size:18px;">7.</b>&nbsp;&nbsp;启动nginx</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/local/nginx/sbin# 启动nginx./nginx <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">8.</b>&nbsp;&nbsp;这个时候如果你去网页上输入ip地址是打不开的，因为你的80端口还没有启动。<br>因为我使用的linux系统版本是CentOS7，所以可以在服务器中执行如下命令来验证</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --query-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428224920.png" alt="no表示没启用"><br>显然80端口没有开启</p><p><b style="font-size:18px;">9.</b>&nbsp;&nbsp;开启80端口,重启防火墙</p><pre class="line-numbers language-ini"><code class="language-ini"># 开端口, --permanent表示永久生效，没有此参数重启后失效firewall-cmd --add-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp --permanent </span># 重启防火墙systemctl restart firewalld     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428225218.png" alt="访问成功!"></p><p><b style="font-size:18px;">10.</b>&nbsp;&nbsp;配置开机自启</p><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/rc.d/rc.local/usr/local/nginx/sbin/nginx   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428225728.png" alt></p><h1 id="常用命令说明"><a href="#常用命令说明" class="headerlink" title="常用命令说明:"></a>常用命令说明:</h1><p>nginx相关命令：<br>进入到安装目录中,<code>cd usr/sbin/</code>。</p><pre class="line-numbers language-ini"><code class="language-ini">./nginx 启动./nginx -s stop 关闭./nginx -s reload 重启<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>防火墙相关命令：</p><pre class="line-numbers language-ini"><code class="language-ini"># 重启防火墙systemctl restart firewalld  centOS6及以前版本使用命令： systemctl stop iptables.servicecentOS7关闭防火墙命令： systemctl stop firewalld.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考：<br><a href="https://www.cnblogs.com/xxoome/p/5866475.html" target="_blank" rel="noopener">https://www.cnblogs.com/xxoome/p/5866475.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="nginx" scheme="https://chiwai.tang99.club/categories/nginx/"/>
    
    
      <category term="安装nginx" scheme="https://chiwai.tang99.club/tags/%E5%AE%89%E8%A3%85nginx/"/>
    
  </entry>
  
  <entry>
    <title>centos7 ip addr 无法查看虚拟机IP解决办法</title>
    <link href="https://chiwai.tang99.club/posts/3053597239.html"/>
    <id>https://chiwai.tang99.club/posts/3053597239.html</id>
    <published>2020-04-10T13:12:11.000Z</published>
    <updated>2020-05-03T11:12:13.036Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="centos7-ip-addr-无法查看虚拟机IP解决办法"><a href="#centos7-ip-addr-无法查看虚拟机IP解决办法" class="headerlink" title="centos7 ip addr 无法查看虚拟机IP解决办法"></a>centos7 ip addr 无法查看虚拟机IP解决办法</h1><p>在centos7中查看ip地址，输入<code>ifconfig</code>命令会报以下错误:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/1587995740(1).jpg" alt></p><p>原因是centos7中已经不适用<code>ifconfig</code>命令。已经用<span style="color:red;">ip addr</span>命令代替，同时网卡名也由eth0改为eno。但是以往输入ip addr 会出现以下结果:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427223713.png" alt><br>会发现ens33没有inet这个属性，那么就没法通过IP地址连接虚拟机。</p><p>解决方式:<br>进入到网卡目录<br><code>cd /etc/sysconfig/network-scripts/</code><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427224125.png" alt><br>编辑<code>ifcfg-ens33</code>这个文件,输入<code>vi ifcfg-ens33</code><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427224547.png" alt></p><p>从以上配置信息中可以发现 CentOS 7 默认是不启动网卡的(ONBOOT=no),把这一项改为YES(ONBOOT=yes)即可。</p><p>然后重启网络服务： <code>sudo service network restart</code><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427224920.png" alt></p><p>重启后在输入<code>ip addr</code>命令后会看到ens33下面 inet后面就是ip地址</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;中间出现了个小插曲，虚拟机异常关机,再次打开后出现以下错误:<span style="color:red;">该虚拟机似乎正在使用中。如果该虚拟机未在使用，请按“获取所有权(T)”按钮获取它的所有权</span>的错误。</p><p>经过百度得知，这是虚拟机的锁机制导致，同时在虚拟机的安装目录生成带.lck后缀的文件名。</p><p>解决办法:<br><span style="color:red;">找到虚拟机的安装目录下，删除带有.lck的文件，重启虚拟机即可。</span></p><p>参考<br><a href="https://blog.csdn.net/anshengsuiyeu/article/details/83549438" target="_blank" rel="noopener">https://blog.csdn.net/anshengsuiyeu/article/details/83549438</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://chiwai.tang99.club/categories/Linux/"/>
    
    
      <category term="无法查看虚拟机IP解决办法" scheme="https://chiwai.tang99.club/tags/%E6%97%A0%E6%B3%95%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BAIP%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Linux Crontab 定时任务</title>
    <link href="https://chiwai.tang99.club/posts/2326891732.html"/>
    <id>https://chiwai.tang99.club/posts/2326891732.html</id>
    <published>2020-04-05T13:50:43.000Z</published>
    <updated>2020-05-03T11:10:25.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Linux-Crontab-定时任务"><a href="#Linux-Crontab-定时任务" class="headerlink" title="Linux Crontab 定时任务"></a>Linux Crontab 定时任务</h4><h2 id="语法"><a href="#语法" class="headerlink" title="语法:"></a>语法:</h2><p>crontab [-u username] [-l|-e|-r]&nbsp;&nbsp;&nbsp;&nbsp;</p><blockquote><p>省略用户[-u username]表示操作当前用户的crontab</p></blockquote><p>选项说明:<br>  -u指定一个用户<br>  -l列出某个用户的任务计划<br>  -r删除某个用户的任务<br>  -e编辑某个用户的任务</p><p>例如:<br>①root用户查看自己的cron设置:</p><pre class="line-numbers language-ini"><code class="language-ini">crontab -u root -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>②root想删除fred的cron设置:</p><pre class="line-numbers language-ini"><code class="language-ini">crontab -u fred -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>③表示查看当前用户cron设置</p><pre class="line-numbers language-ini"><code class="language-ini">crontab -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="编辑计划任务"><a href="#编辑计划任务" class="headerlink" title="编辑计划任务"></a>编辑计划任务</h2><ul><li>执行<code>crontab -e</code>进入当前用户的工作表编辑</li><li>计划任务的规则语法格式，以行为单位，一行则为一个计划。</li><li>格式：<code>分 时 日 月 周 需要执行的命令</code><br>例如：<br>如果想要每天0点0分执行reboot指令，则可以写成<br><code>0 0 * * * reboot</code></li></ul><h2 id="取值范围"><a href="#取值范围" class="headerlink" title="取值范围"></a>取值范围</h2><blockquote><p>分：0-59<br>时：0-23<br>日：1-31<br>月：1-12<br>周：0-7，0和7表示星期天</p></blockquote><h2 id="四个符号"><a href="#四个符号" class="headerlink" title="四个符号"></a>四个符号</h2><blockquote><p>*：表示取值范围中的每一个数字<br>-：做连续区间表达式，要想表示1-7，则可以写成：1-7<br>/：表示每多少个，例如：想每10分钟一次，则可以在分的位置写：*/10<br>,：表示多个取值，比如想在1点，2点，5点执行，则可以在时的位置写：1，2，6</p></blockquote><p>问题1：每月1、10、22日的4:45重启network服务<br><code>45 4 1,10,22 * * service network restart</code></p><p>问题2：每周六，周日的1:10重启network服务<br><code>10 1 * * 6,7 service network restart</code></p><p>问题3：每天18:00至23:00之间每隔30分钟重启network服务<br><code>/30 18-23 * * * service network restart</code></p><p>问题4：每隔两天的上午8点到11点的第3和第15分钟执行一次重启<br><code>3,15 8-11 */2 * * service network restart</code></p><p>案例：每1分钟往root家目录中rt.txt中输出一个1，使用追加的方式输出<br><code>*/1 * * * * echo &#39;1&#39; &gt;&gt; /root/rt.txt</code></p><blockquote><p>对于linux中&gt;跟 &gt;&gt; 区别 ，2&gt;&amp;1 是什么意思，参考以下文档说明<br><a href="https://blog.csdn.net/junge1545/article/details/80838554" target="_blank" rel="noopener">https://blog.csdn.net/junge1545/article/details/80838554</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://chiwai.tang99.club/categories/Linux/"/>
    
    
      <category term="定时任务" scheme="https://chiwai.tang99.club/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>微信公众号功能汇总</title>
    <link href="https://chiwai.tang99.club/posts/1881859890.html"/>
    <id>https://chiwai.tang99.club/posts/1881859890.html</id>
    <published>2020-03-20T08:39:25.000Z</published>
    <updated>2020-07-12T15:18:22.436Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="封装CURL请求方法"><a href="#封装CURL请求方法" class="headerlink" title="封装CURL请求方法"></a>封装CURL请求方法</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * @param $api 接口地址 * @param array $data 数据信息 * @param string $method 请求方法 * @param string $returnType 返回类型 */</span><span class="token keyword">function</span> <span class="token function">http_url</span><span class="token punctuation">(</span><span class="token variable">$api</span><span class="token punctuation">,</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$method</span> <span class="token operator">=</span> <span class="token string">"get"</span><span class="token punctuation">,</span><span class="token variable">$returnType</span> <span class="token operator">=</span> <span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//开启会话</span>    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//设置url</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span><span class="token variable">$api</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//设置数据流不直接输出</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//规避ssl证书检查</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYPEER</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//跳过host验证</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYHOST</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">!=</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//如果你想PHP去做一个正规的HTTP POST，设置这个选项为一个非零值</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_POST</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//传递一个作为HTTP “POST”操作的所有数据的字符串。</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//执行会话</span>    <span class="token variable">$jsonInfo</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//关闭会话</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$returnType</span> <span class="token operator">==</span> <span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$jsonInfo</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$jsonInfo</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Redis缓存获取access-token"><a href="#Redis缓存获取access-token" class="headerlink" title="Redis缓存获取access_token"></a>Redis缓存获取access_token</h1><blockquote><p>access_token的有效期为2小时，每天请求次数有限，所以存到redis里面。</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">get_access_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//微信appid</span>    <span class="token variable">$appid</span> <span class="token operator">=</span> <span class="token string">'你的微信appid'</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//用户唯一凭证密钥</span>    <span class="token variable">$secret</span> <span class="token operator">=</span> <span class="token string">'你的密钥'</span><span class="token punctuation">;</span>    <span class="token variable">$get_access_token</span> <span class="token operator">=</span> \<span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'get_access_token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$get_access_token</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$api</span> <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid='.$appid .'&amp;secret='.$secret;</span>        <span class="token variable">$get_access_token</span> <span class="token operator">=</span> <span class="token function">http_url</span><span class="token punctuation">(</span><span class="token variable">$api</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        \<span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token string">'get_access_token'</span><span class="token punctuation">,</span><span class="token number">7200</span><span class="token punctuation">,</span><span class="token variable">$get_access_token</span><span class="token punctuation">[</span><span class="token string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$get_access_token</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="微信服务器验证token信息"><a href="#微信服务器验证token信息" class="headerlink" title="微信服务器验证token信息"></a>微信服务器验证token信息</h1><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//微信开发者token</span>    <span class="token keyword">private</span> <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token string">'vXfY8RugnWWy1hG6HOoVu9xxxxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//如果存在，说明时检验公众号</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'echostr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//校验公众号</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checkout</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 检验微信公众号     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证消息的确来自微信服务器</span>        <span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'signature'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数。</span>        <span class="token variable">$timestamp</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'timestamp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//时间戳</span>        <span class="token variable">$nonce</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'nonce'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//随机数</span>        <span class="token variable">$echostr</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'echostr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//随机字符串</span>        <span class="token comment" spellcheck="true">//1）将token、timestamp、nonce三个参数进行字典序排序</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$timestamp</span><span class="token punctuation">,</span> <span class="token variable">$nonce</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 2）将三个参数字符串拼接成一个字符串进行sha1加密</span>        <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 3）开发者获得加密后的字符串可与signature对比，标识该请求来源于微信</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$signature</span> <span class="token operator">===</span> <span class="token variable">$temp</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$echostr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$echostr</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/1.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="微信公众号" scheme="https://chiwai.tang99.club/categories/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/"/>
    
    
      <category term="汇总" scheme="https://chiwai.tang99.club/tags/%E6%B1%87%E6%80%BB/"/>
    
  </entry>
  
  <entry>
    <title>git操作实战</title>
    <link href="https://chiwai.tang99.club/posts/3559721766.html"/>
    <id>https://chiwai.tang99.club/posts/3559721766.html</id>
    <published>2020-03-15T04:26:41.000Z</published>
    <updated>2020-05-03T11:07:01.799Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;实战模拟场景说明，创建<span style="color:red;">w1(组长)</span>,<span style="color:red;">w2(组员)</span>两个工作区。</p><h1 id="1-组长在w1工作区搭建一个Laravel项目。"><a href="#1-组长在w1工作区搭建一个Laravel项目。" class="headerlink" title="1.组长在w1工作区搭建一个Laravel项目。"></a>1.组长在w1工作区搭建一个Laravel项目。</h1><h2 id="1-1安装laravel命令"><a href="#1-1安装laravel命令" class="headerlink" title="1.1安装laravel命令"></a>1.1安装laravel命令</h2><pre class="line-numbers language-text"><code class="language-text">Composer create-project Laravel/Laravel=5.5.* --prefer-dist mylaravel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-2本地项目创建git仓库"><a href="#1-2本地项目创建git仓库" class="headerlink" title="1.2本地项目创建git仓库"></a>1.2本地项目创建git仓库</h2><p>进入项目目录，执行<b>git init</b>命令<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417152128.png" alt="本地创建git仓库"><br>仓库创建好以后，会在本地生成.git文件夹。</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417152159.png" alt></p><h2 id="1-3将项目从工作区加入暂存区"><a href="#1-3将项目从工作区加入暂存区" class="headerlink" title="1.3将项目从工作区加入暂存区"></a>1.3将项目从工作区加入暂存区</h2><pre class="line-numbers language-text"><code class="language-text">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看当前操作状态</p><pre class="line-numbers language-text"><code class="language-text">git status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417153329.png" alt="会看到刚才加入到暂存区的文件"></p><h2 id="1-4将暂存区加入到版本库"><a href="#1-4将暂存区加入到版本库" class="headerlink" title="1.4将暂存区加入到版本库"></a>1.4将暂存区加入到版本库</h2><pre class="line-numbers language-text"><code class="language-text">git commit -m '初始化laravel项目'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-5将项目添加到远程仓库"><a href="#1-5将项目添加到远程仓库" class="headerlink" title="1.5将项目添加到远程仓库"></a>1.5将项目添加到远程仓库</h2><p>先去GitHub上创建一个远程仓库,创建好之后，在仓库中会显示你以什么样的方式提交说明。</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417153400.png" alt></p><h2 id="1-6本地仓库与远程仓库建立连接"><a href="#1-6本地仓库与远程仓库建立连接" class="headerlink" title="1.6本地仓库与远程仓库建立连接"></a>1.6本地仓库与远程仓库建立连接</h2><pre class="line-numbers language-text"><code class="language-text">git remote add origin git@github.com：zhiweiUU9 / mylaravel.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-7将本地仓库的内容上传到远程仓库"><a href="#1-7将本地仓库的内容上传到远程仓库" class="headerlink" title="1.7将本地仓库的内容上传到远程仓库"></a>1.7将本地仓库的内容上传到远程仓库</h2><pre class="line-numbers language-text"><code class="language-text">git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果出现错误<span style="color:red;">fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists.</span></p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417153429.png" alt="错误提示"></p><p>解决方法:</p><h3 id="1-7-1-检查中文符号和空格"><a href="#1-7-1-检查中文符号和空格" class="headerlink" title="1.7.1 检查中文符号和空格"></a>1.7.1 检查中文符号和空格</h3><p>先检查第<b>1.6</b>项本地与远程仓库建立连接时复制的git命令不能有中文符号或空格。</p><h3 id="1-7-2-检验ssh"><a href="#1-7-2-检验ssh" class="headerlink" title="1.7.2 检验ssh"></a>1.7.2 检验ssh</h3><p>如果git命令没有问题，检查是否生成ssh并添加到GitHub上。</p><pre class="line-numbers language-text"><code class="language-text">//查看是否生成过密钥ls -al ~/.ssh/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果存在，执行以下命令将内容复制添加到GitHub的ssh上，然后在执行<b>1.7</b>项，看看是否还报错。</p><pre class="line-numbers language-ini"><code class="language-ini">cat ~/.ssh/id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果不存在，看<b>1.7.3</b>项</p><h3 id="1-7-3-生成ssh"><a href="#1-7-3-生成ssh" class="headerlink" title="1.7.3 生成ssh"></a>1.7.3 生成ssh</h3><p>第一步：先验证一下用户名邮箱</p><pre class="line-numbers language-ini"><code class="language-ini">git config --global --list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二步：设置全局用户名和邮箱</p><pre class="line-numbers language-ini"><code class="language-ini">git config --global user.name "your name"git config --global user.email "your email"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>第三步：生成密钥</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-keygen -t rsa -C "这里换上你的邮箱"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第四步：复制密钥到GitHub上，然后在执行<b>1.7</b>项，看看是否还报错。</p><p>如果还报错，看1.7.4</p><h3 id="1-7-4-继续报错解决"><a href="#1-7-4-继续报错解决" class="headerlink" title="1.7.4 继续报错解决"></a>1.7.4 继续报错解决</h3><p>首先执行以下代码测试一下</p><pre class="line-numbers language-ini"><code class="language-ini">ssh git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>出现错误：<span style="color:red">Warning: Permanently added the RSA host key for IP address ‘13.250.000.000’ to the list of known hosts.PTY allocation request failed on channel 0</span><br>大概意思就是这个IP地址RSA主机密钥永久的添加到了你的主机列表中，您已经成功地进行了身份验证，但GITHUB不提供shell访问。</p><p>解决办法：<br>第一步：测试ssh连接是否成功</p><pre class="line-numbers language-ini"><code class="language-ini">ssh -v git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二步：<br>先执行:</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-agent -s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在执行:</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-add ~/.ssh/id_rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果出现错误:<span>Could not open a connection to your authentication agent</span><br>执行下面命令，然后再执行一遍(ssh-add ~/.ssh/id_rsa)命令</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-agent bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后</p><pre class="line-numbers language-ini"><code class="language-ini">ssh -T git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="color:red;">Hi nitt! You’ve successfully authenticated, but GitHub does not provide shell access.</span><br>到这里的时候就完事了，然后再去执行<b>1.7</b>项，就完事了。<br>错误问题参考资料：<br><a href="https://www.cnblogs.com/jenkin1991/p/9604054.html" target="_blank" rel="noopener">https://www.cnblogs.com/jenkin1991/p/9604054.html</a><br><a href="https://www.cnblogs.com/sheldonxu/archive/2012/09/17/2688281.html" target="_blank" rel="noopener">https://www.cnblogs.com/sheldonxu/archive/2012/09/17/2688281.html</a></p><h1 id="2-组员在w2工作区进行项目功能开发"><a href="#2-组员在w2工作区进行项目功能开发" class="headerlink" title="2.组员在w2工作区进行项目功能开发"></a>2.组员在w2工作区进行项目功能开发</h1><h2 id="2-1克隆项目到本地"><a href="#2-1克隆项目到本地" class="headerlink" title="2.1克隆项目到本地"></a>2.1克隆项目到本地</h2><p>在远端仓库获取仓库地址，然后执行</p><pre class="line-numbers language-ini"><code class="language-ini">git clone https://github.com/****/mylaravel.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>由于从git拉取下来的项目缺少vendor目录，需要重新下</p><pre class="line-numbers language-ini"><code class="language-ini">cd mylaravelcomposer install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="3-场景模拟"><a href="#3-场景模拟" class="headerlink" title="3.场景模拟"></a>3.场景模拟</h1><h2 id="3-1-组长在-readme-md创建内容"><a href="#3-1-组长在-readme-md创建内容" class="headerlink" title="3.1 组长在 readme.md创建内容"></a>3.1 组长在 <span style="color:red;">readme.md</span>创建内容</h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417154114.png" alt></p><h3 id="3-1-1将修改的内容提交到暂存区"><a href="#3-1-1将修改的内容提交到暂存区" class="headerlink" title="3.1.1将修改的内容提交到暂存区"></a>3.1.1将修改的内容提交到暂存区</h3><pre class="line-numbers language-ini"><code class="language-ini">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-1-2将暂存区的文件提交到版本库"><a href="#3-1-2将暂存区的文件提交到版本库" class="headerlink" title="3.1.2将暂存区的文件提交到版本库"></a>3.1.2将暂存区的文件提交到版本库</h3><pre class="line-numbers language-ini"><code class="language-ini">git commit -m "组长添加内容到readme.md文件"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-1-3提交到远程仓库"><a href="#3-1-3提交到远程仓库" class="headerlink" title="3.1.3提交到远程仓库"></a>3.1.3提交到远程仓库</h3><pre class="line-numbers language-ini"><code class="language-ini">git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-2-组员也在-readme-md创建内容"><a href="#3-2-组员也在-readme-md创建内容" class="headerlink" title="3.2 组员也在 readme.md创建内容"></a>3.2 组员也在 <span style="color:red;">readme.md</span>创建内容</h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417154547.png" alt></p><h3 id="3-2-1将修改的内容提交到暂存区"><a href="#3-2-1将修改的内容提交到暂存区" class="headerlink" title="3.2.1将修改的内容提交到暂存区"></a>3.2.1将修改的内容提交到暂存区</h3><pre class="line-numbers language-ini"><code class="language-ini">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-2将暂存区的文件提交到版本库"><a href="#3-2-2将暂存区的文件提交到版本库" class="headerlink" title="3.2.2将暂存区的文件提交到版本库"></a>3.2.2将暂存区的文件提交到版本库</h3><pre class="line-numbers language-ini"><code class="language-ini">git commit -m "组员添加内容到readme.md文件"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-3那么问题来了，组员使用什么分支提交呢？"><a href="#3-2-3那么问题来了，组员使用什么分支提交呢？" class="headerlink" title="3.2.3那么问题来了，组员使用什么分支提交呢？"></a>3.2.3那么问题来了，组员使用什么分支提交呢？</h3><p>查看当前分支</p><pre class="line-numbers language-ini"><code class="language-ini">git branch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果：<span style="color:red">* master</span><br>会显示到当前使用的master分支，如果组长和组员都推送到master分支，那么会存在冲突问题,解决创建新的分支</p><p>创建zhangsan分支</p><pre class="line-numbers language-ini"><code class="language-ini">git branch zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后切换到zhangsan分支</p><pre class="line-numbers language-ini"><code class="language-ini">git checkout zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后提交到远程仓库</p><pre class="line-numbers language-ini"><code class="language-ini">git push -u origin zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-3组长合并分支"><a href="#3-3组长合并分支" class="headerlink" title="3.3组长合并分支"></a>3.3组长合并分支</h2><h3 id="3-3-1-先查看一下服务器有哪些分支更新，并拉取到本地"><a href="#3-3-1-先查看一下服务器有哪些分支更新，并拉取到本地" class="headerlink" title="3.3.1 先查看一下服务器有哪些分支更新，并拉取到本地"></a>3.3.1 先查看一下服务器有哪些分支更新，并拉取到本地</h3><pre class="line-numbers language-ini"><code class="language-ini">git fetch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-2-然后合并zhangsan的分支"><a href="#3-3-2-然后合并zhangsan的分支" class="headerlink" title="3.3.2 然后合并zhangsan的分支"></a>3.3.2 然后合并zhangsan的分支</h3><pre class="line-numbers language-ini"><code class="language-ini">git merge origin/zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417160650.png" alt></p><h3 id="3-3-3-然后查看一下是否有冲突"><a href="#3-3-3-然后查看一下是否有冲突" class="headerlink" title="3.3.3 然后查看一下是否有冲突"></a>3.3.3 然后查看一下是否有冲突</h3><pre class="line-numbers language-ini"><code class="language-ini">git diff<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-4-如果没有冲突，组长把合并文件推送到服务器master分支"><a href="#3-3-4-如果没有冲突，组长把合并文件推送到服务器master分支" class="headerlink" title="3.3.4 如果没有冲突，组长把合并文件推送到服务器master分支"></a>3.3.4 如果没有冲突，组长把合并文件推送到服务器master分支</h3><pre class="line-numbers language-ini"><code class="language-ini">git push origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-4-组员拉取组长合并完的内容"><a href="#3-4-组员拉取组长合并完的内容" class="headerlink" title="3.4 组员拉取组长合并完的内容"></a>3.4 组员拉取组长合并完的内容</h2><h3 id="3-4-1-先查看一下是否有最新提交并拉取到本地"><a href="#3-4-1-先查看一下是否有最新提交并拉取到本地" class="headerlink" title="3.4.1 先查看一下是否有最新提交并拉取到本地"></a>3.4.1 先查看一下是否有最新提交并拉取到本地</h3><pre class="line-numbers language-ini"><code class="language-ini">git fetch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-4-2-组员合并分支"><a href="#3-4-2-组员合并分支" class="headerlink" title="3.4.2 组员合并分支"></a>3.4.2 组员合并分支</h3><pre class="line-numbers language-ini"><code class="language-ini">git merge origin/master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-4-3-然后查看一下是否有冲突"><a href="#3-4-3-然后查看一下是否有冲突" class="headerlink" title="3.4.3 然后查看一下是否有冲突"></a>3.4.3 然后查看一下是否有冲突</h3><pre class="line-numbers language-ini"><code class="language-ini">git diff<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后组员开发完进行提交，提交到远程服务器后，组长fetch一下，然后组长进行merge合并，合并完之后看看diff有无冲突，没有冲突add，然后commit，然后push<br>到master远程，然后组员fetch，然后组员merge，然后开发，add，commit，push到zhangsan分支，以此类推，情况而定。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Git" scheme="https://chiwai.tang99.club/categories/Git/"/>
    
    
      <category term="Git实战" scheme="https://chiwai.tang99.club/tags/Git%E5%AE%9E%E6%88%98/"/>
    
  </entry>
  
  <entry>
    <title>openlayers3简单demo实现</title>
    <link href="https://chiwai.tang99.club/posts/2687365199.html"/>
    <id>https://chiwai.tang99.club/posts/2687365199.html</id>
    <published>2020-03-13T01:34:02.000Z</published>
    <updated>2020-03-16T08:05:31.160Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;OpenLayers 初始化一幅地图(map)，至少需要一个可视区域(view)，一个或多个图层( layer)， 和 一个地图加载的目标 HTML 标签(target)，其中最重要的是图层( layer)。<br>&nbsp;&nbsp;&nbsp;&nbsp;其中Source和Layer是一对一的关系，有一个Source，必然需要一个Layer，然后把这个Layer添加到Map上，就可以显示出来了。通过官网的API搜索ol.source可以发现有很多不同的Source，但归纳起来共三种：ol.source.Tile，ol.source.Image和ol.source.Vector。</p><h2 id="可视区域"><a href="#可视区域" class="headerlink" title="可视区域"></a>可视区域</h2><pre class="line-numbers language-html"><code class="language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span><span class="token number">800</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="初始化图层"><a href="#初始化图层" class="headerlink" title="初始化图层"></a>初始化图层</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//初始化图层</span><span class="token function">bindmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 创建地图</span>    that<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        target<span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>        renderer<span class="token punctuation">:</span> <span class="token string">'canvas'</span><span class="token punctuation">,</span>        controls<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            zoom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            attribution<span class="token punctuation">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        logo<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        view<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">117.0</span><span class="token punctuation">,</span> <span class="token number">39.77</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">//设置香河为中心点，此处进行坐标转换， 把EPSG:4326的坐标，转换为EPSG:3857坐标，因为ol默认使用的是EPSG:38 57坐标</span>            <span class="token comment" spellcheck="true">// center: ol.proj.transform([117.0, 39.77], 'EPSG:4326', 'EPSG:3857'),</span>            projection<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"EPSG:4326"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// extent:[0,0,117.0,39.77],</span>            <span class="token comment" spellcheck="true">// minZoom:7,</span>            <span class="token comment" spellcheck="true">// maxZoom:18,</span>            zoom<span class="token punctuation">:</span> <span class="token number">12</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 设置地图图层</span>    <span class="token comment" spellcheck="true">// 创建一个使用Open Street Map地图源的瓦片图层</span>    <span class="token keyword">let</span> layers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        source<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// source: new ol.source.TileSuperMapRest({</span>        <span class="token comment" spellcheck="true">//     url: 'http://000.000.000.00:45622/iserver/services/map-HT_Map_SL/rest/maps/HT_Map_Blue',</span>        <span class="token comment" spellcheck="true">//     wrapX: false,</span>        <span class="token comment" spellcheck="true">//     transparent: true</span>        <span class="token comment" spellcheck="true">// })</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    that<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>layers<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成地图点位信息"><a href="#生成地图点位信息" class="headerlink" title="生成地图点位信息"></a>生成地图点位信息</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 创建地图点位信息  */</span><span class="token function">createMark</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> Features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> option<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> startMarker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span> <span class="token string">"p1"</span><span class="token punctuation">,</span>            type<span class="token punctuation">:</span> <span class="token string">"icon"</span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>            geometry<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>point<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Features<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>startMarker<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// var vectorSource = new ol.source.Vector({});</span>        <span class="token comment" spellcheck="true">// vectorSource.addFeature(startMarker);</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        source<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            features<span class="token punctuation">:</span> Features        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Icon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                anchor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                src<span class="token punctuation">:</span> option<span class="token punctuation">.</span>src<span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">// size: [50, 20],</span>                scale<span class="token punctuation">:</span> <span class="token number">1</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        visible<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>    that<span class="token punctuation">.</span>layer_list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// type: option.p1id,</span>        <span class="token comment" spellcheck="true">// type2: option.p2id,</span>        layer<span class="token punctuation">:</span> vectorLayer<span class="token punctuation">,</span>        show<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//地图点位点击事件</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> feature <span class="token operator">=</span> that<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">forEachFeatureAtPixel</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>pixel<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>            feature<span class="token punctuation">,</span>            layer        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> feature<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> feature<span class="token punctuation">.</span>N<span class="token punctuation">;</span>        that<span class="token punctuation">.</span>info <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">;</span>        that<span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//data 为 写入的数据</span>        <span class="token comment" spellcheck="true">// that.tu_list = data.data.info;</span>        <span class="token comment" spellcheck="true">// that.showtable = true;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//pc端加载页面时窗口大小发生变化，导致无法点击点位信息</span>    window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成多边形"><a href="#生成多边形" class="headerlink" title="生成多边形"></a>生成多边形</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 根据点位生成多边形 */</span><span class="token function">createPolygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>SList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> _points <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//点位</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token keyword">in</span> _points<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span> wrapX<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//创建用于绘制形状的图层</span>            <span class="token keyword">var</span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                source<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>siteStyle<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置图层样式</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将图层添加至地图</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>mapLayer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//获取点位对象</span>            <span class="token comment" spellcheck="true">// console.log(_points);</span>            <span class="token keyword">var</span> feature <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                geometry<span class="token punctuation">:</span> geometry            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//点位转换为图形对象</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addFeatures</span><span class="token punctuation">(</span><span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将图形添加至目标图层</span>            c<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="获取图形坐标值"><a href="#获取图形坐标值" class="headerlink" title="获取图形坐标值"></a>获取图形坐标值</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* * 获取图形值 */</span><span class="token function">getMapInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token function">postRequest</span><span class="token punctuation">(</span><span class="token string">'/Huanbao/getMapPoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            that<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            that<span class="token punctuation">.</span>pointList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            that<span class="token punctuation">.</span>siteStyle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                that<span class="token punctuation">.</span>pointList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lnglat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">let</span> color <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"rgb("</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/ /g</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>siteStyle<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>                    <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                        fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            color<span class="token punctuation">:</span>                                <span class="token string">"rgba("</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">","</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">","</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">",0.1)"</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">// color:</span>                            <span class="token comment" spellcheck="true">//     "rgba(" +</span>                            <span class="token comment" spellcheck="true">//     color[0] +</span>                            <span class="token comment" spellcheck="true">//     "," +</span>                            <span class="token comment" spellcheck="true">//     color[1] +</span>                            <span class="token comment" spellcheck="true">//     "," +</span>                            <span class="token comment" spellcheck="true">//     color[2] +</span>                            <span class="token comment" spellcheck="true">//     ",0.8)",</span>                            color<span class="token punctuation">:</span> that<span class="token punctuation">.</span>color1<span class="token punctuation">,</span>                            width<span class="token punctuation">:</span> <span class="token number">1</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token comment" spellcheck="true">//在地图上显示文字信息</span>                        text<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                             text<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentName<span class="token punctuation">,</span>                             scale<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">,</span>                             fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                               color<span class="token punctuation">:</span> <span class="token string">'#000000'</span>                             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                             stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                               color<span class="token punctuation">:</span> <span class="token string">'#FFFF99'</span><span class="token punctuation">,</span>                               width<span class="token punctuation">:</span> <span class="token number">3.5</span>                             <span class="token punctuation">}</span><span class="token punctuation">)</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            that<span class="token punctuation">.</span><span class="token function">createPolygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="根据经纬度定位"><a href="#根据经纬度定位" class="headerlink" title="根据经纬度定位"></a>根据经纬度定位</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @param {array} viewCenter 经纬度 * @param {int} viewZoom * 根据经纬度定位 */</span><span class="token function">changeMapView</span><span class="token punctuation">(</span>viewCenter<span class="token punctuation">,</span> viewZoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> viewOptions <span class="token operator">=</span> <span class="token punctuation">{</span>        duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>        center<span class="token punctuation">:</span> viewCenter<span class="token punctuation">,</span>        zoom<span class="token punctuation">:</span> viewZoom    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>viewOptions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="地图放大"><a href="#地图放大" class="headerlink" title="地图放大"></a>地图放大</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="地图缩小"><a href="#地图缩小" class="headerlink" title="地图缩小"></a>地图缩小</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="回到起始位置"><a href="#回到起始位置" class="headerlink" title="回到起始位置"></a>回到起始位置</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">initAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeMapView</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">117.0</span><span class="token punctuation">,</span> <span class="token number">39.77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>参考附件下载<br><a href="/download/index.vue" ">点击下载</a><br><a href="/download/index1.vue" ">点击下载</a><br><a href="/download/index2.vue" ">点击下载</a></p><blockquote><p>参考资料:<br><a href="https://www.cnblogs.com/benmumu/p/8081068.html" target="_blank" rel="noopener">https://www.cnblogs.com/benmumu/p/8081068.html</a><br><a href="https://blog.csdn.net/qingyafan/article/details/45398131" target="_blank" rel="noopener">https://blog.csdn.net/qingyafan/article/details/45398131</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="地图" scheme="https://chiwai.tang99.club/categories/%E5%9C%B0%E5%9B%BE/"/>
    
    
      <category term="Openlayers3" scheme="https://chiwai.tang99.club/tags/Openlayers3/"/>
    
  </entry>
  
  <entry>
    <title>Windows2012安装IIS中.NET Framework3.5报错</title>
    <link href="https://chiwai.tang99.club/posts/724213894.html"/>
    <id>https://chiwai.tang99.club/posts/724213894.html</id>
    <published>2020-03-06T13:29:36.000Z</published>
    <updated>2020-04-17T04:29:25.517Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Windows2012安装IIS中-NET-Framework3-5报错"><a href="#Windows2012安装IIS中-NET-Framework3-5报错" class="headerlink" title="Windows2012安装IIS中.NET Framework3.5报错"></a>Windows2012安装IIS中.NET Framework3.5报错</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;windows2012安装IIS中.net framework3.5报错，提示：安装安装一个或多个角色、角色服务或功能失败或者一个或多个安装选项在目标服务器上缺少源文件，或者找不到源文件等错误信息。<br>原因是.net framework3.5程序源文件找不到所导致的。<br>如图所示:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417122913.png" alt><br>解决方法为可以通过PowerShell 脚本进行安装。<br>1.在开始菜单中找到PowerShell，右键单击选择以管理员身份运行。<br>2.输入以下脚本，按回车执行。</p><pre class="line-numbers language-ini"><code class="language-ini">Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU' -Name UseWUServer -Value 0Restart-Service -Name wuauservInstall-WindowsFeature Net-Framework-CoreSet-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU' -Name UseWUServer -Value 1Restart-Service -Name wuauserv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此刻再回到服务管理器-&gt;添加角色功能-&gt;功能中，就看到.Net Framework 3.5安装成功。</p><p>参考文章:<br><a href="https://www.wanweiwang.cn/FAQ/view/1006.html" target="_blank" rel="noopener">https://www.wanweiwang.cn/FAQ/view/1006.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="服务器" scheme="https://chiwai.tang99.club/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="安装" scheme="https://chiwai.tang99.club/tags/%E5%AE%89%E8%A3%85/"/>
    
      <category term="IIS" scheme="https://chiwai.tang99.club/tags/IIS/"/>
    
  </entry>
  
  <entry>
    <title>PHP导入功能</title>
    <link href="https://chiwai.tang99.club/posts/549686560.html"/>
    <id>https://chiwai.tang99.club/posts/549686560.html</id>
    <published>2020-03-02T00:42:19.000Z</published>
    <updated>2020-03-14T00:52:41.919Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>PHP实现导入功能，功能简单大众化，简单记录方便后续使用。</p></blockquote><p>前端部分</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>upload-demo<span class="token punctuation">"</span></span>    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/index.php/admin/Auditors/importTable2<span class="token punctuation">"</span></span>    <span class="token attr-name">:show-file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>    <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleAvatarSuccessq<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn-look<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Excel导入<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//导入</span>    <span class="token function">handleAvatarSuccessq</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"导入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> searchData <span class="token operator">=</span> <span class="token punctuation">{</span>          pageNow<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          company_id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>companyId        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userlist</span><span class="token punctuation">(</span>searchData<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>后端</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">importTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$param</span><span class="token operator">=</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">'./static/upload/importfile'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$zhui</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$zhui</span><span class="token operator">!=</span><span class="token string">'xls'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$zhui</span><span class="token operator">!=</span><span class="token string">'xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'请上传正确的模板文件'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./static/upload/importfile/'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"PHPExcel"</span><span class="token punctuation">,</span> <span class="token constant">EXTEND_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'xlsx'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$objReader</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReader</span><span class="token punctuation">(</span><span class="token string">'Excel2007'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$objReader</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReader</span><span class="token punctuation">(</span><span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$objPHPExcel</span> <span class="token operator">=</span> <span class="token variable">$objReader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$encode</span> <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sheet</span> <span class="token operator">=</span> <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$highestRow</span> <span class="token operator">=</span> <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHighestRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 取得总行数</span>        <span class="token variable">$highestColumn</span> <span class="token operator">=</span> <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHighestColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 取得总列数</span>        <span class="token comment" spellcheck="true">//验证</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$highestRow</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//涉及企业级次</span>            <span class="token variable">$cname</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getLevelZhuanName</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，C列输入的涉及企业级次不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否上市公司</span>                <span class="token variable">$isShang</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token variable">$isShang</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，D列输入的是否上市公司不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//问题线索来源</span>                <span class="token variable">$source</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanSourceName</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，E列输入的问题线索来源不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//问题类别</span>                <span class="token variable">$qtype</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"H"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanQtypeName</span><span class="token punctuation">(</span><span class="token variable">$qtype</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，H列输入的问题类别不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//境内（外）</span>                <span class="token variable">$jing</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"J"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanJnInfo</span><span class="token punctuation">(</span><span class="token variable">$jing</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，J列输入的境内（外）不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否完成核查</span>                <span class="token variable">$he</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"M"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanCheck</span><span class="token punctuation">(</span><span class="token variable">$he</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，M列输入的是否完成核查不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//核查主体</span>                <span class="token variable">$main</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"N"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanCheckMain</span><span class="token punctuation">(</span><span class="token variable">$main</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，N列输入的核查主体不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//损失认定类别</span>                <span class="token variable">$sun</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"W"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanLossTypeName</span><span class="token punctuation">(</span><span class="token variable">$sun</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，W列输入的损失认定类别不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否完成</span>                <span class="token variable">$iswan</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token variable">$iswan</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，BK列输入的是否完成不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//插入</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$highestRow</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$cname</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//基本信息</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及企业名称</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'level'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getLevelZhuanName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及企业级次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'isShang'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否上市公司</span>                <span class="token comment" spellcheck="true">//问题受理</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanSourceName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题线索来源</span>                <span class="token variable">$acceptTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"F"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$acceptTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'acceptTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$acceptTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题受理时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'descript'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"G"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题简要描述</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'qtype'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanQtypeName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"H"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题类别</span>                <span class="token variable">$occurTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"I"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$occurTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'occurTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$occurTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题发生时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'domestic'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanJnInfo</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"J"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//境内（外）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'riskLose'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"K"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//预估损失风险（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'measures'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"L"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采取的应对措施</span>                <span class="token comment" spellcheck="true">//核查情况</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'ischeck'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanCheck</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"M"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否完成核查</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkMain'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanCheckMain</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"N"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查主体</span>                <span class="token variable">$checkEndTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"O"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$checkEndTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkEndTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$checkEndTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查结束时间</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//违规事实</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkResultDescript'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"P"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查结果简要简要描述</span>                <span class="token variable">$name</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Q"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$names</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$whedd</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'in'</span><span class="token punctuation">,</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$ppid</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'duty_report_involved'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$whedd</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$personIds</span><span class="token operator">=</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token variable">$ppid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$personIds</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'involved'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$personIds</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及人员</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'violation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"R"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//违反具体规定</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'violationType'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"S"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//违反规定类别</span>                <span class="token comment" spellcheck="true">//损失认定</span>                <span class="token variable">$lossTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"T"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$lossTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$lossTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失确认时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"U"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失金额（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'loseRiskPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"V"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失风险金额（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossType'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanLossTypeName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"W"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失认定类别</span>                <span class="token comment" spellcheck="true">//责任认定</span>                <span class="token variable">$responTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"X"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$responTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'responTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$responTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责任认定时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'totalNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Y"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'mtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Z"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//中管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'wtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AA"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//委管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'qtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AB"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//企业管理干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'totalVisits'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AC"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'mleaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AD"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//重要领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'fleaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AE"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//分管领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'leaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AF"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'superRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AG"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//主管责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'dircetRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AH"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//直接责任</span>                <span class="token comment" spellcheck="true">//责任追究</span>                <span class="token variable">$accountabilityTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AI"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$accountabilityTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'accountabilityTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$accountabilityTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责任追究时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atotalNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AJ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//中管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'awtubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AL"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//委管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'aqtubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AM"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//企业管理干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atotalVisits'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AN"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'aztNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AO"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'comEducation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AP"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//批评教育</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'inspection'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AQ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责令书面检查</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'criticism'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AR"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//通报批评</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'exhortation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AS"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//诫勉</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'suspend'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AT"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//停职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'outOfWork'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AU"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//调离工作岗位</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'demote'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AV"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//降职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'nonLeadership'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AW"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//改任非领导职务</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'resign'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AX"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责令辞职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'remove'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AY"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//免职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'krtotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AZ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'deductionAmount'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BA"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//扣减金额(万元)</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'zjtotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BB"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'noEntryTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BC"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//禁入时间(年)</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'zjltotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BD"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'warn'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BE"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//警告</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'impWarn'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BF"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//严重警告</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'revPosition'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BG"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//撤销党内职务</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'stayInspection'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BH"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//留党察看</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'expel'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BI"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开除党籍</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'judicial'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BJ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//移送国家监察机关或司法机关人次</span>                <span class="token comment" spellcheck="true">//整改落实</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'isOver'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否完成</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'reason'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BL"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//未完成原因</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cLossPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BM"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cLossRiskPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BN"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失风险（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cwNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BO"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//个数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'releaseTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BP"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//制度名称及出台时间</span>                <span class="token comment" spellcheck="true">//备注</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'note'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BQ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//备注</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'rid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'rid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'update_by'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'update_date'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'create_by'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'create_date'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'company_id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.company_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'duty_report_detail'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'导入成功'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="导入" scheme="https://chiwai.tang99.club/tags/%E5%AF%BC%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统上安装git</title>
    <link href="https://chiwai.tang99.club/posts/3327442321.html"/>
    <id>https://chiwai.tang99.club/posts/3327442321.html</id>
    <published>2020-02-16T04:51:37.000Z</published>
    <updated>2020-04-17T06:52:06.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;分为两种安装方式:1、yum安装，2、在GitHub下载最新的源码安装</p><h1 id="一、使用yum安装"><a href="#一、使用yum安装" class="headerlink" title="一、使用yum安装"></a>一、使用yum安装</h1><blockquote><p>使用yum安装的缺点是版本不好控制，安装的版本比较旧。</p></blockquote><pre class="line-numbers language-text"><code class="language-text">yum -y install git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144630.png" alt></p><p>输入 <b>git - -version</b>查看git安装的版本号<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144741.png" alt><br>这里由于我已经通过下载源码方式安装了最新的版本，正常使用yum安装完后版本不会这么高，例如下面图片是安装时显示的版本号。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144704.png" alt></p><p>作为了解，使用yum安装git的安装路径为<b>/usr/libexec/git-core</b>目录下。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144814.png" alt></p><p>到这里就已经安装完成。</p><h1 id="二、在GitHub上下载最新的源码进行安装。"><a href="#二、在GitHub上下载最新的源码进行安装。" class="headerlink" title="二、在GitHub上下载最新的源码进行安装。"></a>二、在GitHub上下载最新的源码进行安装。</h1><p>1.进入git在GitHub发布的版本页面<b><a href="https://github.com/git/git/releases" target="_blank" rel="noopener">https://github.com/git/git/releases</a></b>,在里面找到找到想要安装的版本，然后下载tar.gz包到本地。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144842.png" alt><br>2.使用FlashFXP工具将下载好的压缩包上传到Linux服务器的<b>/usr</b>目录下<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144905.png" alt><br>3.解压压缩包</p><pre class="line-numbers language-text"><code class="language-text">tar -zxvf git-2.26.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.进入到解压后的文件夹</p><pre class="line-numbers language-text"><code class="language-text">cd git-2.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.拿到解压后的源码后需要进行编译，不过在此之前需要安装编译所需依赖。中途如出现提示时输入y，按回车。</p><pre class="line-numbers language-text"><code class="language-text">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>6.因为在安装所需要的依赖时，yum自动安装了git，这时需要先卸载这个旧版本git。</p><pre class="line-numbers language-text"><code class="language-text">yum -y remover git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>7.编译git源码</p><pre class="line-numbers language-text"><code class="language-text">make prefix=/usr/local/git all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>8.安装git到<b>/usr/local/git</b>路径</p><pre class="line-numbers language-text"><code class="language-text">make prefix=/usr/local/git install<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>9.配置环境变量</p><pre class="line-numbers language-text"><code class="language-text">vi /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在最后一行加上<b>(输入:wq 保存修改)<b></b></b></p><pre class="line-numbers language-text"><code class="language-text">export PATH=$PATH:/usr/local/git/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>10.刷新环境变量</p><pre class="line-numbers language-text"><code class="language-text">source /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>11.查看Git安装情况</p><pre class="line-numbers language-text"><code class="language-text">git --version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>至此，使用下载源码方式安装完成。</p><h1 id="三、git生成密钥"><a href="#三、git生成密钥" class="headerlink" title="三、git生成密钥"></a>三、git生成密钥</h1><p>1.查看是否有密钥文件,如果存在密钥，将密钥复制粘贴到git云上。</p><pre class="line-numbers language-text"><code class="language-text">ls -al ~/.ssh/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145026.png" alt></p><p>2.配置git</p><pre class="line-numbers language-text"><code class="language-text">git config --global user.name "名称"git config --global user.email "邮箱"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3.生成密钥</p><pre class="line-numbers language-text"><code class="language-text">ssh-keygen -C '邮箱' -t rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.查看文件位置</p><pre class="line-numbers language-text"><code class="language-text">find / -name id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.进入文件，复制密钥</p><pre class="line-numbers language-text"><code class="language-text">vi ~/.ssh/id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145053.png" alt><br>6.将内容复制到git云上，例如码云。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145127.png" alt></p><h1 id="四、git拉取远程代码"><a href="#四、git拉取远程代码" class="headerlink" title="四、git拉取远程代码"></a>四、git拉取远程代码</h1><p>1.拉取远程代码</p><pre class="line-numbers language-text"><code class="language-text">git clone 这里填写要拉取项目的ssh链接<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.(进入到工程目录下)查看本地分支和远程分支</p><pre class="line-numbers language-text"><code class="language-text">cd tejiangit branch -al 查看本地和远程的所有分支<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145155.png" alt></p><blockquote><p>master表示本地分支，前面*号表示正在使用的分支<br>  带有remotes的分支都是远程分支。</p></blockquote><p>3.将修改文件上传到本地</p><pre class="line-numbers language-text"><code class="language-text">git add abc.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.添加到本地分支上</p><pre class="line-numbers language-text"><code class="language-text">git commit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.上传到远端仓库</p><pre class="line-numbers language-text"><code class="language-text">git push<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参考资料:<br><a href="https://www.cnblogs.com/wulixia/p/11016684.html" target="_blank" rel="noopener">https://www.cnblogs.com/wulixia/p/11016684.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://chiwai.tang99.club/categories/Linux/"/>
    
    
      <category term="Git" scheme="https://chiwai.tang99.club/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>PHP基于phpqrcode类生成二维码</title>
    <link href="https://chiwai.tang99.club/posts/123876002.html"/>
    <id>https://chiwai.tang99.club/posts/123876002.html</id>
    <published>2020-01-31T06:06:29.000Z</published>
    <updated>2020-01-31T12:40:06.606Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="phpqrcode下载地址"><a href="#phpqrcode下载地址" class="headerlink" title="phpqrcode下载地址"></a>phpqrcode下载地址</h1><blockquote><p>地址：<a href="http://phpqrcode.sourceforge.net/" target="_blank" rel="noopener">http://phpqrcode.sourceforge.net/</a><br>下载：<a href="http://sourceforge.net/projects/phpqrcode/" target="_blank" rel="noopener">http://sourceforge.net/projects/phpqrcode/</a></p></blockquote><p>&emsp;&emsp;下载官网提供的类库后，只需要使用<span style="color:red;font-weight:bold;">phpqrcode.php</span>就可以生成二维码了，当然您的PHP环境必须开启支持GD2。它是一个多个类的集合文件，我们需要用到里边的<span style="color:red;font-weight:bold;">QRcode类的png()</span>方法;</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token variable">$outfile</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$level</span> <span class="token operator">=</span> <span class="token constant">QR_ECLEVEL_L</span><span class="token punctuation">,</span> <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token variable">$margin</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token variable">$saveandprint</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$enc</span> <span class="token operator">=</span> QRencode<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token punctuation">,</span> <span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token variable">$margin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$enc</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encodePNG</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token variable">$outfile</span><span class="token punctuation">,</span> <span class="token variable">$saveandprint</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><blockquote><p><span style="color:red;font-weight:bold;">$text</span>表示生成二位的的信息文本<br> <span style="color:red;font-weight:bold;">$outfile</span>表示是否输出二维码图片文件，默认否<br> <span style="color:red;font-weight:bold;">$level</span>表示容错率，也就是有被覆盖的区域还能识别，分别:L（QR_ECLEVEL_L，7%），M（QR_ECLEVEL_M，15%），Q（QR_ECLEVEL_Q，25%），H（QR_ECLEVEL_H，30%）<br> <span style="color:red;font-weight:bold;">$size</span>表示生成图片大小，默认是3<br> <span style="color:red;font-weight:bold;">$margin</span>表示二维码周围边框空白区域间距值<br> <span style="color:red;font-weight:bold;">$saveandprint</span>表示是否保存二维码并显示</p></blockquote><h1 id="调用-PHP-QRcode类"><a href="#调用-PHP-QRcode类" class="headerlink" title="调用 PHP QRcode类"></a>调用 PHP QRcode类</h1><pre class="line-numbers language-php"><code class="language-php">Loader<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'phpqrcode.phpqrcode'</span><span class="token punctuation">,</span><span class="token constant">EXTEND_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例:"></a>使用示例:</h1><h2 id="生成带有LOGO的二维码"><a href="#生成带有LOGO的二维码" class="headerlink" title="生成带有LOGO的二维码"></a>生成带有LOGO的二维码</h2><p>&emsp;&emsp;其实原理很简单，先使用QRcode类生成一张二维码图片，然后再利用php的image相关函数，将事先准备好的logo图片加入到刚生成的原始二维码图片中间，然后重新生成一张新的二维码图片。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//二维码内容</span>        <span class="token variable">$value</span> <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//chiwai.tang99.club';</span>        <span class="token variable">$errorCorrectionLevel</span> <span class="token operator">=</span> <span class="token string">'L'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//容错级别</span>        <span class="token variable">$matrixPointSize</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//生成图片大小</span>        <span class="token comment" spellcheck="true">//生成二维码图片</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./qrcode/'</span><span class="token punctuation">.</span><span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.png'</span><span class="token punctuation">;</span>        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'./qrcode'</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断是否存在上传到的目录</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        \<span class="token package">QRcode</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$errorCorrectionLevel</span><span class="token punctuation">,</span> <span class="token variable">$matrixPointSize</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//准备好的logo图片</span>        <span class="token variable">$logo</span> <span class="token operator">=</span> <span class="token string">'./static/logo1.png'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$logo</span> <span class="token operator">!==</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$QR</span> <span class="token operator">=</span> <span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$logo</span> <span class="token operator">=</span> <span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//二维码图片宽度</span>            <span class="token variable">$QR_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//二维码图片高度</span>            <span class="token variable">$QR_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//logo图片宽度</span>            <span class="token variable">$logo_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//logo图片高度</span>            <span class="token variable">$logo_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$logo_qr_width</span> <span class="token operator">=</span> <span class="token variable">$QR_width</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">;</span>            <span class="token variable">$scale</span> <span class="token operator">=</span> <span class="token variable">$logo_width</span><span class="token operator">/</span><span class="token variable">$logo_qr_width</span><span class="token punctuation">;</span>            <span class="token variable">$logo_qr_height</span> <span class="token operator">=</span> <span class="token variable">$logo_height</span><span class="token operator">/</span><span class="token variable">$scale</span><span class="token punctuation">;</span>            <span class="token variable">$from_width</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$QR_width</span> <span class="token operator">-</span> <span class="token variable">$logo_qr_width</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//重新组合图片并调整大小</span>            <span class="token function">imagecopyresampled</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span> <span class="token variable">$logo</span><span class="token punctuation">,</span> <span class="token variable">$from_width</span><span class="token punctuation">,</span> <span class="token variable">$from_width</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$logo_qr_width</span><span class="token punctuation">,</span> <span class="token variable">$logo_qr_height</span><span class="token punctuation">,</span> <span class="token variable">$logo_width</span><span class="token punctuation">,</span> <span class="token variable">$logo_height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//输出图片</span>        <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">'&lt;img src="'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span> <span class="token punctuation">.</span> <span class="token string">'">'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成二维码直接输出"><a href="#生成二维码直接输出" class="headerlink" title="生成二维码直接输出"></a>生成二维码直接输出</h2><blockquote><p>直接输出二维码只需要将参数二改为false。写die()是因为防止乱码</p></blockquote><pre class="line-numbers language-php"><code class="language-php">        <span class="token variable">$value</span><span class="token operator">=</span>"https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//chiwai.tang99.club";</span>        <span class="token variable">$errorCorrectionLevel</span><span class="token operator">=</span><span class="token string">"L"</span><span class="token punctuation">;</span>        <span class="token variable">$matrixPointSize</span><span class="token operator">=</span><span class="token string">"4"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//生成图片大小 ：1到10</span>        \<span class="token package">QRcode</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token variable">$errorCorrectionLevel</span><span class="token punctuation">,</span><span class="token variable">$matrixPointSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="更改二维码的颜色"><a href="#更改二维码的颜色" class="headerlink" title="更改二维码的颜色"></a>更改二维码的颜色</h2><blockquote><p>$QR表示生成的二维码</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$indexColor</span> <span class="token operator">=</span> <span class="token function">imagecolorexact</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">imagecolorset</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token variable">$indexColor</span><span class="token punctuation">,</span><span class="token number">148</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">211</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>参考资料:<br> <a href="http://phpqrcode.sourceforge.net/examples/index.php" target="_blank" rel="noopener">http://phpqrcode.sourceforge.net/examples/index.php</a><br> <a href="https://www.php.cn/php-weizijiaocheng-402924.html" target="_blank" rel="noopener">https://www.php.cn/php-weizijiaocheng-402924.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="二维码" scheme="https://chiwai.tang99.club/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    
  </entry>
  
</feed>
