<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>志伟&amp;博客</title>
  
  <subtitle>Chi-wai blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="%5Bobject%20Object%5D" rel="hub"/>
  <link href="https://chiwai.tang99.club/"/>
  <updated>2020-01-29T07:30:26.975Z</updated>
  <id>https://chiwai.tang99.club/</id>
  
  <author>
    <name>志伟</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Js+Jquery简单功能汇总</title>
    <link href="https://chiwai.tang99.club/posts/1554494174.html"/>
    <id>https://chiwai.tang99.club/posts/1554494174.html</id>
    <published>2020-01-29T06:43:11.000Z</published>
    <updated>2020-01-29T07:30:26.975Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jq实现动态删除元素后，重新排列序号"><a href="#Jq实现动态删除元素后，重新排列序号" class="headerlink" title="Jq实现动态删除元素后，重新排列序号"></a>Jq实现动态删除元素后，重新排列序号</h1><pre class="line-numbers language-javascript"><code class="language-javascript">option_select_id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">".model-select-group-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">" .model-select-group"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">rank1</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> that<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>option_val_id<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                newoption_val_id <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">".model-radio-group-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">".model-radio-group"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.options'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"选项"</span><span class="token operator">+</span>newoption_val_id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这里的that 代表动态添加或者删除时传进来的$(this)</p></blockquote><h1 id="Jq实现城市三级联动"><a href="#Jq实现城市三级联动" class="headerlink" title="Jq实现城市三级联动"></a>Jq实现城市三级联动</h1><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//省</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=country]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getProvince')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择省/直辖市--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=province]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择市--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">!=</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//市</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=province]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getRetion')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'province'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择市--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value='</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">'>市辖区&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//县</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span><span class="token string">'select[name=city]'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getRetion')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'city'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="https://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Javascript" scheme="https://chiwai.tang99.club/tags/Javascript/"/>
    
      <category term="Jquery" scheme="https://chiwai.tang99.club/tags/Jquery/"/>
    
  </entry>
  
  <entry>
    <title>PHP简单功能汇总</title>
    <link href="https://chiwai.tang99.club/posts/346954664.html"/>
    <id>https://chiwai.tang99.club/posts/346954664.html</id>
    <published>2020-01-26T04:47:05.000Z</published>
    <updated>2020-01-29T06:37:14.429Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>简单做个记录，初学者，也算是记录成长的过程！</p></blockquote><h1 id="TP5-图片上传"><a href="#TP5-图片上传" class="headerlink" title="TP5 图片上传"></a>TP5 图片上传</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">files</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token string">'请上传头像'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'/mobile/header'</span><span class="token punctuation">;</span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$imgpath</span> <span class="token operator">=</span> <span class="token variable">$path</span> <span class="token punctuation">.</span><span class="token string">'/'</span> <span class="token punctuation">.</span><span class="token variable">$url</span><span class="token punctuation">;</span>            <span class="token variable">$re</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string">'image'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$imgpath</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$title</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$imgpath</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'上传成功'</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$imgpath</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$imgpath</span><span class="token punctuation">;</span>                <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$imgpath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'系统繁忙'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$err</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token variable">$err</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="layui-TP5多文件上传"><a href="#layui-TP5多文件上传" class="headerlink" title="layui + TP5多文件上传"></a>layui + TP5多文件上传</h1><h2 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h2><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bg-header-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header-main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>innerList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inner<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>baojian<span class="token punctuation">"</span></span> <span class="token attr-name">cellpadding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table30<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jvform<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{:url(<span class="token punctuation">'</span>updo<span class="token punctuation">'</span>)}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slmark<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slmark<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!--一上传附件--></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>equ_id[]<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chuan<span class="token punctuation">"</span></span> <span class="token attr-name">rowspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">rowspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>opp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zz<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn layui-btn-normal testList<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>选择多文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-upload-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-table<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>文件名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>大小<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>状态<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demoList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn testListAction<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>开始上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span>right<span class="token punctuation">;</span><span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span><span class="token hexcode">#FF3030</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn clo<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./static/layui/layui.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery            <span class="token punctuation">,</span>upload <span class="token operator">=</span> layui<span class="token punctuation">.</span>upload<span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".testList"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> demoListView <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.layui-upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demoList'</span><span class="token punctuation">)</span>                <span class="token punctuation">,</span>uploadListIns <span class="token operator">=</span> upload<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                elem<span class="token punctuation">:</span> <span class="token keyword">this</span>                <span class="token punctuation">,</span>url<span class="token punctuation">:</span> <span class="token string">"index.php/index/index/affix"</span>                <span class="token punctuation">,</span>accept<span class="token punctuation">:</span> <span class="token string">'file'</span>                <span class="token punctuation">,</span>multiple<span class="token punctuation">:</span> <span class="token boolean">true</span>                <span class="token punctuation">,</span>auto<span class="token punctuation">:</span> <span class="token boolean">false</span>                <span class="token punctuation">,</span>bindAction<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.layui-upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.testListAction'</span><span class="token punctuation">)</span>                <span class="token punctuation">,</span>choose<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> files <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">pushFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将每次选择的文件追加到文件队列</span>                    <span class="token comment" spellcheck="true">//读取本地文件</span>                    obj<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> file<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">var</span> tr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'&lt;tr id="upload-'</span><span class="token operator">+</span> index <span class="token operator">+</span><span class="token string">'">'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span><span class="token operator">+</span> file<span class="token punctuation">.</span>name <span class="token operator">+</span><span class="token string">'&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span><span class="token operator">+</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>size<span class="token operator">/</span><span class="token number">1014</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'kb&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>等待上传&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;button class="layui-btn layui-btn-xs demo-reload layui-hide">重传&lt;/button>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除&lt;/button>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;/tr>'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//单个重传</span>                        tr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            obj<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//删除</span>                        tr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-delete'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">delete</span> files<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除对应的文件</span>                            tr<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            uploadListIns<span class="token punctuation">.</span>config<span class="token punctuation">.</span>elem<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//清空 input file 值，以免删除后出现同名文件不可选</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        demoListView<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">,</span>done<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//上传成功</span>                        <span class="token keyword">var</span> htm <span class="token operator">=</span><span class="token string">'&lt;input name="affix[title][]" type="hidden" value="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">'" />'</span><span class="token punctuation">;</span>                        htm <span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;input name="affix[url][]" type="hidden" value="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'" />'</span><span class="token punctuation">;</span>                        html <span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;a href="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'" target="_blank">'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">' &lt;/a>&lt;br/>'</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".chuan"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jvform"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>htm<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> tr <span class="token operator">=</span> demoListView<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'tr#upload-'</span><span class="token operator">+</span> index<span class="token punctuation">)</span>                            <span class="token punctuation">,</span>tds <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;span style="color: #5FB878;">上传成功&lt;/span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//清空操作</span>                        <span class="token keyword">return</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除文件队列已经上传成功的文件</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">,</span>error<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> tr <span class="token operator">=</span> demoListView<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'tr#upload-'</span><span class="token operator">+</span> index<span class="token punctuation">)</span>                        <span class="token punctuation">,</span>tds <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;span style="color: #FF5722;">上传失败&lt;/span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'layui-hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//显示重传</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP部分"><a href="#PHP部分" class="headerlink" title="PHP部分"></a>PHP部分</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">affix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"请上传图片"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$title</span><span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$path</span><span class="token operator">=</span> <span class="token string">'/mobile/upload/'</span><span class="token punctuation">;</span>            <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$dat</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$title</span><span class="token punctuation">;</span>                <span class="token variable">$dat</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$path</span><span class="token punctuation">.</span><span class="token variable">$url</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$dat</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$da</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$da</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>提交入库</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'affix'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'equ_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'equ_id'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filepath'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'affix'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'createtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$jj</span> <span class="token operator">=</span> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tj_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$jj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"提交成功"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"异常稍后再试"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$nn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="layui-TP5-分页"><a href="#layui-TP5-分页" class="headerlink" title="layui + TP5 分页"></a>layui + TP5 分页</h1><h2 id="前端部分-1"><a href="#前端部分-1" class="headerlink" title="前端部分"></a>前端部分</h2><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list lch hideone<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#cccccc</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>two<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>2019-06-29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>产后随访表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>__SUIFANG__/images/shouye/tb_12.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>details2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    {notempty name="$v.chanhou"}        {volist name="$v.chanhou" id="chanhou_v"}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#cccccc</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>two<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{$chanhou_v.time | date="Y-m-d"}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>产后随访表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhou_v.btn_kkid}<span class="token punctuation">"</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9<span class="token punctuation">"</span></span> <span class="token attr-name">del-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhou_v.id}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;img src="__SUIFANG__/images/shouye/tb_12.png" alt=""style="margin-right: 30px;"   class="details2">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>__SUIFANG__/images/shouye/dlete_03.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deletech<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        {/volist}    {/notempty}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--分页--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hideonech<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">data-page</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhoucount}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token comment" spellcheck="true">//分页</span>    layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'laypage'</span><span class="token punctuation">,</span> <span class="token string">'layer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> laypage <span class="token operator">=</span> layui<span class="token punctuation">.</span>laypage<span class="token punctuation">,</span>            layer <span class="token operator">=</span> layui<span class="token punctuation">.</span>layer<span class="token punctuation">;</span>        laypage<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            elem<span class="token punctuation">:</span> <span class="token string">'demo0'</span><span class="token punctuation">,</span>            limit<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>            count<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#demo0'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//数据总数,</span>            jump<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>first<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//首次不执行</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>first<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> parent_id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.parent_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:url('/index/pages')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token punctuation">:</span>res<span class="token punctuation">.</span>curr<span class="token punctuation">,</span>limit<span class="token punctuation">:</span>res<span class="token punctuation">.</span>limit<span class="token punctuation">,</span>parent_id<span class="token punctuation">:</span>parent_id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'li:first'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token string">"&lt;li style=\"border-top: 1px solid #cccccc;\">"</span> <span class="token operator">+</span> li <span class="token operator">+</span> <span class="token string">"&lt;/li>"</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>                        $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token keyword">var</span> html <span class="token operator">=</span>  <span class="token string">'&lt;li style="border-top: 1px solid #cccccc;">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;div class="two">&lt;i class="circle">&lt;/i>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;p>'</span><span class="token operator">+</span> v<span class="token punctuation">.</span>time <span class="token operator">+</span><span class="token string">'&lt;/p>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;p>产后随访表&lt;/p>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;div data-id="'</span><span class="token operator">+</span>v<span class="token punctuation">.</span>btn_kkid<span class="token operator">+</span><span class="token string">'" data-type="9" del-id="'</span><span class="token operator">+</span> v<span class="token punctuation">.</span>id <span class="token operator">+</span><span class="token string">'">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;img src="__SUIFANG__/images/shouye/tb_12.png" alt=""style="margin-right: 30px;"   class="details2">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;img src="__SUIFANG__/images/shouye/dlete_03.png" alt="" class="deletech">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/li>'</span><span class="token punctuation">;</span>                            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP部分-1"><a href="#PHP部分-1" class="headerlink" title="PHP部分"></a>PHP部分</h2><pre class="line-numbers language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$Chanhou_module</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chanhou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$chanhou</span> <span class="token operator">=</span> <span class="token variable">$Chanhou_module</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$chanhou</span> <span class="token operator">=</span> <span class="token variable">$chanhou</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'data'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$chanhou</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP5-1中间件定义使用"><a href="#TP5-1中间件定义使用" class="headerlink" title="TP5.1中间件定义使用"></a>TP5.1中间件定义使用</h1><blockquote><p>有时间可以看看手册，还是很完整的。</p></blockquote><h2 id="在配置文件中定义"><a href="#在配置文件中定义" class="headerlink" title="在配置文件中定义"></a>在配置文件中定义</h2><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20200127201742.png" alt><br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20200127202015.png" alt></p><h2 id="在对应的中间件中写功能"><a href="#在对应的中间件中写功能" class="headerlink" title="在对应的中间件中写功能"></a>在对应的中间件中写功能</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>middleware</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">CheckIndexAuth</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> \<span class="token package">Closure</span> <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user_index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取当前登录信息</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span> <span class="token operator">||</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user_index_sign'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//验证是否登录</span><span class="token comment" spellcheck="true">//            alert_error('登录后查看', url('/login'));</span>            <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="配合路由使用"><a href="#配合路由使用" class="headerlink" title="配合路由使用"></a>配合路由使用</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 后台管理路由 * 免权限验证路由 */</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'login$'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/Login/login'</span><span class="token punctuation">,</span>                                         <span class="token comment" spellcheck="true">//登录</span>    <span class="token string">'editPassword'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/User/editPassword'</span><span class="token punctuation">,</span>                             <span class="token comment" spellcheck="true">//重置密码</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 需要权限验证路由 */</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'index$'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/Index/index'</span><span class="token punctuation">,</span>                                           <span class="token comment" spellcheck="true">//首页</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token string">'CheckAuth'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//使用中间件验证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP5多数据库配置及使用-sqlsrv"><a href="#TP5多数据库配置及使用-sqlsrv" class="headerlink" title="TP5多数据库配置及使用(sqlsrv)"></a>TP5多数据库配置及使用(sqlsrv)</h1><h2 id="在config-php文件中配置"><a href="#在config-php文件中配置" class="headerlink" title="在config.php文件中配置"></a>在config.php文件中配置</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token punctuation">[</span>    db1' <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>            <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'sqlsrv'</span><span class="token punctuation">,</span>            <span class="token string">'hostname'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'60.60.60.60,8090'</span><span class="token punctuation">,</span>            <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'数据库名'</span><span class="token punctuation">,</span>            <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'密码'</span><span class="token punctuation">,</span>            <span class="token string">'hostport'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'1433'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'db2'</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>            <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'sqlsrv'</span><span class="token punctuation">,</span>            <span class="token string">'hostname'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'61.61.61.60,8090'</span><span class="token punctuation">,</span>            <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'数据库名'</span><span class="token punctuation">,</span>            <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'密码'</span><span class="token punctuation">,</span>            <span class="token string">'hostport'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'1433'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><pre class="line-numbers language-php"><code class="language-php"> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tbs_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tbs_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="从身份证号-残疾证号获取-年龄-生日"><a href="#从身份证号-残疾证号获取-年龄-生日" class="headerlink" title="从身份证号/残疾证号获取(年龄/生日)"></a>从身份证号/残疾证号获取(年龄/生日)</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 从身份证号/残疾证号获取(年龄/生日) * @param $Idcard 身份证号 * @param bool $b true为生日 false为年龄 * @return bool|int|string */</span><span class="token keyword">function</span> <span class="token function">getAgeFromIdcard</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$birthday</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$birthday</span><span class="token punctuation">;</span>    <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$birthday</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$age</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="从身份证号获取性别"><a href="#从身份证号获取性别" class="headerlink" title="从身份证号获取性别"></a>从身份证号获取性别</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 从身份证号获取性别 * @param $Idcard 身份证号 * @return bool|int 1男 2女 */</span><span class="token keyword">function</span> <span class="token function">getSexFromIdcard</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">18</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="返回一个随机字符串"><a href="#返回一个随机字符串" class="headerlink" title="返回一个随机字符串"></a>返回一个随机字符串</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 返回一个随机字符串 * @param $type 支持 number 数字 string 字符串 mix 混合 默认混合 * @param $size 设置字段长度 默认32 * @return string */</span><span class="token keyword">function</span> <span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token string">'mix'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'number'</span><span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'string'</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'mix'</span><span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">default</span> <span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token variable">$size</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$num</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="获取处理后的时间"><a href="#获取处理后的时间" class="headerlink" title="获取处理后的时间"></a>获取处理后的时间</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">time2string</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$day</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整天之后剩余的时间</span>    <span class="token variable">$hour</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token number">3600</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整小时之后剩余的时间</span>    <span class="token variable">$minute</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token number">60</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整分钟之后剩余的时间</span>    <span class="token comment" spellcheck="true">//返回字符串</span>    <span class="token keyword">return</span> <span class="token variable">$day</span><span class="token punctuation">.</span><span class="token string">'天'</span><span class="token punctuation">.</span><span class="token variable">$hour</span><span class="token punctuation">.</span><span class="token string">'小时'</span><span class="token punctuation">.</span><span class="token variable">$minute</span><span class="token punctuation">.</span><span class="token string">'分'</span><span class="token punctuation">.</span><span class="token variable">$second</span><span class="token punctuation">.</span><span class="token string">'秒'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="手动计算分页"><a href="#手动计算分页" class="headerlink" title="手动计算分页"></a>手动计算分页</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$aa</span> <span class="token operator">=</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$aa</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$ly</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token variable">$aa</span><span class="token punctuation">;</span>        <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jsr_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token variable">$ly</span><span class="token punctuation">,</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$list</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jsr_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'per_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$aa</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'current_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'查询成功'</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP3表关联查询"><a href="#TP3表关联查询" class="headerlink" title="TP3表关联查询"></a>TP3表关联查询</h1><blockquote><p>以链接4张表为例。<br>  分别为:ce_cost,ce_order,ce_user,ce_r_mechanism<br>  其中，cost为主表</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$toll_list</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_order o on c.oid = o.id'</span><span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_user u on o.user = u.id'</span><span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_r_mechanism r on o.xmec = r.id'</span><span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'c.*,o.number,o.user,o.xmec,u.id,u.name,r.id,r.uname'</span><span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP实现二维数组去重"><a href="#PHP实现二维数组去重" class="headerlink" title="PHP实现二维数组去重"></a>PHP实现二维数组去重</h1><h2 id="一维数组去重，PHP内置了去重函数。"><a href="#一维数组去重，PHP内置了去重函数。" class="headerlink" title="一维数组去重，PHP内置了去重函数。"></a>一维数组去重，PHP内置了去重函数。</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二维数组去重"><a href="#二维数组去重" class="headerlink" title="二维数组去重"></a>二维数组去重</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token number">0</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$sp_list_value</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'sp_id'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$sp_list_value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$sp_list_value</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/categories/PHP/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="汇总" scheme="https://chiwai.tang99.club/tags/%E6%B1%87%E6%80%BB/"/>
    
  </entry>
  
  <entry>
    <title>php将导出文件生成压缩包并下载</title>
    <link href="https://chiwai.tang99.club/posts/3149816056.html"/>
    <id>https://chiwai.tang99.club/posts/3149816056.html</id>
    <published>2019-12-09T13:14:31.000Z</published>
    <updated>2019-12-09T14:16:20.028Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>#php实现将导出文件生成压缩包并下载</p><blockquote><p>这里我用到了模板，首先获取其数据，加载模板，生成excel文件，获取其路径，将生成的excel文件生成压缩包。</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//血糖数据</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ExportXuetang</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//患者id</span>        <span class="token variable">$parent_id</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$table_xuetang</span> <span class="token operator">=</span> FixedTableTable<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$parent_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'btn_kkid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'json_info'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table_xuetang</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'json_info'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//数据量过大，这里我只取简单的几条数据，做记录</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'L_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'L_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'K_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'K_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'ZH_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'ZH_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WUQ_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WUQ_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WUH_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WUH_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WAQ_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WAQ_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//引入PHPExcel导出类</span>        <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>PHPExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$temPath</span> <span class="token operator">=</span> <span class="token string">"./template/xuetang.xlsx"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//模板路径</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'模板不存在!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//加载模板</span>        <span class="token variable">$excel</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReaderForFile</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$phpexcel</span> <span class="token operator">=</span> <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$fixed_arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//横向循环，我这里的数据是横向排列，动态横向输出</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$fixed_arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//当excel列超过26列大于Z时，将列的数字序号转成字母使用</span>            <span class="token variable">$pCoordinate</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_Cell</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">stringFromColumnIndex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'8'</span><span class="token punctuation">;</span>            <span class="token variable">$pValue</span>      <span class="token operator">=</span> <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$phpexcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$pCoordinate</span><span class="token punctuation">,</span> <span class="token variable">$pValue</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//清除缓冲区，避免乱码</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string">"xuetang.xlsx"</span><span class="token punctuation">;</span>        <span class="token variable">$file_path</span> <span class="token operator">=</span> <span class="token string">"./upload/template/"</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createWriter</span><span class="token punctuation">(</span><span class="token variable">$phpexcel</span><span class="token punctuation">,</span> <span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//将写好的模板保存到指定目录</span>        <span class="token comment" spellcheck="true">//生成excel路径</span>        <span class="token variable">$exct</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string">'title'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'血糖数据.xlsx'</span><span class="token punctuation">,</span>            <span class="token string">'url'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$file_path</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将路径返回</span>        <span class="token keyword">return</span> <span class="token variable">$exct</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>上面的方法是我要导出一部分的数据，实际上有很多不同的数据要合并，有多个方法，这里只取其中一个方法</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//下载excel并压缩包打包</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$zip_xuetang</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ExportXuetang</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将生成的excel生成压缩包</span>        <span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>ZipArchive</span><span class="token punctuation">;</span>        <span class="token variable">$zip_name</span> <span class="token operator">=</span> <span class="token string">'./upload/zip/'</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.zip'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//压缩包名称</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">,</span>\<span class="token package">ZipArchive</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//循环生成excel的路径</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$zip_arr</span> <span class="token keyword">as</span> <span class="token variable">$k1</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$tpfile</span><span class="token operator">=</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                 <span class="token variable">$new_filename</span> <span class="token operator">=</span> <span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFile</span><span class="token punctuation">(</span><span class="token variable">$tpfile</span><span class="token punctuation">,</span><span class="token variable">$new_filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">/*$zip->close();        $kkp='/static/upload/zip/'.time().'.zip';;        $file = $_SERVER['HTTP_HOST'].$kkp;                header('Location:http://'.$file);*/</span>        <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$kkp</span><span class="token operator">=</span><span class="token string">'./upload/zip/'</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.zip'</span><span class="token punctuation">;</span>        <span class="token function">ob_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-type: application/vnd.ms-word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition:attachment;filename="</span><span class="token punctuation">.</span><span class="token variable">$kkp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Cache-Control: max-age=0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="php" scheme="https://chiwai.tang99.club/categories/php/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="Excel" scheme="https://chiwai.tang99.club/tags/Excel/"/>
    
      <category term="压缩包" scheme="https://chiwai.tang99.club/tags/%E5%8E%8B%E7%BC%A9%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Win10 Nginx+PHP+MySQL 开机自启</title>
    <link href="https://chiwai.tang99.club/posts/2324507981.html"/>
    <id>https://chiwai.tang99.club/posts/2324507981.html</id>
    <published>2019-12-08T14:57:08.000Z</published>
    <updated>2019-12-08T14:59:13.656Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Win10-Nginx-PHP-MySQL-开机自启"><a href="#Win10-Nginx-PHP-MySQL-开机自启" class="headerlink" title="Win10 Nginx+PHP+MySQL 开机自启"></a>Win10 Nginx+PHP+MySQL 开机自启</h3><h5 id="1-MySQL"><a href="#1-MySQL" class="headerlink" title="1.MySQL"></a>1.MySQL</h5><pre><code>如: 用管理员运行cmd到MySql目录 C:\WNPM\MySQL\bin     执行 mysqld install 生成windows服务  </code></pre><h5 id="2-Nginx"><a href="#2-Nginx" class="headerlink" title="2.Nginx"></a>2.Nginx</h5><pre><code>将 winsw-1.18-bin.exe 复制到Nginx根目录 重命名为 nginx-service.exe并创建nginx-service.exe.config、nginx-service.xml两个文件内容如下：nginx-service.exe.config    &lt;configuration&gt;        &lt;startup&gt;            &lt;supportedRuntime version=&quot;v2.0.50727&quot; /&gt;            &lt;supportedRuntime version=&quot;v4.0&quot; /&gt;        &lt;/startup&gt;        &lt;runtime&gt;            &lt;generatePublisherEvidence enabled=&quot;false&quot;/&gt;        &lt;/runtime&gt;    &lt;/configuration&gt;    nginx-service.xml    &lt;service&gt;        &lt;id&gt;nginx&lt;/id&gt;        &lt;name&gt;Nginx Service&lt;/name&gt;        &lt;description&gt;High Performance Nginx Service&lt;/description&gt;        &lt;logpath&gt;C:\WNPM\nginx\logs&lt;/logpath&gt;        &lt;log mode=&quot;roll-by-size&quot;&gt;            &lt;sizeThreshold&gt;10240&lt;/sizeThreshold&gt;            &lt;keepFiles&gt;8&lt;/keepFiles&gt;        &lt;/log&gt;        &lt;executable&gt;C:\WNPM\nginx\nginx.exe&lt;/executable&gt;        &lt;startarguments&gt;C:\WNPM\nginx\nginx&lt;/startarguments&gt;        &lt;stopexecutable&gt;C:\WNPM\nginx\nginx.exe&lt;/stopexecutable&gt;        &lt;stoparguments&gt;-p C:\WNPM\nginx -s stop&lt;/stoparguments&gt;    &lt;/service&gt;执行 nginx-service.exe install 生成windows服务     </code></pre><h5 id="3-PHP"><a href="#3-PHP" class="headerlink" title="3.PHP"></a>3.PHP</h5><pre><code>将 WinSW.NET4.exe、xxfpm.exe、pthreadGC2.dll复制到PHP根目录 WinSW.NET4.exe 重命名为 php-cgi-servic.exe(xxfpm，用来开启 php-cgi 多进程)并创建php-cgi-service.xml文件php-cgi-service.xml&lt;service&gt;    &lt;id&gt;php-cgi&lt;/id&gt;    &lt;name&gt;php-cgi&lt;/name&gt;    &lt;description&gt;PHP-CGI.&lt;/description&gt;    &lt;executable&gt;xxfpm.exe&lt;/executable&gt;    &lt;!-- 启动参数 --&gt;    &lt;startargument&gt;&quot;C:\WNPM\php-7.2.1\php-cgi.exe -c C:\WNPM\php-            7.2.1\php.ini&quot;&lt;/startargument&gt;    &lt;startargument&gt;-n&lt;/startargument&gt;    &lt;!-- 启动进程数量，可修改，建议大于 1 --&gt;    &lt;startargument&gt;3&lt;/startargument&gt;    &lt;startargument&gt;-i&lt;/startargument&gt;    &lt;!-- 监听IP，默认一般都用 127.0.0.1 --&gt;    &lt;startargument&gt;127.0.0.1&lt;/startargument&gt;    &lt;startargument&gt;-p&lt;/startargument&gt;    &lt;!-- 监听端口，默认一般都用 9000 --&gt;    &lt;startargument&gt;9000&lt;/startargument&gt;    &lt;!-- 停止参数 --&gt;    &lt;stopexecutable&gt;taskkill&lt;/stopexecutable&gt;    &lt;stopargument&gt;/F&lt;/stopargument&gt;    &lt;stopargument&gt;/IM&lt;/stopargument&gt;    &lt;stopargument&gt;xxfpm.exe&lt;/stopargument&gt;    &lt;logpath&gt;logs&lt;/logpath&gt;&lt;/service&gt;php-cgi-service.exe install，生成windows服务</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="配置" scheme="https://chiwai.tang99.club/categories/%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="环境搭建" scheme="https://chiwai.tang99.club/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>php导出excel方法</title>
    <link href="https://chiwai.tang99.club/posts/4119388635.html"/>
    <id>https://chiwai.tang99.club/posts/4119388635.html</id>
    <published>2019-10-27T15:39:10.000Z</published>
    <updated>2020-01-29T04:16:47.379Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="php实现Excel导出方法"><a href="#php实现Excel导出方法" class="headerlink" title="php实现Excel导出方法"></a>php实现Excel导出方法</h1><p>工作中用到的功能，记录一下！</p><p>实例:</p><pre class="line-numbers language-php"><code class="language-php"> <span class="token comment" spellcheck="true">/**     * 导出机构信息     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">daochu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//用户名</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//机构名称</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'organization'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//委托单号</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//链表查询数据集</span>        <span class="token variable">$toll_list</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_order o on c.oid = o.id'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_user u on o.user = u.id'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_r_mechanism r on o.xmec = r.id'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'c.*,o.number,o.user,o.xmec,u.id,u.name as name1,r.id,r.name as name2'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//序号|时间</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$toll_list</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$toll_list</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'xu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$k</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token variable">$toll_list</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'addtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'addtime'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//设置字段名称</span>        <span class="token variable">$xlsCell</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'xu'</span><span class="token punctuation">,</span><span class="token string">'序号'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name1'</span><span class="token punctuation">,</span><span class="token string">'委托人'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name2'</span><span class="token punctuation">,</span><span class="token string">'机构名称'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span><span class="token string">'委托单号'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'cost1'</span><span class="token punctuation">,</span><span class="token string">'应收费用'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'cost2'</span><span class="token punctuation">,</span><span class="token string">'实收费用'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'title1'</span><span class="token punctuation">,</span><span class="token string">'详细费用单'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'title2'</span><span class="token punctuation">,</span><span class="token string">'盖章收费单'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'addtime'</span><span class="token punctuation">,</span><span class="token string">'创建时间'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'note'</span><span class="token punctuation">,</span><span class="token string">'备注'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//导入类库</span>        <span class="token function">vendor</span><span class="token punctuation">(</span><span class="token string">"PHPExcel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objPHPExcel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>PHPExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cellName</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'I'</span><span class="token punctuation">,</span><span class="token string">'J'</span><span class="token punctuation">,</span><span class="token string">'K'</span><span class="token punctuation">,</span><span class="token string">'L'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token punctuation">,</span><span class="token string">'O'</span><span class="token punctuation">,</span><span class="token string">'P'</span><span class="token punctuation">,</span><span class="token string">'Q'</span><span class="token punctuation">,</span><span class="token string">'R'</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">'U'</span><span class="token punctuation">,</span><span class="token string">'V'</span><span class="token punctuation">,</span><span class="token string">'W'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'AA'</span><span class="token punctuation">,</span><span class="token string">'AB'</span><span class="token punctuation">,</span><span class="token string">'AC'</span><span class="token punctuation">,</span><span class="token string">'AD'</span><span class="token punctuation">,</span><span class="token string">'AE'</span><span class="token punctuation">,</span><span class="token string">'AF'</span><span class="token punctuation">,</span><span class="token string">'AG'</span><span class="token punctuation">,</span><span class="token string">'AH'</span><span class="token punctuation">,</span><span class="token string">'AI'</span><span class="token punctuation">,</span><span class="token string">'AJ'</span><span class="token punctuation">,</span><span class="token string">'AK'</span><span class="token punctuation">,</span><span class="token string">'AL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//循环设置列宽</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getColumnDimension</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 清空（擦掉）输出缓冲区</span>        <span class="token function">ob_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//xls总列数</span>        <span class="token variable">$cellNum</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$xlsCell</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//chr()该函数用于将ASCII码值转化为字符串</span>        <span class="token comment" spellcheck="true">//ord()该函数用于将字符串转化为ASCII码值</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cellName1</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$cellNum</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">></span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$key2</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$cellName1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token operator">>=</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$cellName1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$cellName1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token variable">$key</span> <span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//设置单元格值&amp;合并单元格</span>        <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">"费用信息"</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置align</span>        <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getStyle</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getAlignment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setHorizontal</span><span class="token punctuation">(</span><span class="token string">'center'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">mergeCells</span><span class="token punctuation">(</span><span class="token string">'A1:'</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$cellName1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//合并</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$cellNum</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setActiveSheetIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token variable">$xlsCell</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getStyle</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getAlignment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setHorizontal</span><span class="token punctuation">(</span><span class="token string">'center'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//查询的结果集总数</span>        <span class="token variable">$dataNum</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$toll_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$dataNum</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token variable">$cellNum</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$toll_list</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$xlsCell</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$xlsName</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$xlsTitle</span> <span class="token operator">=</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'gb2312'</span><span class="token punctuation">,</span> <span class="token variable">$xlsName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名称</span>        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token variable">$xlsTitle</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//or $xlsTitle 文件名称可根据自己情况设定</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'pragma:public'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-type:application/vnd.ms-excel;charset=utf-8;name="'</span><span class="token punctuation">.</span><span class="token variable">$xlsTitle</span><span class="token punctuation">.</span><span class="token string">'.xls"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition:attachment;filename=$fileName.xls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//attachment新窗口打印inline本窗口打印</span>        <span class="token variable">$objWriter</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createWriter</span><span class="token punctuation">(</span><span class="token variable">$objPHPExcel</span><span class="token punctuation">,</span> <span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//output');</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>学习阶段，写的不是很好，有哪些错误还需要欢迎指出!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/categories/PHP/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="Excel" scheme="https://chiwai.tang99.club/tags/Excel/"/>
    
      <category term="导出" scheme="https://chiwai.tang99.club/tags/%E5%AF%BC%E5%87%BA/"/>
    
  </entry>
  
  <entry>
    <title>js遍历数组输出进行排序方法</title>
    <link href="https://chiwai.tang99.club/posts/3524924122.html"/>
    <id>https://chiwai.tang99.club/posts/3524924122.html</id>
    <published>2019-10-11T14:17:30.000Z</published>
    <updated>2019-10-15T14:05:20.549Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="js遍历对象输出时真的是按照顺序输出的吗？"><a href="#js遍历对象输出时真的是按照顺序输出的吗？" class="headerlink" title="js遍历对象输出时真的是按照顺序输出的吗？"></a>js遍历对象输出时真的是按照顺序输出的吗？</h1><p>&nbsp;&nbsp;&nbsp;前两天在工作中遇到一个问题，js在获取后端数据遍历输出时，要根据自定义属性进行规则排序，可在排序时就发生了顺序颠倒的问题。<br>先来两个实例:</p><pre class="line-numbers language-javascript"><code class="language-javascript">    <span class="token keyword">var</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        <span class="token number">1</span><span class="token punctuation">:</span><span class="token string">'aaa'</span><span class="token punctuation">,</span>        name<span class="token punctuation">:</span><span class="token string">'abc'</span><span class="token punctuation">,</span>        <span class="token string">'3'</span><span class="token punctuation">:</span><span class="token string">'ccc'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">,</span>        school<span class="token punctuation">:</span><span class="token string">'sdfds'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>输出:[“1”, “3”, “name”, “age”, “school”]  </p></blockquote><p>换一下位置:  </p><pre class="line-numbers language-javascript"><code class="language-javascript"> <span class="token keyword">var</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span><span class="token string">'aaa'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token string">'abc'</span><span class="token punctuation">,</span>        <span class="token string">'3'</span><span class="token punctuation">:</span><span class="token string">'ccc'</span><span class="token punctuation">,</span>        <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">,</span>        school<span class="token punctuation">:</span><span class="token string">'sdfds'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>输出:[“1”, “3”, “name”, “age”, “school”]</p></blockquote><p>&nbsp;&nbsp;&nbsp;所以，对象的遍历输出并不是按照顺序来的，那么是按照什么规则来的呢，仔细深入研究你会发现，这还跟浏览器有关系，Chrome跟IE是不一样的，所以给出以下结论:  </p><p>&nbsp;&nbsp;&nbsp;Chrome Opera 的 JavaScript 解析引擎遵循的是新版 ECMA-262 第五版规范。因此，使用 for-in 语句遍历对象属性时遍历书序并非属性构建顺序。而 IE6 IE7 IE8 Firefox Safari 的 JavaScript 解析引擎遵循的是较老的 ECMA-262 第三版规范，属性遍历顺序由属性构建的顺序决定。  </p><p>&nbsp;&nbsp;&nbsp;Chrome Opera 中使用 for-in 语句遍历对象属性时会遵循一个规律：<br>&nbsp;&nbsp;&nbsp;它们会先提取所有 key 的 parseFloat 值为非负整数的属性，然后根据数字顺序对属性排序首先遍历出来，然后按照对象定义的顺序遍历余下的所有属性。  </p><p>&nbsp;&nbsp;&nbsp;那么,怎么解决呢？<br>可以把对象通过Object.keys提取对象的key出来变成数组，然后通过数组的排序，然后遍历数组，通过key去取对象的属性值。  </p><h1 id="js数组遍历排序方法"><a href="#js数组遍历排序方法" class="headerlink" title="js数组遍历排序方法"></a>js数组遍历排序方法</h1><blockquote><p>大家都知道数组的遍历是按照顺序的，那么当一个数组中放了很多对象，想要按照对象的某个属性去排序数组需要怎么处理呢？</p></blockquote><p>直接上代码:  </p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> compare <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> val1 <span class="token operator">=</span> obj1<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> val2 <span class="token operator">=</span> obj2<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>val1 <span class="token operator">&lt;</span> val2<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val1 <span class="token operator">></span> val2<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span>  <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>financial_list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token string">'sp_sort'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>其中’financial_list’表示数组信息<br>  ‘sp_sort’表示按照这个字段进行排序</p></blockquote><p>注:尊重原创，这是一篇转载内容。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://chiwai.tang99.club/categories/JavaScript/"/>
    
    
      <category term="Js数组排序" scheme="https://chiwai.tang99.club/tags/Js%E6%95%B0%E7%BB%84%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>hexo-admin安装使用及遇到的问题</title>
    <link href="https://chiwai.tang99.club/posts/2672848395.html"/>
    <id>https://chiwai.tang99.club/posts/2672848395.html</id>
    <published>2019-10-08T10:10:24.000Z</published>
    <updated>2020-01-22T13:18:21.634Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="hexo-admin安装使用及遇到得问题"><a href="#hexo-admin安装使用及遇到得问题" class="headerlink" title="hexo-admin安装使用及遇到得问题"></a>hexo-admin安装使用及遇到得问题</h1><h1 id="安装hexo-admin"><a href="#安装hexo-admin" class="headerlink" title="安装hexo-admin"></a>安装hexo-admin</h1><h2 id="1-安装管理-amp-启动"><a href="#1-安装管理-amp-启动" class="headerlink" title="1.安装管理&amp;启动"></a>1.安装管理&amp;启动</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save hexo-adminhexo ghexo shttp://localhost:4000/admin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>效果图:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008203407.png" alt="效果图"></p><h2 id="2-设置密码"><a href="#2-设置密码" class="headerlink" title="2.设置密码"></a>2.设置密码</h2><blockquote><p>点击Settings &gt; Setup authentification  </p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008204004.png" alt="按照顺序点击"></p><h2 id="3-填写用户名和密码"><a href="#3-填写用户名和密码" class="headerlink" title="3.填写用户名和密码"></a>3.填写用户名和密码</h2><p> <img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008204649.png" alt="填写相应功能"></p><blockquote><p>username 表示你的用户名<br>  password 你的密码<br>  将信息添加到根目录下_config.yml文件内</p></blockquote><h1 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h1><h2 id="1-错误信息-Config-value-“admin-deployCommand”-not-found"><a href="#1-错误信息-Config-value-“admin-deployCommand”-not-found" class="headerlink" title="1.错误信息:Config value “admin.deployCommand” not found"></a>1.错误信息:Config value “admin.deployCommand” not found</h2><p>当你第一次点击 Deploy 按钮时,可能会遇到上面的问题，是因为缺少了执行的deploy命令,如图:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008205553.png" alt="错误信息"><br>解决方法:<br>在项目中创建hexo-deploy.sh文件并设置权限  </p><blockquote><p>$ touch hexo-deploy.sh; chmod a+x hexo-deploy.sh</p></blockquote><p>在文件内写入一下内容</p><blockquote><p>  hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008210152.png" alt="写入以上内容"></p><p>编辑配置文件<br>在根目录_config.yml配置文件中，在之前配置的admin配置信息下加入<code>deployCommand: &#39;./hexo-deploy.sh&#39;</code> 信息<br>如图所示:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008211142.png" alt="添加以上信息"></p><h2 id="2-错误信息deploy-Error-spawn-UNKNOWN"><a href="#2-错误信息deploy-Error-spawn-UNKNOWN" class="headerlink" title="2.错误信息deploy Error: spawn UNKNOWN"></a>2.错误信息deploy Error: spawn UNKNOWN</h2><p>在解决完上述错误信息后，将会报出<em>deploy Error: spawn UNKNOWN</em>错误信息<br>解决方法:  </p><blockquote><p>打开node_modules目录下hexo-admin目录下deploy.js<br>  将<code>var proc = spawn(command, [message], {detached: true});</code>改为<br>  <code>var proc = spawn((process.platform === &quot;win32&quot; ? &quot;hexo.cmd&quot; : &quot;hexo&quot;), [&#39;d&#39;]);</code></p></blockquote><p>如图所示:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008212700.png" alt="更改以上信息"></p><p>改完之后就ok啦，上图庆祝一下<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008212954.png" alt="该内容为成功"></p><p>参考以下资料信息:<br><a href="https://github.com/jaredly/hexo-admin/issues/70" target="_blank" rel="noopener">错误信息:Config value “admin.deployCommand” not found</a><br><a href="https://github.com/jaredly/hexo-admin/issues/94" target="_blank" rel="noopener">错误信息:deploy Error: spawn UNKNOWN</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="hexo" scheme="https://chiwai.tang99.club/categories/hexo/"/>
    
    
      <category term="hexo-admin" scheme="https://chiwai.tang99.club/tags/hexo-admin/"/>
    
  </entry>
  
</feed>
