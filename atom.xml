<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>志伟&amp;博客</title>
  
  <subtitle>Chi-wai blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="%5Bobject%20Object%5D" rel="hub"/>
  <link href="https://chiwai.tang99.club/"/>
  <updated>2020-03-16T08:05:31.160Z</updated>
  <id>https://chiwai.tang99.club/</id>
  
  <author>
    <name>志伟</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>openlayers3简单demo实现</title>
    <link href="https://chiwai.tang99.club/posts/2687365199.html"/>
    <id>https://chiwai.tang99.club/posts/2687365199.html</id>
    <published>2020-03-13T01:34:02.000Z</published>
    <updated>2020-03-16T08:05:31.160Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;OpenLayers 初始化一幅地图(map)，至少需要一个可视区域(view)，一个或多个图层( layer)， 和 一个地图加载的目标 HTML 标签(target)，其中最重要的是图层( layer)。<br>&nbsp;&nbsp;&nbsp;&nbsp;其中Source和Layer是一对一的关系，有一个Source，必然需要一个Layer，然后把这个Layer添加到Map上，就可以显示出来了。通过官网的API搜索ol.source可以发现有很多不同的Source，但归纳起来共三种：ol.source.Tile，ol.source.Image和ol.source.Vector。</p><h2 id="可视区域"><a href="#可视区域" class="headerlink" title="可视区域"></a>可视区域</h2><pre class="line-numbers language-html"><code class="language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span><span class="token number">800</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="初始化图层"><a href="#初始化图层" class="headerlink" title="初始化图层"></a>初始化图层</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//初始化图层</span><span class="token function">bindmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 创建地图</span>    that<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        target<span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>        renderer<span class="token punctuation">:</span> <span class="token string">'canvas'</span><span class="token punctuation">,</span>        controls<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            zoom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            attribution<span class="token punctuation">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        logo<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        view<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">117.0</span><span class="token punctuation">,</span> <span class="token number">39.77</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">//设置香河为中心点，此处进行坐标转换， 把EPSG:4326的坐标，转换为EPSG:3857坐标，因为ol默认使用的是EPSG:38 57坐标</span>            <span class="token comment" spellcheck="true">// center: ol.proj.transform([117.0, 39.77], 'EPSG:4326', 'EPSG:3857'),</span>            projection<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"EPSG:4326"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// extent:[0,0,117.0,39.77],</span>            <span class="token comment" spellcheck="true">// minZoom:7,</span>            <span class="token comment" spellcheck="true">// maxZoom:18,</span>            zoom<span class="token punctuation">:</span> <span class="token number">12</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 设置地图图层</span>    <span class="token comment" spellcheck="true">// 创建一个使用Open Street Map地图源的瓦片图层</span>    <span class="token keyword">let</span> layers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        source<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// source: new ol.source.TileSuperMapRest({</span>        <span class="token comment" spellcheck="true">//     url: 'http://000.000.000.00:45622/iserver/services/map-HT_Map_SL/rest/maps/HT_Map_Blue',</span>        <span class="token comment" spellcheck="true">//     wrapX: false,</span>        <span class="token comment" spellcheck="true">//     transparent: true</span>        <span class="token comment" spellcheck="true">// })</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    that<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>layers<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成地图点位信息"><a href="#生成地图点位信息" class="headerlink" title="生成地图点位信息"></a>生成地图点位信息</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 创建地图点位信息  */</span><span class="token function">createMark</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> Features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> option<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> startMarker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span> <span class="token string">"p1"</span><span class="token punctuation">,</span>            type<span class="token punctuation">:</span> <span class="token string">"icon"</span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>            geometry<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>point<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Features<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>startMarker<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// var vectorSource = new ol.source.Vector({});</span>        <span class="token comment" spellcheck="true">// vectorSource.addFeature(startMarker);</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        source<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            features<span class="token punctuation">:</span> Features        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Icon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                anchor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                src<span class="token punctuation">:</span> option<span class="token punctuation">.</span>src<span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">// size: [50, 20],</span>                scale<span class="token punctuation">:</span> <span class="token number">1</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        visible<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>    that<span class="token punctuation">.</span>layer_list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// type: option.p1id,</span>        <span class="token comment" spellcheck="true">// type2: option.p2id,</span>        layer<span class="token punctuation">:</span> vectorLayer<span class="token punctuation">,</span>        show<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//地图点位点击事件</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> feature <span class="token operator">=</span> that<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">forEachFeatureAtPixel</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>pixel<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>            feature<span class="token punctuation">,</span>            layer        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> feature<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> feature<span class="token punctuation">.</span>N<span class="token punctuation">;</span>        that<span class="token punctuation">.</span>info <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">;</span>        that<span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//data 为 写入的数据</span>        <span class="token comment" spellcheck="true">// that.tu_list = data.data.info;</span>        <span class="token comment" spellcheck="true">// that.showtable = true;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//pc端加载页面时窗口大小发生变化，导致无法点击点位信息</span>    window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成多边形"><a href="#生成多边形" class="headerlink" title="生成多边形"></a>生成多边形</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 根据点位生成多边形 */</span><span class="token function">createPolygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>SList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> _points <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//点位</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token keyword">in</span> _points<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span> wrapX<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//创建用于绘制形状的图层</span>            <span class="token keyword">var</span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                source<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>siteStyle<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置图层样式</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将图层添加至地图</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>mapLayer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//获取点位对象</span>            <span class="token comment" spellcheck="true">// console.log(_points);</span>            <span class="token keyword">var</span> feature <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                geometry<span class="token punctuation">:</span> geometry            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//点位转换为图形对象</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addFeatures</span><span class="token punctuation">(</span><span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将图形添加至目标图层</span>            c<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="获取图形坐标值"><a href="#获取图形坐标值" class="headerlink" title="获取图形坐标值"></a>获取图形坐标值</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* * 获取图形值 */</span><span class="token function">getMapInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token function">postRequest</span><span class="token punctuation">(</span><span class="token string">'/Huanbao/getMapPoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            that<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            that<span class="token punctuation">.</span>pointList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            that<span class="token punctuation">.</span>siteStyle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                that<span class="token punctuation">.</span>pointList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lnglat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">let</span> color <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"rgb("</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/ /g</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>siteStyle<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>                    <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                        fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            color<span class="token punctuation">:</span>                                <span class="token string">"rgba("</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">","</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">","</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">",0.1)"</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">// color:</span>                            <span class="token comment" spellcheck="true">//     "rgba(" +</span>                            <span class="token comment" spellcheck="true">//     color[0] +</span>                            <span class="token comment" spellcheck="true">//     "," +</span>                            <span class="token comment" spellcheck="true">//     color[1] +</span>                            <span class="token comment" spellcheck="true">//     "," +</span>                            <span class="token comment" spellcheck="true">//     color[2] +</span>                            <span class="token comment" spellcheck="true">//     ",0.8)",</span>                            color<span class="token punctuation">:</span> that<span class="token punctuation">.</span>color1<span class="token punctuation">,</span>                            width<span class="token punctuation">:</span> <span class="token number">1</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token comment" spellcheck="true">//在地图上显示文字信息</span>                        text<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                             text<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentName<span class="token punctuation">,</span>                             scale<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">,</span>                             fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                               color<span class="token punctuation">:</span> <span class="token string">'#000000'</span>                             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                             stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                               color<span class="token punctuation">:</span> <span class="token string">'#FFFF99'</span><span class="token punctuation">,</span>                               width<span class="token punctuation">:</span> <span class="token number">3.5</span>                             <span class="token punctuation">}</span><span class="token punctuation">)</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            that<span class="token punctuation">.</span><span class="token function">createPolygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="根据经纬度定位"><a href="#根据经纬度定位" class="headerlink" title="根据经纬度定位"></a>根据经纬度定位</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @param {array} viewCenter 经纬度 * @param {int} viewZoom * 根据经纬度定位 */</span><span class="token function">changeMapView</span><span class="token punctuation">(</span>viewCenter<span class="token punctuation">,</span> viewZoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> viewOptions <span class="token operator">=</span> <span class="token punctuation">{</span>        duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>        center<span class="token punctuation">:</span> viewCenter<span class="token punctuation">,</span>        zoom<span class="token punctuation">:</span> viewZoom    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>viewOptions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="地图放大"><a href="#地图放大" class="headerlink" title="地图放大"></a>地图放大</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="地图缩小"><a href="#地图缩小" class="headerlink" title="地图缩小"></a>地图缩小</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="回到起始位置"><a href="#回到起始位置" class="headerlink" title="回到起始位置"></a>回到起始位置</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">initAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeMapView</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">117.0</span><span class="token punctuation">,</span> <span class="token number">39.77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>参考附件下载<br><a href="/download/index.vue" ">点击下载</a><br><a href="/download/index1.vue" ">点击下载</a><br><a href="/download/index2.vue" ">点击下载</a></p><blockquote><p>参考资料:<br><a href="https://www.cnblogs.com/benmumu/p/8081068.html" target="_blank" rel="noopener">https://www.cnblogs.com/benmumu/p/8081068.html</a><br><a href="https://blog.csdn.net/qingyafan/article/details/45398131" target="_blank" rel="noopener">https://blog.csdn.net/qingyafan/article/details/45398131</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="地图" scheme="https://chiwai.tang99.club/categories/%E5%9C%B0%E5%9B%BE/"/>
    
    
      <category term="Openlayers3" scheme="https://chiwai.tang99.club/tags/Openlayers3/"/>
    
  </entry>
  
  <entry>
    <title>Windows2012安装IIS中.NET Framework3.5报错</title>
    <link href="https://chiwai.tang99.club/posts/724213894.html"/>
    <id>https://chiwai.tang99.club/posts/724213894.html</id>
    <published>2020-03-06T13:29:36.000Z</published>
    <updated>2020-03-17T14:05:42.190Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;windows2012安装IIS中.net framework3.5报错，提示：安装安装一个或多个角色、角色服务或功能失败或者一个或多个安装选项在目标服务器上缺少源文件，或者找不到源文件等错误信息。<br>原因是.net framework3.5程序源文件找不到所导致的。<br>如图所示:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/2017525170334427.jpg" alt><br>解决方法为可以通过PowerShell 脚本进行安装。<br>1.在开始菜单中找到PowerShell，右键单击选择以管理员身份运行。<br>2.输入以下脚本，按回车执行。</p><pre class="line-numbers language-ini"><code class="language-ini">Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU' -Name UseWUServer -Value 0Restart-Service -Name wuauservInstall-WindowsFeature Net-Framework-CoreSet-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU' -Name UseWUServer -Value 1Restart-Service -Name wuauserv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此刻再回到服务管理器-&gt;添加角色功能-&gt;功能中，就看到.Net Framework 3.5安装成功。</p><p>参考文章:<br><a href="https://www.wanweiwang.cn/FAQ/view/1006.html" target="_blank" rel="noopener">https://www.wanweiwang.cn/FAQ/view/1006.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="服务器" scheme="https://chiwai.tang99.club/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="安装" scheme="https://chiwai.tang99.club/tags/%E5%AE%89%E8%A3%85/"/>
    
      <category term="IIS" scheme="https://chiwai.tang99.club/tags/IIS/"/>
    
  </entry>
  
  <entry>
    <title>PHP导入功能</title>
    <link href="https://chiwai.tang99.club/posts/549686560.html"/>
    <id>https://chiwai.tang99.club/posts/549686560.html</id>
    <published>2020-03-02T00:42:19.000Z</published>
    <updated>2020-03-14T00:52:41.919Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>PHP实现导入功能，功能简单大众化，简单记录方便后续使用。</p></blockquote><p>前端部分</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>upload-demo<span class="token punctuation">"</span></span>    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/index.php/admin/Auditors/importTable2<span class="token punctuation">"</span></span>    <span class="token attr-name">:show-file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>    <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleAvatarSuccessq<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn-look<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Excel导入<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//导入</span>    <span class="token function">handleAvatarSuccessq</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"导入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> searchData <span class="token operator">=</span> <span class="token punctuation">{</span>          pageNow<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          company_id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>companyId        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userlist</span><span class="token punctuation">(</span>searchData<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>后端</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">importTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$param</span><span class="token operator">=</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">'./static/upload/importfile'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$zhui</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$zhui</span><span class="token operator">!=</span><span class="token string">'xls'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$zhui</span><span class="token operator">!=</span><span class="token string">'xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'请上传正确的模板文件'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./static/upload/importfile/'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"PHPExcel"</span><span class="token punctuation">,</span> <span class="token constant">EXTEND_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'xlsx'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$objReader</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReader</span><span class="token punctuation">(</span><span class="token string">'Excel2007'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$objReader</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReader</span><span class="token punctuation">(</span><span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$objPHPExcel</span> <span class="token operator">=</span> <span class="token variable">$objReader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$encode</span> <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sheet</span> <span class="token operator">=</span> <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$highestRow</span> <span class="token operator">=</span> <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHighestRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 取得总行数</span>        <span class="token variable">$highestColumn</span> <span class="token operator">=</span> <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHighestColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 取得总列数</span>        <span class="token comment" spellcheck="true">//验证</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$highestRow</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//涉及企业级次</span>            <span class="token variable">$cname</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getLevelZhuanName</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，C列输入的涉及企业级次不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否上市公司</span>                <span class="token variable">$isShang</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token variable">$isShang</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，D列输入的是否上市公司不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//问题线索来源</span>                <span class="token variable">$source</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanSourceName</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，E列输入的问题线索来源不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//问题类别</span>                <span class="token variable">$qtype</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"H"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanQtypeName</span><span class="token punctuation">(</span><span class="token variable">$qtype</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，H列输入的问题类别不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//境内（外）</span>                <span class="token variable">$jing</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"J"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanJnInfo</span><span class="token punctuation">(</span><span class="token variable">$jing</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，J列输入的境内（外）不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否完成核查</span>                <span class="token variable">$he</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"M"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanCheck</span><span class="token punctuation">(</span><span class="token variable">$he</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，M列输入的是否完成核查不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//核查主体</span>                <span class="token variable">$main</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"N"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanCheckMain</span><span class="token punctuation">(</span><span class="token variable">$main</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，N列输入的核查主体不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//损失认定类别</span>                <span class="token variable">$sun</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"W"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanLossTypeName</span><span class="token punctuation">(</span><span class="token variable">$sun</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，W列输入的损失认定类别不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否完成</span>                <span class="token variable">$iswan</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token variable">$iswan</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，BK列输入的是否完成不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//插入</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$highestRow</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$cname</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//基本信息</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及企业名称</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'level'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getLevelZhuanName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及企业级次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'isShang'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否上市公司</span>                <span class="token comment" spellcheck="true">//问题受理</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanSourceName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题线索来源</span>                <span class="token variable">$acceptTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"F"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$acceptTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'acceptTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$acceptTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题受理时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'descript'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"G"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题简要描述</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'qtype'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanQtypeName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"H"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题类别</span>                <span class="token variable">$occurTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"I"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$occurTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'occurTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$occurTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题发生时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'domestic'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanJnInfo</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"J"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//境内（外）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'riskLose'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"K"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//预估损失风险（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'measures'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"L"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采取的应对措施</span>                <span class="token comment" spellcheck="true">//核查情况</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'ischeck'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanCheck</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"M"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否完成核查</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkMain'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanCheckMain</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"N"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查主体</span>                <span class="token variable">$checkEndTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"O"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$checkEndTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkEndTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$checkEndTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查结束时间</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//违规事实</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkResultDescript'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"P"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查结果简要简要描述</span>                <span class="token variable">$name</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Q"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$names</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$whedd</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'in'</span><span class="token punctuation">,</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$ppid</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'duty_report_involved'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$whedd</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$personIds</span><span class="token operator">=</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token variable">$ppid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$personIds</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'involved'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$personIds</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及人员</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'violation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"R"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//违反具体规定</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'violationType'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"S"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//违反规定类别</span>                <span class="token comment" spellcheck="true">//损失认定</span>                <span class="token variable">$lossTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"T"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$lossTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$lossTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失确认时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"U"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失金额（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'loseRiskPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"V"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失风险金额（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossType'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanLossTypeName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"W"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失认定类别</span>                <span class="token comment" spellcheck="true">//责任认定</span>                <span class="token variable">$responTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"X"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$responTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'responTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$responTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责任认定时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'totalNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Y"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'mtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Z"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//中管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'wtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AA"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//委管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'qtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AB"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//企业管理干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'totalVisits'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AC"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'mleaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AD"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//重要领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'fleaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AE"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//分管领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'leaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AF"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'superRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AG"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//主管责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'dircetRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AH"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//直接责任</span>                <span class="token comment" spellcheck="true">//责任追究</span>                <span class="token variable">$accountabilityTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AI"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$accountabilityTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'accountabilityTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$accountabilityTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责任追究时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atotalNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AJ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//中管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'awtubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AL"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//委管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'aqtubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AM"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//企业管理干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atotalVisits'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AN"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'aztNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AO"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'comEducation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AP"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//批评教育</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'inspection'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AQ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责令书面检查</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'criticism'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AR"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//通报批评</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'exhortation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AS"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//诫勉</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'suspend'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AT"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//停职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'outOfWork'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AU"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//调离工作岗位</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'demote'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AV"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//降职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'nonLeadership'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AW"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//改任非领导职务</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'resign'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AX"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责令辞职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'remove'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AY"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//免职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'krtotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AZ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'deductionAmount'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BA"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//扣减金额(万元)</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'zjtotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BB"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'noEntryTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BC"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//禁入时间(年)</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'zjltotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BD"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'warn'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BE"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//警告</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'impWarn'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BF"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//严重警告</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'revPosition'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BG"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//撤销党内职务</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'stayInspection'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BH"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//留党察看</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'expel'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BI"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开除党籍</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'judicial'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BJ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//移送国家监察机关或司法机关人次</span>                <span class="token comment" spellcheck="true">//整改落实</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'isOver'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否完成</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'reason'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BL"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//未完成原因</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cLossPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BM"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cLossRiskPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BN"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失风险（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cwNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BO"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//个数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'releaseTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BP"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//制度名称及出台时间</span>                <span class="token comment" spellcheck="true">//备注</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'note'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BQ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//备注</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'rid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'rid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'update_by'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'update_date'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'create_by'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'create_date'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'company_id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.company_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'duty_report_detail'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'导入成功'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="导入" scheme="https://chiwai.tang99.club/tags/%E5%AF%BC%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>PHP基于phpqrcode类生成二维码</title>
    <link href="https://chiwai.tang99.club/posts/123876002.html"/>
    <id>https://chiwai.tang99.club/posts/123876002.html</id>
    <published>2020-01-31T06:06:29.000Z</published>
    <updated>2020-01-31T12:40:06.606Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="phpqrcode下载地址"><a href="#phpqrcode下载地址" class="headerlink" title="phpqrcode下载地址"></a>phpqrcode下载地址</h1><blockquote><p>地址：<a href="http://phpqrcode.sourceforge.net/" target="_blank" rel="noopener">http://phpqrcode.sourceforge.net/</a><br>下载：<a href="http://sourceforge.net/projects/phpqrcode/" target="_blank" rel="noopener">http://sourceforge.net/projects/phpqrcode/</a></p></blockquote><p>&emsp;&emsp;下载官网提供的类库后，只需要使用<span style="color:red;font-weight:bold;">phpqrcode.php</span>就可以生成二维码了，当然您的PHP环境必须开启支持GD2。它是一个多个类的集合文件，我们需要用到里边的<span style="color:red;font-weight:bold;">QRcode类的png()</span>方法;</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token variable">$outfile</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$level</span> <span class="token operator">=</span> <span class="token constant">QR_ECLEVEL_L</span><span class="token punctuation">,</span> <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token variable">$margin</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token variable">$saveandprint</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$enc</span> <span class="token operator">=</span> QRencode<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token punctuation">,</span> <span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token variable">$margin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$enc</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encodePNG</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token variable">$outfile</span><span class="token punctuation">,</span> <span class="token variable">$saveandprint</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><blockquote><p><span style="color:red;font-weight:bold;">$text</span>表示生成二位的的信息文本<br> <span style="color:red;font-weight:bold;">$outfile</span>表示是否输出二维码图片文件，默认否<br> <span style="color:red;font-weight:bold;">$level</span>表示容错率，也就是有被覆盖的区域还能识别，分别:L（QR_ECLEVEL_L，7%），M（QR_ECLEVEL_M，15%），Q（QR_ECLEVEL_Q，25%），H（QR_ECLEVEL_H，30%）<br> <span style="color:red;font-weight:bold;">$size</span>表示生成图片大小，默认是3<br> <span style="color:red;font-weight:bold;">$margin</span>表示二维码周围边框空白区域间距值<br> <span style="color:red;font-weight:bold;">$saveandprint</span>表示是否保存二维码并显示</p></blockquote><h1 id="调用-PHP-QRcode类"><a href="#调用-PHP-QRcode类" class="headerlink" title="调用 PHP QRcode类"></a>调用 PHP QRcode类</h1><pre class="line-numbers language-php"><code class="language-php">Loader<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'phpqrcode.phpqrcode'</span><span class="token punctuation">,</span><span class="token constant">EXTEND_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例:"></a>使用示例:</h1><h2 id="生成带有LOGO的二维码"><a href="#生成带有LOGO的二维码" class="headerlink" title="生成带有LOGO的二维码"></a>生成带有LOGO的二维码</h2><p>&emsp;&emsp;其实原理很简单，先使用QRcode类生成一张二维码图片，然后再利用php的image相关函数，将事先准备好的logo图片加入到刚生成的原始二维码图片中间，然后重新生成一张新的二维码图片。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//二维码内容</span>        <span class="token variable">$value</span> <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//chiwai.tang99.club';</span>        <span class="token variable">$errorCorrectionLevel</span> <span class="token operator">=</span> <span class="token string">'L'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//容错级别</span>        <span class="token variable">$matrixPointSize</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//生成图片大小</span>        <span class="token comment" spellcheck="true">//生成二维码图片</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./qrcode/'</span><span class="token punctuation">.</span><span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.png'</span><span class="token punctuation">;</span>        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'./qrcode'</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断是否存在上传到的目录</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        \<span class="token package">QRcode</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$errorCorrectionLevel</span><span class="token punctuation">,</span> <span class="token variable">$matrixPointSize</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//准备好的logo图片</span>        <span class="token variable">$logo</span> <span class="token operator">=</span> <span class="token string">'./static/logo1.png'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$logo</span> <span class="token operator">!==</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$QR</span> <span class="token operator">=</span> <span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$logo</span> <span class="token operator">=</span> <span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//二维码图片宽度</span>            <span class="token variable">$QR_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//二维码图片高度</span>            <span class="token variable">$QR_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//logo图片宽度</span>            <span class="token variable">$logo_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//logo图片高度</span>            <span class="token variable">$logo_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$logo_qr_width</span> <span class="token operator">=</span> <span class="token variable">$QR_width</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">;</span>            <span class="token variable">$scale</span> <span class="token operator">=</span> <span class="token variable">$logo_width</span><span class="token operator">/</span><span class="token variable">$logo_qr_width</span><span class="token punctuation">;</span>            <span class="token variable">$logo_qr_height</span> <span class="token operator">=</span> <span class="token variable">$logo_height</span><span class="token operator">/</span><span class="token variable">$scale</span><span class="token punctuation">;</span>            <span class="token variable">$from_width</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$QR_width</span> <span class="token operator">-</span> <span class="token variable">$logo_qr_width</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//重新组合图片并调整大小</span>            <span class="token function">imagecopyresampled</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span> <span class="token variable">$logo</span><span class="token punctuation">,</span> <span class="token variable">$from_width</span><span class="token punctuation">,</span> <span class="token variable">$from_width</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$logo_qr_width</span><span class="token punctuation">,</span> <span class="token variable">$logo_qr_height</span><span class="token punctuation">,</span> <span class="token variable">$logo_width</span><span class="token punctuation">,</span> <span class="token variable">$logo_height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//输出图片</span>        <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">'&lt;img src="'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span> <span class="token punctuation">.</span> <span class="token string">'">'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成二维码直接输出"><a href="#生成二维码直接输出" class="headerlink" title="生成二维码直接输出"></a>生成二维码直接输出</h2><blockquote><p>直接输出二维码只需要将参数二改为false。写die()是因为防止乱码</p></blockquote><pre class="line-numbers language-php"><code class="language-php">        <span class="token variable">$value</span><span class="token operator">=</span>"https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//chiwai.tang99.club";</span>        <span class="token variable">$errorCorrectionLevel</span><span class="token operator">=</span><span class="token string">"L"</span><span class="token punctuation">;</span>        <span class="token variable">$matrixPointSize</span><span class="token operator">=</span><span class="token string">"4"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//生成图片大小 ：1到10</span>        \<span class="token package">QRcode</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token variable">$errorCorrectionLevel</span><span class="token punctuation">,</span><span class="token variable">$matrixPointSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="更改二维码的颜色"><a href="#更改二维码的颜色" class="headerlink" title="更改二维码的颜色"></a>更改二维码的颜色</h2><blockquote><p>$QR表示生成的二维码</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$indexColor</span> <span class="token operator">=</span> <span class="token function">imagecolorexact</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">imagecolorset</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token variable">$indexColor</span><span class="token punctuation">,</span><span class="token number">148</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">211</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>参考资料:<br> <a href="http://phpqrcode.sourceforge.net/examples/index.php" target="_blank" rel="noopener">http://phpqrcode.sourceforge.net/examples/index.php</a><br> <a href="https://www.php.cn/php-weizijiaocheng-402924.html" target="_blank" rel="noopener">https://www.php.cn/php-weizijiaocheng-402924.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="二维码" scheme="https://chiwai.tang99.club/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Vue简单功能汇总</title>
    <link href="https://chiwai.tang99.club/posts/2780046153.html"/>
    <id>https://chiwai.tang99.club/posts/2780046153.html</id>
    <published>2020-01-30T08:40:05.000Z</published>
    <updated>2020-03-17T13:44:05.956Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="下拉刷新-加载分页"><a href="#下拉刷新-加载分页" class="headerlink" title="下拉刷新 加载分页"></a>下拉刷新 加载分页</h1><blockquote><p>引入两个文件<br>flush.js<br>PullUpReload.js</p></blockquote><h2 id="flush-js"><a href="#flush-js" class="headerlink" title="flush.js"></a>flush.js</h2><pre class="line-numbers language-html"><code class="language-html">Vue.component("flush", {    template: `<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>refresh-moudle<span class="token punctuation">"</span></span> <span class="token attr-name">@touchstart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchStart($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchmove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchMove($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchend</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchEnd($event)<span class="token punctuation">"</span></span> <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token string">'translate3d(0,'</span> + top + <span class="token string">'px, 0)'</span><span class="token punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pull-refresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pull-refresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>down-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropDownState<span class="token punctuation">=</span><span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;img v-if="dropDownInfo.downImg" class="down-img" :src="require('../../assets/images/refreshAndReload/'+dropDownInfo.downImg)">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>down-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{dropDownInfo.downText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>up-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropDownState<span class="token punctuation">=</span><span class="token punctuation">=</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;img v-if="dropDownInfo.upImg" class="up-img" :src="require('../../assets/images/refreshAndReload/'+dropDownInfo.upImg)">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>up-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{dropDownInfo.upText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>refresh-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropDownState<span class="token punctuation">=</span><span class="token punctuation">=</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;img v-if="dropDownInfo.refreshImg" class="refresh-img" :src="require('../../assets/images/loading/'+dropDownInfo.refreshImg)">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>refresh-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{dropDownInfo.refreshText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>`,    props: {        onRefresh: {            type: Function,            required: false        }    },    data() {        return {            defaultOffset: 50, // 默认高度, 相应的修改.releshMoudle的margin-top和.down-tip, .up-tip, .refresh-tip的height            top: 0,            scrollIsToTop: 0,            startY: 0,            isDropDown: false, // 是否下拉            isRefreshing: false, // 是否正在刷新            dropDownState: 1, // 显示1:下拉可以刷新, 2:松开立即刷新, 3:正在刷新数据中...            dropDownInfo: {                downText: '',                downImg: 'arrow.png',                upText: '松开立即刷新',                upImg: 'arrow.png',                refreshText: '正在刷新数据...',                refreshImg: 'loading.png'            }        }    },    created() {        if (document.querySelector('.down-tip')) {            // 获取不同手机的物理像素（dpr）,以便适配rem            this.defaultOffset = document.querySelector('.down-tip').clientHeight || this.defaultOffset        }    },    methods: {        /**         * 触摸开始，手指点击屏幕时         * @param {object} e Touch 对象包含的属性            */        touchStart(e) {            this.startY = e.targetTouches[0].pageY            // console.log(666);        },        /**         * 接触点改变，滑动时         * @param {object} e Touch 对象包含的属性         */        touchMove(e) {            this.scrollIsToTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop // safari 获取scrollTop用window.pageYOffset            if (e.targetTouches[0].pageY > this.startY) {                // 下拉                this.isDropDown = true                if (this.scrollIsToTop === 0 &amp;&amp; !this.isRefreshing) {                    // 拉动的距离                    let diff = e.targetTouches[0].pageY - this.startY - this.scrollIsToTop                    this.top = Math.pow(diff, 0.8) + (this.dropDownState === 3 ? this.defaultOffset : 0)                    if (this.top >= this.defaultOffset) {                        this.dropDownState = 2                        e.preventDefault()                    } else {                        this.dropDownState = 1                        // 去掉会导致ios无法刷新                        e.preventDefault()                    }                }            } else {                this.isDropDown = false                this.dropDownState = 1            }        },        /**         * 触摸结束，手指离开屏幕时         * @param {object} e Touch 对象包含的属性         */        touchEnd(e) {            if (this.isDropDown &amp;&amp; !this.isRefreshing) {                if (this.top >= this.defaultOffset) {                    // do refresh                    this.refresh()                    this.isRefreshing = true                } else {                    // cancel refresh                    this.isRefreshing = false                    this.isDropDown = false                    this.dropDownState = 1                    this.top = 0                }            }        },        /**         * 刷新         */        refresh() {            this.dropDownState = 3            this.top = this.defaultOffset            // 这是全是静态数据,延时1200毫秒，给用户一个刷新的感觉，如果是接口数据的话，直接调接口即可            // setTimeout(() => {                this.onRefresh(this.refreshDone)            // }, 1200)        },        /**         * 刷新完成         */        refreshDone() {            this.isRefreshing = false            this.isDropDown = false            this.dropDownState = 1            this.top = 0        }    }});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PullUpReload-js"><a href="#PullUpReload-js" class="headerlink" title="PullUpReload.js"></a>PullUpReload.js</h2><pre class="line-numbers language-html"><code class="language-html">Vue.component('pull',{    template:`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>load-moudle<span class="token punctuation">"</span></span> <span class="token attr-name">@touchstart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchStart($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchmove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchMove($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchend</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchend($event)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>load-more<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;slot name="load-more">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>more-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pullUpState<span class="token punctuation">=</span><span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>more-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{pullUpInfo.moreText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pullUpState<span class="token punctuation">=</span><span class="token punctuation">=</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-icon<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{pullUpInfo.loadingText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- &lt;div class="no-more-tip" v-if="pullUpState==3">    &lt;span class="connecting-line">&lt;/span>    &lt;span class="no-more-text">{{pullUpInfo.noMoreText}}&lt;/span>&lt;span class="connecting-line">&lt;/span>    &lt;/div>--></span><span class="token comment" spellcheck="true">&lt;!--    &lt;/slot>--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>`,    props: {        parentPullUpState: {            default: 0        },        onInfiniteLoad: {            type: Function,            require: false        }    },    data () {        return {            top: 0,            pullUpState: 0, // 1:上拉加载更多, 2:加载中……, 3:我是有底线的            isLoading: false, // 是否正在加载            pullUpInfo: {                moreText: '上拉加载更多',                loadingText: '数据加载中...',                noMoreText: '我是有底线的'            },            startX: 0,            startY: 0,            endX: 0,            endY: 0        }    },    methods: {        /**         * 触摸开始，手指点击屏幕时         * @param {object} e Touch 对象包含的属性         */        touchStart (e) {            this.startX = e.touches[0].pageX            this.startY = e.touches[0].pageY        },        /**         * 接触点改变，滑动时         * @param {object} e Touch 对象包含的属性         */        touchMove (e) {            this.endX = e.changedTouches[0].pageX            this.endY = e.changedTouches[0].pageY            let direction = this.getSlideDirection(this.startX, this.startY, this.endX, this.endY)            switch (direction) {                case 0:                    // console.log('没滑动')                    break                case 1:                    // console.log('向上')                    this.scrollToTheEnd()                    break                case 2:                    // console.log('向下')                    break                case 3:                    // console.log('向左')                    break                case 4:                    // console.log('向右')                    break                default:            }        },        /**         * 触摸结束，手指离开屏幕时         * @param {object} e Touch 对象包含的属性         */        touchend (e) {            this.isLoading = false        },        /**         * 判断滚动条是否到底         */        scrollToTheEnd () {            let innerHeight = document.querySelector('.load-moudle').clientHeight            // 变量scrollTop是滚动条滚动时，距离顶部的距离            let scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop            // 变量scrollHeight是滚动条的总高度            let scrollHeight = document.documentElement.clientHeight || document.body.scrollHeight            // 滚动条到底部的条件            if (scrollTop + scrollHeight >= innerHeight) {                if (this.pullUpState !== 3 &amp;&amp; !this.isLoading) {                    this.infiniteLoad()                }                // console.log('距顶部' + scrollTop + '滚动条总高度' + scrollHeight + '内容高度' + innerHeight)            }        },        /**         * 上拉加载数据         */        infiniteLoad () {            if (this.pullUpState !== 0) {                this.pullUpState = 2                this.isLoading = true                this.onInfiniteLoad(this.infiniteLoadDone)            }        },        /**         * 加载数据完成         */        infiniteLoadDone () {            this.pullUpState = 1        },        /**         * 返回角度         */        getSlideAngle (dx, dy) {            return Math.atan2(dy, dx) * 180 / Math.PI        },        /**         * 根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动         * @param {number} startX X轴开始位置         * @param {number} startY X轴结束位置         * @param {number} endX Y轴开始位置         * @param {number} endY Y轴结束位置         */        getSlideDirection (startX, startY, endX, endY) {            let dy = startY - endY            let dx = endX - startX            let result = 0            // 如果滑动距离太短            if (Math.abs(dx) &lt; 2 &amp;&amp; Math.abs(dy) &lt; 2) {                return result            }            let angle = this.getSlideAngle(dx, dy)            if (angle >= -45 &amp;&amp; angle &lt; 45) {                result = 4            } else if (angle >= 45 &amp;&amp; angle &lt; 135) {                result = 1            } else if (angle >= -135 &amp;&amp; angle &lt; -45) {                result = 2            } else if ((angle >= 135 &amp;&amp; angle &lt;= 180) || (angle >= -180 &amp;&amp; angle &lt; -135)) {                result = 3            }            return result        }    },    watch: {        parentPullUpState (curVal, oldVal) {            this.pullUpState = curVal        }    }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><blockquote><p>将需要滑动的地方套上以下闭合代码</p></blockquote><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flush</span> <span class="token attr-name">:on-refresh</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onRefresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pull</span> <span class="token attr-name">:on-infinite-load</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onInfiniteLoad<span class="token punctuation">"</span></span> <span class="token attr-name">:parent-pull-up-state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>infiniteLoadData.pullUpState<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pull</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flush</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>例如、</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>new-list<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">padding-top</span><span class="token punctuation">:</span><span class="token number">40</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flush</span> <span class="token attr-name">:on-refresh</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onRefresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pull</span> <span class="token attr-name">:on-infinite-load</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onInfiniteLoad<span class="token punctuation">"</span></span> <span class="token attr-name">:parent-pull-up-state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>infiniteLoadData.pullUpState<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          &lt;div class="a-list" v-for="item in pic":key="item.index" @click="getPic(item)">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-span<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-tit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.created_at}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-img<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.thumbnail<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>无法加载<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pull</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flush</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>然后写入vue.js中写入如下</p></blockquote><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                show<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                activeIndex1<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                pic<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                showList<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                active<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                activeIndex<span class="token punctuation">:</span> <span class="token string">'j'</span><span class="token punctuation">,</span>                townIndex<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                villageIndex<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>                area<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// id:370321001,</span>                    <span class="token comment" spellcheck="true">// name:"索镇",</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                areaList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                villageList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                isShowVillage<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//镇</span>                zhen<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//村</span>                cun<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                infiniteLoadData<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    initialShowNum<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 初始显示多少条</span>                    everyLoadingNum<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 每次加载的个数</span>                    pullUpState<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 子组件的pullUpState状态</span>                    pullUpList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 上拉加载更多数据的数组</span>                    showPullUpListLength<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>initialShowNum <span class="token comment" spellcheck="true">// 上拉加载后所展示的个数</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                search<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                    limit<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>                    total<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    none<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                    area<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        mounted<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token function">onRefresh</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 如果下拉刷新和上拉加载同时使用，下拉时初始化上拉的数据</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reflush</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">onInfiniteLoad</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">reflush</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//刷新数据  下拉刷新</span>                <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>pic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>none <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//有下一页</span>                that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//有下一页</span>                that<span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">//发送数据请求方法</span>            <span class="token function">http</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                <span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token string">'/Wenming/lists'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    town<span class="token punctuation">:</span> that<span class="token punctuation">.</span>zhen<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                    villagei<span class="token punctuation">:</span> that<span class="token punctuation">.</span>cun<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                    page<span class="token punctuation">:</span> that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>page<span class="token punctuation">,</span>                    limit<span class="token punctuation">:</span> that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>limit<span class="token punctuation">,</span>                    activeIndex<span class="token punctuation">:</span> that<span class="token punctuation">.</span>activeIndex<span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>none<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>pic <span class="token operator">=</span> that<span class="token punctuation">.</span>pic<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>pic<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>page<span class="token operator">++</span><span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>total <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//还可以加载</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>none <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//没有数据了</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> done <span class="token operator">==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> done <span class="token operator">==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">getActive</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">==</span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//切换选项卡时重新回到顶部</span>                window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//重新刷新</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reflush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">cities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                <span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token string">'/Wenming/zhen'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>areaList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>area <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        that<span class="token punctuation">.</span><span class="token function">reflush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">black</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShowVillage<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>x <span class="token operator">></span> <span class="token number">261</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>x <span class="token operator">></span> <span class="token number">132</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="在滑动加载分页数据时遇到的问题！"><a href="#在滑动加载分页数据时遇到的问题！" class="headerlink" title="在滑动加载分页数据时遇到的问题！"></a>在滑动加载分页数据时遇到的问题！</h2><blockquote><p>&emsp;&emsp;默认情况下，向上滑动加载分页的承载体默认会找到body元素。但是由于我们的页面书写方式变化多样，会导致承载体发生改变，会出现滑动时滚动载体触发无效果！</p></blockquote><p>解决方式如下:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/%E5%9B%BE%E7%89%871.png" alt></p><blockquote><p>以div class=”main_content”为载体，创建一个id=”main_content”,名字可以随便取<span style="color:red;">(创建id的原因是不影响其它地方使用)</span></p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/%E5%9B%BE%E7%89%872.png" alt></p><blockquote><p>增加getid=”main_content”，getid名字任意，是为了要向组件传递main_content这个信息，要以这个为载体。</p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/%E5%9B%BE%E7%89%873.png" alt></p><blockquote><p>在pullupreload.js这个文件内接收创建的getid信息。这里的require参数的意思是不是必须的</p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/%E5%9B%BE%E7%89%874.png" alt></p><blockquote><p>加了个if判断，如果body不存在，使用默认的方法，否则使用我们自定义的元素为载体</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="https://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Vue" scheme="https://chiwai.tang99.club/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Js+Jquery简单功能汇总</title>
    <link href="https://chiwai.tang99.club/posts/1554494174.html"/>
    <id>https://chiwai.tang99.club/posts/1554494174.html</id>
    <published>2020-01-29T06:43:11.000Z</published>
    <updated>2020-01-29T07:30:26.975Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jq实现动态删除元素后，重新排列序号"><a href="#Jq实现动态删除元素后，重新排列序号" class="headerlink" title="Jq实现动态删除元素后，重新排列序号"></a>Jq实现动态删除元素后，重新排列序号</h1><pre class="line-numbers language-javascript"><code class="language-javascript">option_select_id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">".model-select-group-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">" .model-select-group"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">rank1</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> that<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>option_val_id<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                newoption_val_id <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">".model-radio-group-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">".model-radio-group"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.options'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"选项"</span><span class="token operator">+</span>newoption_val_id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这里的that 代表动态添加或者删除时传进来的$(this)</p></blockquote><h1 id="Jq实现城市三级联动"><a href="#Jq实现城市三级联动" class="headerlink" title="Jq实现城市三级联动"></a>Jq实现城市三级联动</h1><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//省</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=country]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getProvince')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择省/直辖市--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=province]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择市--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">!=</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//市</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=province]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getRetion')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'province'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择市--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value='</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">'>市辖区&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//县</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span><span class="token string">'select[name=city]'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getRetion')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'city'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="https://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Javascript" scheme="https://chiwai.tang99.club/tags/Javascript/"/>
    
      <category term="Jquery" scheme="https://chiwai.tang99.club/tags/Jquery/"/>
    
  </entry>
  
  <entry>
    <title>PHP简单功能汇总</title>
    <link href="https://chiwai.tang99.club/posts/346954664.html"/>
    <id>https://chiwai.tang99.club/posts/346954664.html</id>
    <published>2020-01-26T04:47:05.000Z</published>
    <updated>2020-03-19T13:16:43.582Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>简单做个记录，初学者，也算是记录成长的过程！</p></blockquote><h1 id="TP5-图片上传"><a href="#TP5-图片上传" class="headerlink" title="TP5 图片上传"></a>TP5 图片上传</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">files</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token string">'请上传头像'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'/mobile/header'</span><span class="token punctuation">;</span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$imgpath</span> <span class="token operator">=</span> <span class="token variable">$path</span> <span class="token punctuation">.</span><span class="token string">'/'</span> <span class="token punctuation">.</span><span class="token variable">$url</span><span class="token punctuation">;</span>            <span class="token variable">$re</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string">'image'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$imgpath</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$title</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$imgpath</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'上传成功'</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$imgpath</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$imgpath</span><span class="token punctuation">;</span>                <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$imgpath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'系统繁忙'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$err</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token variable">$err</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="layui-TP5多文件上传"><a href="#layui-TP5多文件上传" class="headerlink" title="layui + TP5多文件上传"></a>layui + TP5多文件上传</h1><h2 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h2><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bg-header-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header-main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>innerList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inner<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>baojian<span class="token punctuation">"</span></span> <span class="token attr-name">cellpadding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table30<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jvform<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{:url(<span class="token punctuation">'</span>updo<span class="token punctuation">'</span>)}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slmark<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slmark<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!--一上传附件--></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>equ_id[]<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chuan<span class="token punctuation">"</span></span> <span class="token attr-name">rowspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">rowspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>opp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zz<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn layui-btn-normal testList<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>选择多文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-upload-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-table<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>文件名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>大小<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>状态<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demoList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn testListAction<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>开始上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span>right<span class="token punctuation">;</span><span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span><span class="token hexcode">#FF3030</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn clo<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./static/layui/layui.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery            <span class="token punctuation">,</span>upload <span class="token operator">=</span> layui<span class="token punctuation">.</span>upload<span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".testList"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> demoListView <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.layui-upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demoList'</span><span class="token punctuation">)</span>                <span class="token punctuation">,</span>uploadListIns <span class="token operator">=</span> upload<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                elem<span class="token punctuation">:</span> <span class="token keyword">this</span>                <span class="token punctuation">,</span>url<span class="token punctuation">:</span> <span class="token string">"index.php/index/index/affix"</span>                <span class="token punctuation">,</span>accept<span class="token punctuation">:</span> <span class="token string">'file'</span>                <span class="token punctuation">,</span>multiple<span class="token punctuation">:</span> <span class="token boolean">true</span>                <span class="token punctuation">,</span>auto<span class="token punctuation">:</span> <span class="token boolean">false</span>                <span class="token punctuation">,</span>bindAction<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.layui-upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.testListAction'</span><span class="token punctuation">)</span>                <span class="token punctuation">,</span>choose<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> files <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">pushFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将每次选择的文件追加到文件队列</span>                    <span class="token comment" spellcheck="true">//读取本地文件</span>                    obj<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> file<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">var</span> tr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'&lt;tr id="upload-'</span><span class="token operator">+</span> index <span class="token operator">+</span><span class="token string">'">'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span><span class="token operator">+</span> file<span class="token punctuation">.</span>name <span class="token operator">+</span><span class="token string">'&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span><span class="token operator">+</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>size<span class="token operator">/</span><span class="token number">1014</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'kb&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>等待上传&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;button class="layui-btn layui-btn-xs demo-reload layui-hide">重传&lt;/button>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除&lt;/button>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;/tr>'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//单个重传</span>                        tr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            obj<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//删除</span>                        tr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-delete'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">delete</span> files<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除对应的文件</span>                            tr<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            uploadListIns<span class="token punctuation">.</span>config<span class="token punctuation">.</span>elem<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//清空 input file 值，以免删除后出现同名文件不可选</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        demoListView<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">,</span>done<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//上传成功</span>                        <span class="token keyword">var</span> htm <span class="token operator">=</span><span class="token string">'&lt;input name="affix[title][]" type="hidden" value="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">'" />'</span><span class="token punctuation">;</span>                        htm <span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;input name="affix[url][]" type="hidden" value="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'" />'</span><span class="token punctuation">;</span>                        html <span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;a href="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'" target="_blank">'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">' &lt;/a>&lt;br/>'</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".chuan"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jvform"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>htm<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> tr <span class="token operator">=</span> demoListView<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'tr#upload-'</span><span class="token operator">+</span> index<span class="token punctuation">)</span>                            <span class="token punctuation">,</span>tds <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;span style="color: #5FB878;">上传成功&lt;/span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//清空操作</span>                        <span class="token keyword">return</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除文件队列已经上传成功的文件</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">,</span>error<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> tr <span class="token operator">=</span> demoListView<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'tr#upload-'</span><span class="token operator">+</span> index<span class="token punctuation">)</span>                        <span class="token punctuation">,</span>tds <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;span style="color: #FF5722;">上传失败&lt;/span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'layui-hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//显示重传</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP部分"><a href="#PHP部分" class="headerlink" title="PHP部分"></a>PHP部分</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">affix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"请上传图片"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$title</span><span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$path</span><span class="token operator">=</span> <span class="token string">'/mobile/upload/'</span><span class="token punctuation">;</span>            <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$dat</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$title</span><span class="token punctuation">;</span>                <span class="token variable">$dat</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$path</span><span class="token punctuation">.</span><span class="token variable">$url</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$dat</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$da</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$da</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>提交入库</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'affix'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'equ_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'equ_id'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filepath'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'affix'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'createtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$jj</span> <span class="token operator">=</span> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tj_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$jj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"提交成功"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"异常稍后再试"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$nn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="layui-TP5-分页"><a href="#layui-TP5-分页" class="headerlink" title="layui + TP5 分页"></a>layui + TP5 分页</h1><h2 id="前端部分-1"><a href="#前端部分-1" class="headerlink" title="前端部分"></a>前端部分</h2><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list lch hideone<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#cccccc</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>two<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>2019-06-29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>产后随访表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>__SUIFANG__/images/shouye/tb_12.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>details2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    {notempty name="$v.chanhou"}        {volist name="$v.chanhou" id="chanhou_v"}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#cccccc</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>two<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{$chanhou_v.time | date="Y-m-d"}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>产后随访表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhou_v.btn_kkid}<span class="token punctuation">"</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9<span class="token punctuation">"</span></span> <span class="token attr-name">del-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhou_v.id}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;img src="__SUIFANG__/images/shouye/tb_12.png" alt=""style="margin-right: 30px;"   class="details2">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>__SUIFANG__/images/shouye/dlete_03.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deletech<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        {/volist}    {/notempty}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--分页--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hideonech<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">data-page</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhoucount}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token comment" spellcheck="true">//分页</span>    layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'laypage'</span><span class="token punctuation">,</span> <span class="token string">'layer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> laypage <span class="token operator">=</span> layui<span class="token punctuation">.</span>laypage<span class="token punctuation">,</span>            layer <span class="token operator">=</span> layui<span class="token punctuation">.</span>layer<span class="token punctuation">;</span>        laypage<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            elem<span class="token punctuation">:</span> <span class="token string">'demo0'</span><span class="token punctuation">,</span>            limit<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>            count<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#demo0'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//数据总数,</span>            jump<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>first<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//首次不执行</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>first<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> parent_id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.parent_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:url('/index/pages')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token punctuation">:</span>res<span class="token punctuation">.</span>curr<span class="token punctuation">,</span>limit<span class="token punctuation">:</span>res<span class="token punctuation">.</span>limit<span class="token punctuation">,</span>parent_id<span class="token punctuation">:</span>parent_id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'li:first'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token string">"&lt;li style=\"border-top: 1px solid #cccccc;\">"</span> <span class="token operator">+</span> li <span class="token operator">+</span> <span class="token string">"&lt;/li>"</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>                        $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token keyword">var</span> html <span class="token operator">=</span>  <span class="token string">'&lt;li style="border-top: 1px solid #cccccc;">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;div class="two">&lt;i class="circle">&lt;/i>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;p>'</span><span class="token operator">+</span> v<span class="token punctuation">.</span>time <span class="token operator">+</span><span class="token string">'&lt;/p>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;p>产后随访表&lt;/p>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;div data-id="'</span><span class="token operator">+</span>v<span class="token punctuation">.</span>btn_kkid<span class="token operator">+</span><span class="token string">'" data-type="9" del-id="'</span><span class="token operator">+</span> v<span class="token punctuation">.</span>id <span class="token operator">+</span><span class="token string">'">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;img src="__SUIFANG__/images/shouye/tb_12.png" alt=""style="margin-right: 30px;"   class="details2">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;img src="__SUIFANG__/images/shouye/dlete_03.png" alt="" class="deletech">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/li>'</span><span class="token punctuation">;</span>                            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP部分-1"><a href="#PHP部分-1" class="headerlink" title="PHP部分"></a>PHP部分</h2><pre class="line-numbers language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$Chanhou_module</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chanhou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$chanhou</span> <span class="token operator">=</span> <span class="token variable">$Chanhou_module</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$chanhou</span> <span class="token operator">=</span> <span class="token variable">$chanhou</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'data'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$chanhou</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP5-1中间件定义使用"><a href="#TP5-1中间件定义使用" class="headerlink" title="TP5.1中间件定义使用"></a>TP5.1中间件定义使用</h1><blockquote><p>有时间可以看看手册，还是很完整的。</p></blockquote><h2 id="在配置文件中定义"><a href="#在配置文件中定义" class="headerlink" title="在配置文件中定义"></a>在配置文件中定义</h2><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20200127201742.png" alt><br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20200127202015.png" alt></p><h2 id="在对应的中间件中写功能"><a href="#在对应的中间件中写功能" class="headerlink" title="在对应的中间件中写功能"></a>在对应的中间件中写功能</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>middleware</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">CheckIndexAuth</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> \<span class="token package">Closure</span> <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user_index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取当前登录信息</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span> <span class="token operator">||</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user_index_sign'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//验证是否登录</span><span class="token comment" spellcheck="true">//            alert_error('登录后查看', url('/login'));</span>            <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="配合路由使用"><a href="#配合路由使用" class="headerlink" title="配合路由使用"></a>配合路由使用</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 后台管理路由 * 免权限验证路由 */</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'login$'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/Login/login'</span><span class="token punctuation">,</span>                                         <span class="token comment" spellcheck="true">//登录</span>    <span class="token string">'editPassword'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/User/editPassword'</span><span class="token punctuation">,</span>                             <span class="token comment" spellcheck="true">//重置密码</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 需要权限验证路由 */</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'index$'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/Index/index'</span><span class="token punctuation">,</span>                                           <span class="token comment" spellcheck="true">//首页</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token string">'CheckAuth'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//使用中间件验证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP5多数据库配置及使用-sqlsrv"><a href="#TP5多数据库配置及使用-sqlsrv" class="headerlink" title="TP5多数据库配置及使用(sqlsrv)"></a>TP5多数据库配置及使用(sqlsrv)</h1><h2 id="在config-php文件中配置"><a href="#在config-php文件中配置" class="headerlink" title="在config.php文件中配置"></a>在config.php文件中配置</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token punctuation">[</span>    db1' <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>            <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'sqlsrv'</span><span class="token punctuation">,</span>            <span class="token string">'hostname'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'60.60.60.60,8090'</span><span class="token punctuation">,</span>            <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'数据库名'</span><span class="token punctuation">,</span>            <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'密码'</span><span class="token punctuation">,</span>            <span class="token string">'hostport'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'1433'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'db2'</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>            <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'sqlsrv'</span><span class="token punctuation">,</span>            <span class="token string">'hostname'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'61.61.61.60,8090'</span><span class="token punctuation">,</span>            <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'数据库名'</span><span class="token punctuation">,</span>            <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'密码'</span><span class="token punctuation">,</span>            <span class="token string">'hostport'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'1433'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><pre class="line-numbers language-php"><code class="language-php"> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tbs_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tbs_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="从身份证号-残疾证号获取-年龄-生日"><a href="#从身份证号-残疾证号获取-年龄-生日" class="headerlink" title="从身份证号/残疾证号获取(年龄/生日)"></a>从身份证号/残疾证号获取(年龄/生日)</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 从身份证号/残疾证号获取(年龄/生日) * @param $Idcard 身份证号 * @param bool $b true为生日 false为年龄 * @return bool|int|string */</span><span class="token keyword">function</span> <span class="token function">getAgeFromIdcard</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$birthday</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$birthday</span><span class="token punctuation">;</span>    <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$birthday</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$age</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="从身份证号获取性别"><a href="#从身份证号获取性别" class="headerlink" title="从身份证号获取性别"></a>从身份证号获取性别</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 从身份证号获取性别 * @param $Idcard 身份证号 * @return bool|int 1男 2女 */</span><span class="token keyword">function</span> <span class="token function">getSexFromIdcard</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">18</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="返回一个随机字符串"><a href="#返回一个随机字符串" class="headerlink" title="返回一个随机字符串"></a>返回一个随机字符串</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 返回一个随机字符串 * @param $type 支持 number 数字 string 字符串 mix 混合 默认混合 * @param $size 设置字段长度 默认32 * @return string */</span><span class="token keyword">function</span> <span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token string">'mix'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'number'</span><span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'string'</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'mix'</span><span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">default</span> <span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token variable">$size</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$num</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="获取处理后的时间"><a href="#获取处理后的时间" class="headerlink" title="获取处理后的时间"></a>获取处理后的时间</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">time2string</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$day</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整天之后剩余的时间</span>    <span class="token variable">$hour</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token number">3600</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整小时之后剩余的时间</span>    <span class="token variable">$minute</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token number">60</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整分钟之后剩余的时间</span>    <span class="token comment" spellcheck="true">//返回字符串</span>    <span class="token keyword">return</span> <span class="token variable">$day</span><span class="token punctuation">.</span><span class="token string">'天'</span><span class="token punctuation">.</span><span class="token variable">$hour</span><span class="token punctuation">.</span><span class="token string">'小时'</span><span class="token punctuation">.</span><span class="token variable">$minute</span><span class="token punctuation">.</span><span class="token string">'分'</span><span class="token punctuation">.</span><span class="token variable">$second</span><span class="token punctuation">.</span><span class="token string">'秒'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="手动计算分页"><a href="#手动计算分页" class="headerlink" title="手动计算分页"></a>手动计算分页</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$aa</span> <span class="token operator">=</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$aa</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$ly</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token variable">$aa</span><span class="token punctuation">;</span>        <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jsr_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token variable">$ly</span><span class="token punctuation">,</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$list</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jsr_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'per_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$aa</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'current_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'查询成功'</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP实现二维数组去重"><a href="#PHP实现二维数组去重" class="headerlink" title="PHP实现二维数组去重"></a>PHP实现二维数组去重</h1><h2 id="一维数组去重，PHP内置了去重函数。"><a href="#一维数组去重，PHP内置了去重函数。" class="headerlink" title="一维数组去重，PHP内置了去重函数。"></a>一维数组去重，PHP内置了去重函数。</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二维数组去重"><a href="#二维数组去重" class="headerlink" title="二维数组去重"></a>二维数组去重</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token number">0</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$sp_list_value</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'sp_id'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$sp_list_value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$sp_list_value</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP上传视频"><a href="#PHP上传视频" class="headerlink" title="PHP上传视频"></a>PHP上传视频</h1><blockquote><p>上传视频可以使用之前的上传多图片的方法，还可以同时上传多个视频</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** *视频上传 * @param $files * @param string $path * @param array $imagesExt * @return string */</span><span class="token keyword">function</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">,</span> <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">"./upload/video"</span><span class="token punctuation">,</span><span class="token variable">$imagesExt</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mp4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 判断错误号</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">00</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断文件类型</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token variable">$imagesExt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//非法文件类型</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 判断是否存在上传到的目录</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 生成唯一的文件名</span>        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token function">microtime</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$ext</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将文件名拼接到指定的目录下</span>        <span class="token variable">$destName</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token variable">$fileName</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 进行文件移动</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$destName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1001</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件上传失败</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$destName</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//上传成功，返回上传路径</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 根据错误号返回提示信息</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2001</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2002</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件只有部分被上传</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2003</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//没有文件被上传</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">6</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2004</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//找不到临时文件夹</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">7</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2005</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件写入错误</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">video_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$video</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token variable">$video</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP时间字段查询方法"><a href="#PHP时间字段查询方法" class="headerlink" title="PHP时间字段查询方法"></a>PHP时间字段查询方法</h1><blockquote><p>一般用做查询 开始时间和结束时间</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 时间字段查询方法 * @param $stime 开始时间 * @param $etime 结束时间 * @return array 获得可放入where中的数组 */</span><span class="token keyword">function</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">,</span> <span class="token variable">$etime</span><span class="token punctuation">,</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$stime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'egt'</span><span class="token punctuation">,</span> <span class="token variable">$stime</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$etime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'elt'</span><span class="token punctuation">,</span> <span class="token variable">$etime</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$stime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$etime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'between'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$stime</span><span class="token punctuation">,</span> <span class="token variable">$etime</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP-递归树方法"><a href="#PHP-递归树方法" class="headerlink" title="PHP 递归树方法"></a>PHP 递归树方法</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 递归树 * @param $data * @param $pId * @return array */</span><span class="token keyword">function</span> <span class="token function">getTree</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$pId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$tree</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$pId</span> <span class="token punctuation">.</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//父亲找到儿子</span>            <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'children'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getTree</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'children'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'children'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$tree</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$tree</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP-实现历史变更记录功能"><a href="#PHP-实现历史变更记录功能" class="headerlink" title="PHP 实现历史变更记录功能"></a>PHP 实现历史变更记录功能</h1><p>效果图:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/1583240204(1).jpg" alt></p><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/1583241792(1).jpg" alt></p><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//历史记录,查询要更新的数据</span>    <span class="token variable">$coo</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_business_registration'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'cname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'tuserid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token string">'create_by'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'euserid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'addtime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$coo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'companyid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.company_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//存储到变更记录表</span>    <span class="token variable">$tnid</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_business_history'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertGetId</span><span class="token punctuation">(</span><span class="token variable">$hh</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//key字段  name字段名称  type（是否关联其他表 1:是  2：否） function关联表示调用该方法获取值</span>        <span class="token variable">$jian</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'ctype'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'单位类型'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getOfficeType'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'reg_authority'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'登记机关'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'legal_person'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'法人代表'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'phone'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'联系电话'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'reg_capital'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'注册资本'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'currency'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'注册资本'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getMoneyType'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'credit'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'统一社会信用代码'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'red_address'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'注册地址'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'place'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'营业场所'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'scale'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营规模'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getModel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'range'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营范围'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'num'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'企业人数'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'state'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营状态'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getJyState'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'style'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营方式'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'stime'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营期限开始'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'etime'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营期限结束'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'note'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'备注'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//$coo = 原始数据    $param = 要更新的数据  $tnid = 变更记录表id  qy_business_history = 表名(把表 insertChangeInfo 存到历史信息详情表里)</span>        <span class="token function">insertChangeInfo</span><span class="token punctuation">(</span><span class="token variable">$jian</span><span class="token punctuation">,</span><span class="token variable">$coo</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">,</span><span class="token variable">$tnid</span><span class="token punctuation">,</span><span class="token string">'qy_business_history'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//更新表数据</span>        <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_business_registration'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>insertChangeInfo 方法</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 添加记录 */</span><span class="token keyword">function</span> <span class="token function">insertChangeInfo</span><span class="token punctuation">(</span><span class="token variable">$jian</span><span class="token punctuation">,</span><span class="token variable">$coo</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">,</span><span class="token variable">$tnid</span><span class="token punctuation">,</span><span class="token variable">$tabelname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$jian</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//历史信息表明</span>            <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'table_name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$tabelname</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//历史信息表id</span>            <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'tnid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$tnid</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//变更的模块</span>            <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con1'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con2'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//变更前</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con1'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//变更后</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con2'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_change_info'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$iin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>function方法里面getOfficeType</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 获取单位类型 */</span><span class="token keyword">function</span> <span class="token function">getOfficeType</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'法人单位'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'非法人单位'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$name</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="生成UUID"><a href="#生成UUID" class="headerlink" title="生成UUID"></a>生成UUID</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token variable">$namespace</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token variable">$guid</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$uid</span> <span class="token operator">=</span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$namespace</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'LOCAL_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'LOCAL_PORT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_PORT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$hash</span> <span class="token operator">=</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token string">'ripemd128'</span><span class="token punctuation">,</span> <span class="token variable">$uid</span> <span class="token punctuation">.</span> <span class="token variable">$guid</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$guid</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$guid</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP计算两个日期相隔多少年-多少月-多少日的函数"><a href="#PHP计算两个日期相隔多少年-多少月-多少日的函数" class="headerlink" title="PHP计算两个日期相隔多少年,多少月,多少日的函数"></a>PHP计算两个日期相隔多少年,多少月,多少日的函数</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">diffDate</span><span class="token punctuation">(</span><span class="token variable">$date1</span><span class="token punctuation">,</span><span class="token variable">$date2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$date1</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$date2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$tmp</span><span class="token operator">=</span><span class="token variable">$date2</span><span class="token punctuation">;</span>        <span class="token variable">$date2</span><span class="token operator">=</span><span class="token variable">$date1</span><span class="token punctuation">;</span>        <span class="token variable">$date1</span><span class="token operator">=</span><span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$Y1</span><span class="token punctuation">,</span><span class="token variable">$m1</span><span class="token punctuation">,</span><span class="token variable">$d1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token variable">$date1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$Y2</span><span class="token punctuation">,</span><span class="token variable">$m2</span><span class="token punctuation">,</span><span class="token variable">$d2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token variable">$date2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$Y</span><span class="token operator">=</span><span class="token variable">$Y2</span><span class="token operator">-</span><span class="token variable">$Y1</span><span class="token punctuation">;</span>    <span class="token variable">$m</span><span class="token operator">=</span><span class="token variable">$m2</span><span class="token operator">-</span><span class="token variable">$m1</span><span class="token punctuation">;</span>    <span class="token variable">$d</span><span class="token operator">=</span><span class="token variable">$d2</span><span class="token operator">-</span><span class="token variable">$d1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$d</span><span class="token operator">+</span><span class="token operator">=</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"-1 month $date2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$m</span><span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$m</span><span class="token operator">+</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>        <span class="token variable">$y</span><span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'year'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$Y</span><span class="token punctuation">,</span><span class="token string">'month'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token string">'day'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用方法:</p><blockquote><p>diffDate(date(‘Y-m-d’,$start_time),date(‘Y-m-d’,$end_time));</p></blockquote><h1 id="PHP项目功能案例-根据日、月、季度，获取相关的数据信息"><a href="#PHP项目功能案例-根据日、月、季度，获取相关的数据信息" class="headerlink" title="PHP项目功能案例(根据日、月、季度，获取相关的数据信息)"></a>PHP项目功能案例(根据日、月、季度，获取相关的数据信息)</h1><p>根据日、月、季度，获取相关的数据信息。<br>如果选择的是日,展示从开始日到结束日的每天的数据。<br>如果是月，且开始和结束月是两个月，汇总这两个月的数据，展示两条。<br>如果是季度，按照选择开始和结束月份自动计算季度。几个季度汇总几个季度的数据。</p><blockquote><p>写这个案例的原因是，当时对这块改动超级大，印象极为深厚。</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">6</span> <span class="token operator">||</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'ssz'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'zhen_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$start_time</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$end_time</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'end_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//开始时间大于结束时间，开始时间变更今天日期</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$start_time</span> <span class="token operator">></span> <span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$start_time</span><span class="token operator">=</span><span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'日'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$st</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ed</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$st</span> <span class="token operator">!=</span> <span class="token variable">$ed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token variable">$ed</span><span class="token operator">-</span><span class="token variable">$st</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'月'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$st</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ed</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$st</span> <span class="token operator">==</span> <span class="token variable">$ed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$as</span> <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token variable">$ed</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token variable">$st</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'季度'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$st</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ed</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$st</span> <span class="token operator">&lt;</span> <span class="token variable">$ed</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$st</span> <span class="token operator">!=</span> <span class="token variable">$ed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$bs</span> <span class="token operator">=</span> <span class="token variable">$ed</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token variable">$st</span><span class="token punctuation">;</span>                    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$bs</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token variable">$as</span> <span class="token operator">++</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'日'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$as</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$start_time</span> <span class="token operator">=</span> <span class="token variable">$start_time</span> <span class="token operator">+</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">;</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'月'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$as</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$as</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//先获取第二月的开始时间</span>                    <span class="token variable">$ii</span> <span class="token operator">=</span> <span class="token variable">$i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-1 00:00:00'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"+"</span> <span class="token punctuation">.</span> <span class="token variable">$ii</span> <span class="token punctuation">.</span> <span class="token string">" month"</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$eed</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"$start_time1 +1 month -1 second"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$eed</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d 23:59:59'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token variable">$eed</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time1</span><span class="token punctuation">,</span><span class="token variable">$end_time1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$start_time1</span><span class="token punctuation">.</span><span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token variable">$end_time1</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'季度'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$as</span> <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$season</span> <span class="token operator">=</span> <span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$kaishi</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$season</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$jieshu</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token variable">$season</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$season</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"Y"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$kaishi</span><span class="token punctuation">,</span><span class="token variable">$jieshu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$kaishi</span> <span class="token punctuation">.</span> <span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token variable">$jieshu</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$as</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$ii</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-1 00:00:00'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"+"</span> <span class="token punctuation">.</span> <span class="token variable">$ii</span> <span class="token punctuation">.</span> <span class="token string">" month"</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$eed</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"$start_time1 +3 month -1 second"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$eed</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d 23:59:59'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token variable">$eed</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time1</span><span class="token punctuation">,</span><span class="token variable">$end_time1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$start_time1</span><span class="token punctuation">.</span><span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token variable">$end_time1</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//立案数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//派遣数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//处置数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">75</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//核查数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//结案数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'mm'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="/download/Reseau.php" ">点击下载</a></p><h1 id="setReturn-返回函数封装"><a href="#setReturn-返回函数封装" class="headerlink" title="setReturn 返回函数封装"></a>setReturn 返回函数封装</h1><p>方便使用，直接复制粘贴</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">,</span><span class="token variable">$message</span><span class="token operator">=</span><span class="token string">"查询成功"</span><span class="token punctuation">,</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$message</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$return</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="汇总" scheme="https://chiwai.tang99.club/tags/%E6%B1%87%E6%80%BB/"/>
    
  </entry>
  
  <entry>
    <title>php将导出文件生成压缩包并下载</title>
    <link href="https://chiwai.tang99.club/posts/3149816056.html"/>
    <id>https://chiwai.tang99.club/posts/3149816056.html</id>
    <published>2019-12-09T13:14:31.000Z</published>
    <updated>2020-03-14T13:31:10.714Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>#php实现将导出文件生成压缩包并下载</p><blockquote><p>这里我用到了模板，首先获取其数据，加载模板，生成excel文件，获取其路径，将生成的excel文件生成压缩包。</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//血糖数据</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ExportXuetang</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//患者id</span>        <span class="token variable">$parent_id</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$table_xuetang</span> <span class="token operator">=</span> FixedTableTable<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$parent_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'btn_kkid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'json_info'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table_xuetang</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'json_info'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//数据量过大，这里我只取简单的几条数据，做记录</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'L_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'L_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'K_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'K_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'ZH_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'ZH_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WUQ_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WUQ_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WUH_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WUH_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WAQ_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WAQ_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//引入PHPExcel导出类</span>        <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>PHPExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$temPath</span> <span class="token operator">=</span> <span class="token string">"./template/xuetang.xlsx"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//模板路径</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'模板不存在!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//加载模板</span>        <span class="token variable">$excel</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReaderForFile</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$phpexcel</span> <span class="token operator">=</span> <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$fixed_arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//横向循环，我这里的数据是横向排列，动态横向输出</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$fixed_arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//当excel列超过26列大于Z时，将列的数字序号转成字母使用</span>            <span class="token variable">$pCoordinate</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_Cell</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">stringFromColumnIndex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'8'</span><span class="token punctuation">;</span>            <span class="token variable">$pValue</span>      <span class="token operator">=</span> <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$phpexcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$pCoordinate</span><span class="token punctuation">,</span> <span class="token variable">$pValue</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//清除缓冲区，避免乱码</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string">"xuetang.xlsx"</span><span class="token punctuation">;</span>        <span class="token variable">$file_path</span> <span class="token operator">=</span> <span class="token string">"./upload/template/"</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createWriter</span><span class="token punctuation">(</span><span class="token variable">$phpexcel</span><span class="token punctuation">,</span> <span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//将写好的模板保存到指定目录</span>        <span class="token comment" spellcheck="true">//生成excel路径</span>        <span class="token variable">$exct</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string">'title'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'血糖数据.xlsx'</span><span class="token punctuation">,</span>            <span class="token string">'url'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$file_path</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将路径返回</span>        <span class="token keyword">return</span> <span class="token variable">$exct</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>上面的方法是我要导出一部分的数据，实际上有很多不同的数据要合并，有多个方法，这里只取其中一个方法</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//下载excel并压缩包打包</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$zip_xuetang</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ExportXuetang</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将生成的excel生成压缩包</span>        <span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>ZipArchive</span><span class="token punctuation">;</span>        <span class="token variable">$zip_name</span> <span class="token operator">=</span> <span class="token string">'./upload/zip/'</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.zip'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//压缩包名称</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">,</span>\<span class="token package">ZipArchive</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//循环生成excel的路径</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$zip_arr</span> <span class="token keyword">as</span> <span class="token variable">$k1</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$tpfile</span><span class="token operator">=</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                 <span class="token variable">$new_filename</span> <span class="token operator">=</span> <span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFile</span><span class="token punctuation">(</span><span class="token variable">$tpfile</span><span class="token punctuation">,</span><span class="token variable">$new_filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">/*$zip->close();        $kkp='/static/upload/zip/'.time().'.zip';;        $file = $_SERVER['HTTP_HOST'].$kkp;                header('Location:http://'.$file);*/</span>        <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$kkp</span><span class="token operator">=</span><span class="token string">'./upload/zip/'</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.zip'</span><span class="token punctuation">;</span>        <span class="token function">ob_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-type: application/vnd.ms-word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition:attachment;filename="</span><span class="token punctuation">.</span><span class="token variable">$kkp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Cache-Control: max-age=0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="Excel" scheme="https://chiwai.tang99.club/tags/Excel/"/>
    
      <category term="压缩包" scheme="https://chiwai.tang99.club/tags/%E5%8E%8B%E7%BC%A9%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Win10 Nginx+PHP+MySQL 开机自启</title>
    <link href="https://chiwai.tang99.club/posts/2324507981.html"/>
    <id>https://chiwai.tang99.club/posts/2324507981.html</id>
    <published>2019-12-08T14:57:08.000Z</published>
    <updated>2020-03-14T13:32:44.714Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Win10-Nginx-PHP-MySQL-开机自启"><a href="#Win10-Nginx-PHP-MySQL-开机自启" class="headerlink" title="Win10 Nginx+PHP+MySQL 开机自启"></a>Win10 Nginx+PHP+MySQL 开机自启</h3><h5 id="1-MySQL"><a href="#1-MySQL" class="headerlink" title="1.MySQL"></a>1.MySQL</h5><pre><code>如: 用管理员运行cmd到MySql目录 C:\WNPM\MySQL\bin     执行 mysqld install 生成windows服务  </code></pre><h5 id="2-Nginx"><a href="#2-Nginx" class="headerlink" title="2.Nginx"></a>2.Nginx</h5><pre><code>将 winsw-1.18-bin.exe 复制到Nginx根目录 重命名为 nginx-service.exe并创建nginx-service.exe.config、nginx-service.xml两个文件内容如下：nginx-service.exe.config    &lt;configuration&gt;        &lt;startup&gt;            &lt;supportedRuntime version=&quot;v2.0.50727&quot; /&gt;            &lt;supportedRuntime version=&quot;v4.0&quot; /&gt;        &lt;/startup&gt;        &lt;runtime&gt;            &lt;generatePublisherEvidence enabled=&quot;false&quot;/&gt;        &lt;/runtime&gt;    &lt;/configuration&gt;    nginx-service.xml    &lt;service&gt;        &lt;id&gt;nginx&lt;/id&gt;        &lt;name&gt;Nginx Service&lt;/name&gt;        &lt;description&gt;High Performance Nginx Service&lt;/description&gt;        &lt;logpath&gt;C:\WNPM\nginx\logs&lt;/logpath&gt;        &lt;log mode=&quot;roll-by-size&quot;&gt;            &lt;sizeThreshold&gt;10240&lt;/sizeThreshold&gt;            &lt;keepFiles&gt;8&lt;/keepFiles&gt;        &lt;/log&gt;        &lt;executable&gt;C:\WNPM\nginx\nginx.exe&lt;/executable&gt;        &lt;startarguments&gt;C:\WNPM\nginx\nginx&lt;/startarguments&gt;        &lt;stopexecutable&gt;C:\WNPM\nginx\nginx.exe&lt;/stopexecutable&gt;        &lt;stoparguments&gt;-p C:\WNPM\nginx -s stop&lt;/stoparguments&gt;    &lt;/service&gt;执行 nginx-service.exe install 生成windows服务     </code></pre><h5 id="3-PHP"><a href="#3-PHP" class="headerlink" title="3.PHP"></a>3.PHP</h5><pre><code>将 WinSW.NET4.exe、xxfpm.exe、pthreadGC2.dll复制到PHP根目录 WinSW.NET4.exe 重命名为 php-cgi-servic.exe(xxfpm，用来开启 php-cgi 多进程)并创建php-cgi-service.xml文件php-cgi-service.xml&lt;service&gt;    &lt;id&gt;php-cgi&lt;/id&gt;    &lt;name&gt;php-cgi&lt;/name&gt;    &lt;description&gt;PHP-CGI.&lt;/description&gt;    &lt;executable&gt;xxfpm.exe&lt;/executable&gt;    &lt;!-- 启动参数 --&gt;    &lt;startargument&gt;&quot;C:\WNPM\php-7.2.1\php-cgi.exe -c C:\WNPM\php-            7.2.1\php.ini&quot;&lt;/startargument&gt;    &lt;startargument&gt;-n&lt;/startargument&gt;    &lt;!-- 启动进程数量，可修改，建议大于 1 --&gt;    &lt;startargument&gt;3&lt;/startargument&gt;    &lt;startargument&gt;-i&lt;/startargument&gt;    &lt;!-- 监听IP，默认一般都用 127.0.0.1 --&gt;    &lt;startargument&gt;127.0.0.1&lt;/startargument&gt;    &lt;startargument&gt;-p&lt;/startargument&gt;    &lt;!-- 监听端口，默认一般都用 9000 --&gt;    &lt;startargument&gt;9000&lt;/startargument&gt;    &lt;!-- 停止参数 --&gt;    &lt;stopexecutable&gt;taskkill&lt;/stopexecutable&gt;    &lt;stopargument&gt;/F&lt;/stopargument&gt;    &lt;stopargument&gt;/IM&lt;/stopargument&gt;    &lt;stopargument&gt;xxfpm.exe&lt;/stopargument&gt;    &lt;logpath&gt;logs&lt;/logpath&gt;&lt;/service&gt;php-cgi-service.exe install，生成windows服务</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="配置" scheme="https://chiwai.tang99.club/categories/%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="环境搭建" scheme="https://chiwai.tang99.club/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>纯手工Laravel笔记</title>
    <link href="https://chiwai.tang99.club/posts/2416442789.html"/>
    <id>https://chiwai.tang99.club/posts/2416442789.html</id>
    <published>2019-11-15T11:38:01.000Z</published>
    <updated>2020-03-24T02:44:43.169Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>完整Laravel笔记,纯个人手工打造</p></blockquote><p>附件下载<br><a href="/download/Laravel框架.docx" ">点击下载</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端笔记" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Laravel" scheme="https://chiwai.tang99.club/tags/Laravel/"/>
    
      <category term="笔记" scheme="https://chiwai.tang99.club/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>TP5定时任务</title>
    <link href="https://chiwai.tang99.club/posts/2335608172.html"/>
    <id>https://chiwai.tang99.club/posts/2335608172.html</id>
    <published>2019-11-06T12:14:43.000Z</published>
    <updated>2020-03-24T02:40:52.577Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="TP5-windows-定时任务"><a href="#TP5-windows-定时任务" class="headerlink" title="TP5+windows 定时任务"></a>TP5+windows 定时任务</h1><p>1.建立command文件夹，与controller文件夹同级，创建PHP文件，文件名称任意。<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/b5a85b2e1d339afa166b1b20e6126d6.png" alt><br>2.在Task.php文件下写入以下内容</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>command</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Command</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Input</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * 命令名称     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'Task'</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true">//设置指令名称</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">'每天统计数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置描述信息</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @param Input $input     * @param Output $output     * @return int|void|null     * 设置执行代码     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span>Input <span class="token variable">$input</span><span class="token punctuation">,</span> Output <span class="token variable">$output</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 输出到日志文件</span>        <span class="token variable">$output</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$output</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">"end..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>            <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>                        <span class="token string">'title'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'zxm22'</span><span class="token punctuation">,</span>                        <span class="token string">'content'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'上海'</span>            <span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.找到command.php<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/b0e3613ce1a65737dec7e2a348ada05.png" alt><br>command.php:</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">// +----------------------------------------------------------------------</span><span class="token comment" spellcheck="true">// | ThinkPHP [ WE CAN DO IT JUST THINK ]</span><span class="token comment" spellcheck="true">// +----------------------------------------------------------------------</span><span class="token comment" spellcheck="true">// | Copyright (c) 2006-2016 http://thinkphp.cn All rights reserved.</span><span class="token comment" spellcheck="true">// +----------------------------------------------------------------------</span><span class="token comment" spellcheck="true">// | Licensed ( http://www.apache.org/licenses/LICENSE-2.0 )</span><span class="token comment" spellcheck="true">// +----------------------------------------------------------------------</span><span class="token comment" spellcheck="true">// | Author: </span><span class="token comment" spellcheck="true">// +----------------------------------------------------------------------</span><span class="token keyword">return</span> <span class="token punctuation">[</span>    <span class="token string">'app\index\command\Task'</span><span class="token comment" spellcheck="true">//这里把上面的任务PHP文件填上</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.windows下创建.bat脚本,脚本中填入以下内容:</p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//进入E盘</span>E<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//cd命令后面是项目文件根目录</span>cd \<span class="token package">phpstudy<span class="token punctuation">\</span>PHPTutorial<span class="token punctuation">\</span>www<span class="token punctuation">\</span>lianxi</span><span class="token comment" spellcheck="true">//用php.exe 打开think Task任务</span>E<span class="token punctuation">:</span>\<span class="token package">phpstudy<span class="token punctuation">\</span>PHPTutorial<span class="token punctuation">\</span>php<span class="token punctuation">\</span>php</span><span class="token operator">-</span><span class="token number">7.0</span><span class="token punctuation">.</span><span class="token number">12</span><span class="token operator">-</span>nts\<span class="token package">php</span><span class="token punctuation">.</span>exe think Task<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5.打开计算机管理应用,创建任务<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/21bab926183eb12edb041e564106049.png" alt="创建任务"><br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/a31f18b5edaee4450301faec4f5925c.png" alt="常规"><br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/e6914d023c0f1963c3e90dc9ab15d27.png" alt="触发器"><br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/fa945ad63d70e725b4d33793afea198.png" alt="操作"></p><blockquote><p>初学者，入门级！</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="定时任务" scheme="https://chiwai.tang99.club/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>php导出excel方法</title>
    <link href="https://chiwai.tang99.club/posts/4119388635.html"/>
    <id>https://chiwai.tang99.club/posts/4119388635.html</id>
    <published>2019-10-27T15:39:10.000Z</published>
    <updated>2020-01-31T12:40:22.440Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="php实现Excel导出方法"><a href="#php实现Excel导出方法" class="headerlink" title="php实现Excel导出方法"></a>php实现Excel导出方法</h1><p>工作中用到的功能，记录一下！</p><p>实例:</p><pre class="line-numbers language-php"><code class="language-php"> <span class="token comment" spellcheck="true">/**     * 导出机构信息     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">daochu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//用户名</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//机构名称</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'organization'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'organization'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//委托单号</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//链表查询数据集</span>        <span class="token variable">$toll_list</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_order o on c.oid = o.id'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_user u on o.user = u.id'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'ce_r_mechanism r on o.xmec = r.id'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'c.*,o.number,o.user,o.xmec,u.id,u.name as name1,r.id,r.name as name2'</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span>            <span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//序号|时间</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$toll_list</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$toll_list</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'xu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$k</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token variable">$toll_list</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'addtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'addtime'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//设置字段名称</span>        <span class="token variable">$xlsCell</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'xu'</span><span class="token punctuation">,</span><span class="token string">'序号'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name1'</span><span class="token punctuation">,</span><span class="token string">'委托人'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name2'</span><span class="token punctuation">,</span><span class="token string">'机构名称'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span><span class="token string">'委托单号'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'cost1'</span><span class="token punctuation">,</span><span class="token string">'应收费用'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'cost2'</span><span class="token punctuation">,</span><span class="token string">'实收费用'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'title1'</span><span class="token punctuation">,</span><span class="token string">'详细费用单'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'title2'</span><span class="token punctuation">,</span><span class="token string">'盖章收费单'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'addtime'</span><span class="token punctuation">,</span><span class="token string">'创建时间'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'note'</span><span class="token punctuation">,</span><span class="token string">'备注'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//导入类库</span>        <span class="token function">vendor</span><span class="token punctuation">(</span><span class="token string">"PHPExcel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objPHPExcel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>PHPExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cellName</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'I'</span><span class="token punctuation">,</span><span class="token string">'J'</span><span class="token punctuation">,</span><span class="token string">'K'</span><span class="token punctuation">,</span><span class="token string">'L'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token punctuation">,</span><span class="token string">'O'</span><span class="token punctuation">,</span><span class="token string">'P'</span><span class="token punctuation">,</span><span class="token string">'Q'</span><span class="token punctuation">,</span><span class="token string">'R'</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">'U'</span><span class="token punctuation">,</span><span class="token string">'V'</span><span class="token punctuation">,</span><span class="token string">'W'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'AA'</span><span class="token punctuation">,</span><span class="token string">'AB'</span><span class="token punctuation">,</span><span class="token string">'AC'</span><span class="token punctuation">,</span><span class="token string">'AD'</span><span class="token punctuation">,</span><span class="token string">'AE'</span><span class="token punctuation">,</span><span class="token string">'AF'</span><span class="token punctuation">,</span><span class="token string">'AG'</span><span class="token punctuation">,</span><span class="token string">'AH'</span><span class="token punctuation">,</span><span class="token string">'AI'</span><span class="token punctuation">,</span><span class="token string">'AJ'</span><span class="token punctuation">,</span><span class="token string">'AK'</span><span class="token punctuation">,</span><span class="token string">'AL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//循环设置列宽</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getColumnDimension</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 清空（擦掉）输出缓冲区</span>        <span class="token function">ob_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//xls总列数</span>        <span class="token variable">$cellNum</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$xlsCell</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//chr()该函数用于将ASCII码值转化为字符串</span>        <span class="token comment" spellcheck="true">//ord()该函数用于将字符串转化为ASCII码值</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cellName1</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$cellNum</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">></span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$key2</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$cellName1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token operator">>=</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$cellName1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$cellName1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token variable">$key</span> <span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//设置单元格值&amp;合并单元格</span>        <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">"费用信息"</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置align</span>        <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getStyle</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getAlignment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setHorizontal</span><span class="token punctuation">(</span><span class="token string">'center'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">mergeCells</span><span class="token punctuation">(</span><span class="token string">'A1:'</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$cellName1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//合并</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$cellNum</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setActiveSheetIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token variable">$xlsCell</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getStyle</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getAlignment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setHorizontal</span><span class="token punctuation">(</span><span class="token string">'center'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//查询的结果集总数</span>        <span class="token variable">$dataNum</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$toll_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$dataNum</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token variable">$cellNum</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$cellName</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$toll_list</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$xlsCell</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$xlsName</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$xlsTitle</span> <span class="token operator">=</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'gb2312'</span><span class="token punctuation">,</span> <span class="token variable">$xlsName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名称</span>        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token variable">$xlsTitle</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//or $xlsTitle 文件名称可根据自己情况设定</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'pragma:public'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-type:application/vnd.ms-excel;charset=utf-8;name="'</span><span class="token punctuation">.</span><span class="token variable">$xlsTitle</span><span class="token punctuation">.</span><span class="token string">'.xls"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition:attachment;filename=$fileName.xls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//attachment新窗口打印inline本窗口打印</span>        <span class="token variable">$objWriter</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createWriter</span><span class="token punctuation">(</span><span class="token variable">$objPHPExcel</span><span class="token punctuation">,</span> <span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//output');</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>学习阶段，写的不是很好，有哪些错误还需要欢迎指出!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="https://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="https://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="Excel" scheme="https://chiwai.tang99.club/tags/Excel/"/>
    
      <category term="导出" scheme="https://chiwai.tang99.club/tags/%E5%AF%BC%E5%87%BA/"/>
    
  </entry>
  
  <entry>
    <title>js遍历数组输出进行排序方法</title>
    <link href="https://chiwai.tang99.club/posts/3524924122.html"/>
    <id>https://chiwai.tang99.club/posts/3524924122.html</id>
    <published>2019-10-11T14:17:30.000Z</published>
    <updated>2020-01-31T12:39:27.017Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="js遍历对象输出时真的是按照顺序输出的吗？"><a href="#js遍历对象输出时真的是按照顺序输出的吗？" class="headerlink" title="js遍历对象输出时真的是按照顺序输出的吗？"></a>js遍历对象输出时真的是按照顺序输出的吗？</h1><p>&nbsp;&nbsp;&nbsp;前两天在工作中遇到一个问题，js在获取后端数据遍历输出时，要根据自定义属性进行规则排序，可在排序时就发生了顺序颠倒的问题。<br>先来两个实例:</p><pre class="line-numbers language-javascript"><code class="language-javascript">    <span class="token keyword">var</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        <span class="token number">1</span><span class="token punctuation">:</span><span class="token string">'aaa'</span><span class="token punctuation">,</span>        name<span class="token punctuation">:</span><span class="token string">'abc'</span><span class="token punctuation">,</span>        <span class="token string">'3'</span><span class="token punctuation">:</span><span class="token string">'ccc'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">,</span>        school<span class="token punctuation">:</span><span class="token string">'sdfds'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>输出:[“1”, “3”, “name”, “age”, “school”]  </p></blockquote><p>换一下位置:  </p><pre class="line-numbers language-javascript"><code class="language-javascript"> <span class="token keyword">var</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span><span class="token string">'aaa'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token string">'abc'</span><span class="token punctuation">,</span>        <span class="token string">'3'</span><span class="token punctuation">:</span><span class="token string">'ccc'</span><span class="token punctuation">,</span>        <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">,</span>        school<span class="token punctuation">:</span><span class="token string">'sdfds'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>输出:[“1”, “3”, “name”, “age”, “school”]</p></blockquote><p>&nbsp;&nbsp;&nbsp;所以，对象的遍历输出并不是按照顺序来的，那么是按照什么规则来的呢，仔细深入研究你会发现，这还跟浏览器有关系，Chrome跟IE是不一样的，所以给出以下结论:  </p><p>&nbsp;&nbsp;&nbsp;Chrome Opera 的 JavaScript 解析引擎遵循的是新版 ECMA-262 第五版规范。因此，使用 for-in 语句遍历对象属性时遍历书序并非属性构建顺序。而 IE6 IE7 IE8 Firefox Safari 的 JavaScript 解析引擎遵循的是较老的 ECMA-262 第三版规范，属性遍历顺序由属性构建的顺序决定。  </p><p>&nbsp;&nbsp;&nbsp;Chrome Opera 中使用 for-in 语句遍历对象属性时会遵循一个规律：<br>&nbsp;&nbsp;&nbsp;它们会先提取所有 key 的 parseFloat 值为非负整数的属性，然后根据数字顺序对属性排序首先遍历出来，然后按照对象定义的顺序遍历余下的所有属性。  </p><p>&nbsp;&nbsp;&nbsp;那么,怎么解决呢？<br>可以把对象通过Object.keys提取对象的key出来变成数组，然后通过数组的排序，然后遍历数组，通过key去取对象的属性值。  </p><h1 id="js数组遍历排序方法"><a href="#js数组遍历排序方法" class="headerlink" title="js数组遍历排序方法"></a>js数组遍历排序方法</h1><blockquote><p>大家都知道数组的遍历是按照顺序的，那么当一个数组中放了很多对象，想要按照对象的某个属性去排序数组需要怎么处理呢？</p></blockquote><p>直接上代码:  </p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> compare <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> val1 <span class="token operator">=</span> obj1<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> val2 <span class="token operator">=</span> obj2<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>val1 <span class="token operator">&lt;</span> val2<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val1 <span class="token operator">></span> val2<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span>  <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>financial_list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token string">'sp_sort'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>其中’financial_list’表示数组信息<br>  ‘sp_sort’表示按照这个字段进行排序</p></blockquote><p>注:尊重原创，这是一篇转载内容。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="https://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Js数组排序" scheme="https://chiwai.tang99.club/tags/Js%E6%95%B0%E7%BB%84%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>hexo-admin安装使用及遇到的问题</title>
    <link href="https://chiwai.tang99.club/posts/2672848395.html"/>
    <id>https://chiwai.tang99.club/posts/2672848395.html</id>
    <published>2019-10-08T10:10:24.000Z</published>
    <updated>2020-03-14T13:30:50.855Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="hexo-admin安装使用及遇到得问题"><a href="#hexo-admin安装使用及遇到得问题" class="headerlink" title="hexo-admin安装使用及遇到得问题"></a>hexo-admin安装使用及遇到得问题</h1><h1 id="安装hexo-admin"><a href="#安装hexo-admin" class="headerlink" title="安装hexo-admin"></a>安装hexo-admin</h1><h2 id="1-安装管理-amp-启动"><a href="#1-安装管理-amp-启动" class="headerlink" title="1.安装管理&amp;启动"></a>1.安装管理&amp;启动</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save hexo-adminhexo ghexo shttp://localhost:4000/admin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>效果图:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008203407.png" alt="效果图"></p><h2 id="2-设置密码"><a href="#2-设置密码" class="headerlink" title="2.设置密码"></a>2.设置密码</h2><blockquote><p>点击Settings &gt; Setup authentification  </p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008204004.png" alt="按照顺序点击"></p><h2 id="3-填写用户名和密码"><a href="#3-填写用户名和密码" class="headerlink" title="3.填写用户名和密码"></a>3.填写用户名和密码</h2><p> <img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008204649.png" alt="填写相应功能"></p><blockquote><p>username 表示你的用户名<br>  password 你的密码<br>  将信息添加到根目录下_config.yml文件内</p></blockquote><h1 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h1><h2 id="1-错误信息-Config-value-“admin-deployCommand”-not-found"><a href="#1-错误信息-Config-value-“admin-deployCommand”-not-found" class="headerlink" title="1.错误信息:Config value “admin.deployCommand” not found"></a>1.错误信息:Config value “admin.deployCommand” not found</h2><p>当你第一次点击 Deploy 按钮时,可能会遇到上面的问题，是因为缺少了执行的deploy命令,如图:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008205553.png" alt="错误信息"><br>解决方法:<br>在项目中创建hexo-deploy.sh文件并设置权限  </p><blockquote><p>$ touch hexo-deploy.sh; chmod a+x hexo-deploy.sh</p></blockquote><p>在文件内写入一下内容</p><blockquote><p>  hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</p></blockquote><p><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008210152.png" alt="写入以上内容"></p><p>编辑配置文件<br>在根目录_config.yml配置文件中，在之前配置的admin配置信息下加入<code>deployCommand: &#39;./hexo-deploy.sh&#39;</code> 信息<br>如图所示:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008211142.png" alt="添加以上信息"></p><h2 id="2-错误信息deploy-Error-spawn-UNKNOWN"><a href="#2-错误信息deploy-Error-spawn-UNKNOWN" class="headerlink" title="2.错误信息deploy Error: spawn UNKNOWN"></a>2.错误信息deploy Error: spawn UNKNOWN</h2><p>在解决完上述错误信息后，将会报出<em>deploy Error: spawn UNKNOWN</em>错误信息<br>解决方法:  </p><blockquote><p>打开node_modules目录下hexo-admin目录下deploy.js<br>  将<code>var proc = spawn(command, [message], {detached: true});</code>改为<br>  <code>var proc = spawn((process.platform === &quot;win32&quot; ? &quot;hexo.cmd&quot; : &quot;hexo&quot;), [&#39;d&#39;]);</code></p></blockquote><p>如图所示:<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008212700.png" alt="更改以上信息"></p><p>改完之后就ok啦，上图庆祝一下<br><img src="/images/447.gif" data-original="https://raw.githubusercontent.com/zhiweiUU9/Figure_bed/master/blog_files/img/PicGo-Github-PicBed/20191008212954.png" alt="该内容为成功"></p><p>参考以下资料信息:<br><a href="https://github.com/jaredly/hexo-admin/issues/70" target="_blank" rel="noopener">错误信息:Config value “admin.deployCommand” not found</a><br><a href="https://github.com/jaredly/hexo-admin/issues/94" target="_blank" rel="noopener">错误信息:deploy Error: spawn UNKNOWN</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="hexo" scheme="https://chiwai.tang99.club/categories/hexo/"/>
    
    
      <category term="hexo-admin" scheme="https://chiwai.tang99.club/tags/hexo-admin/"/>
    
  </entry>
  
</feed>
