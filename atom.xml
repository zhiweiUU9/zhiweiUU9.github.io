<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>志伟&amp;博客</title>
  
  <subtitle>Zhi-wei blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="%5Bobject%20Object%5D" rel="hub"/>
  <link href="http://chiwai.tang99.club/"/>
  <updated>2020-05-02T15:21:14.409Z</updated>
  <id>http://chiwai.tang99.club/</id>
  
  <author>
    <name>志伟</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>keepalived出现主备机同时绑定vip的解决方法</title>
    <link href="http://chiwai.tang99.club/posts/4120007045.html"/>
    <id>http://chiwai.tang99.club/posts/4120007045.html</id>
    <published>2020-05-02T14:44:19.000Z</published>
    <updated>2020-05-02T15:21:14.409Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>配置完keepalived之后出现一点小问题，就是启动keepalived之后，发现主备机上同时绑定了虚拟IP，跟预期结果不一样。</p><p><span style="color:red;"><b>1.</b></span>检查keepalived.conf配置文件，是否配置出现问题。</p><p>主机配置(192.168.178.129)：</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_one}vrrp_script chk_nginx{    script "/etc/keepalived/nginx_check.sh"    interval 2    weight -20}vrrp_instance VI_1 {    state MASTER    interface ens33    mcast_src_ip 192.168.178.129    virtual_router_id 51    priority 100    nopreempt    advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script{    chk_nginx     }    virtual_ipaddress {        192.168.178.125    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备机配置(192.168.178.130)：</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_two}vrrp_script chk_nginx{    script "/etc/keepalived/nginx_check.sh"    interval 2    weight -20}vrrp_instance VI_1 {    state BACKUP    interface ens33    virtual_router_id 51    mcast_src_ip 192.168.178.130    priority 90    nopreempt     advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script{    chk_nginx    }    virtual_ipaddress {        192.168.178.125    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过检查对比发现没有什么问题。</p><p><span style="color:red;"><b>2.</b></span>通过tcpdump抓包检查,同时在主、备机(129、130)都监听一遍ens33网卡</p><p>输入如下命令:</p><pre class="line-numbers language-ini"><code class="language-ini">sudo tcpdump -i ens33 vrrp -n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502230223.png" alt></p><p>结果你会发现129（主机）和130（备份机）两台机器在轮询往224.0.0.18（vrrp的组播地址）发送报文。<br>理论上来说，主机处于活跃状态的时候，备份机收到报文之后是不会发送组播消息的，这个很明显就是备份机没收到主机的组播报文。</p><p><span style="color:red;"><b>3.</b></span>开启组播通信<br>注意：我的防火墙是<code>firewall</code>,如果防火墙是<code>iptables</code>可能不受用(猜测的，没试过)</p><p>运行以下命令<span style="color:red;">(主、备机都要运行)</span>:</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface ens33 --destination 224.0.0.18 --protocol vrrp -j ACCEPTfirewall-cmd --reload; # 刷新防火墙<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中<span style="color:red">INPUT 0 –in-interface ens33</span>,这段的<span style="color:red;">ens33</span>是绑定得vip的网卡，替换成你自己的网卡就可以了。</p><p>运行之后，再查看vip绑定情况，发现已经恢复正常:</p><p>(主机仍然绑定)<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502231437.png" alt="主机仍然绑定"></p><p>(备机解除绑定)<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502231609.png" alt="备机解除绑定"></p><p>再监控一下ens33网卡报文情况：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502231646.png" alt="一切正常"></p><p>参考：<br><a href="https://blog.csdn.net/liu1160848595/article/details/104653226/" target="_blank" rel="noopener">https://blog.csdn.net/liu1160848595/article/details/104653226/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="keepalived" scheme="http://chiwai.tang99.club/categories/keepalived/"/>
    
    
      <category term="keepalived" scheme="http://chiwai.tang99.club/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>Linux下安装keepalived与配置</title>
    <link href="http://chiwai.tang99.club/posts/2566092336.html"/>
    <id>http://chiwai.tang99.club/posts/2566092336.html</id>
    <published>2020-05-01T09:22:19.000Z</published>
    <updated>2020-05-02T13:07:59.860Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>nginx搭建负载均衡可查看 <a href="http://chiwai.tang99.club/posts/2236109518.html">http://chiwai.tang99.club/posts/2236109518.html</a></p></blockquote><h1 id="安装keepalived"><a href="#安装keepalived" class="headerlink" title="安装keepalived"></a>安装keepalived</h1><p><a href="https://www.keepalived.org/download.html" target="_blank" rel="noopener">https://www.keepalived.org/download.html</a></p><h2 id="下载、安装keepalived"><a href="#下载、安装keepalived" class="headerlink" title="下载、安装keepalived"></a>下载、安装keepalived</h2><p><b style="font-size:18px;">1.</b>&nbsp;&nbsp;下载到<code>/usr/local/src</code>目录。</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/local/srcwget https://www.keepalived.org/software/keepalived-2.0.20.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">2.</b>&nbsp;&nbsp;解压安装</p><pre class="line-numbers language-ini"><code class="language-ini">tar -zxvf keepalived-2.0.20.tar.gzcd keepalived-2.0.20/# 指定安装在/usr/local/keepalived 路径下./configure --prefix<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/keepalived</span># 编译+安装make &amp;&amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>./configure</code>的时候出现以下警告信息<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501202316.png" alt><br>警告如上解决如下：</p></blockquote><pre class="line-numbers language-ini"><code class="language-ini">yum -y install libnl libnl-develyum install -y libnfnetlink-devel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">3.</b>&nbsp;&nbsp;将 keepalived 安装成 Linux 系统服务</p><p>因为没有使用 keepalived 的默认路径安装（默认是/usr/local） ,安装完成之后，需要做一些工作复制默认配置文件到默认路径</p><pre class="line-numbers language-ini"><code class="language-ini">mkdir /etc/keepalived# 将配置文件放到默认路径下cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>复制 keepalived 服务脚本到默认的地址</p><pre class="line-numbers language-ini"><code class="language-ini"># keepalived启动脚本(源码目录下)，放到/etc/init.d/目录下就可以使用service命令便捷调用cp /usr/local/src/keepalived-2.0.20/keepalived/etc/init.d/keepalived /etc/init.d/# keepalived启动脚本变量引用文件，默认文件路径是/etc/sysconfig/，也可以不做软链接，直接修改启动脚本中文件路径即可（安装目录下）cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/# 将keepalived主程序加入到环境变量，ln命令类似于cp，意思是为某一个文件在另外一个位置建立一个同步的链接，好处是不必重复的占用磁盘空间。ln -s /usr/local/keepalived/sbin/keepalived /usr/sbin/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">4.</b>&nbsp;&nbsp;启动</p><ul><li>开机启动：<code>chkconfig keepalived on</code></li><li>加为系统服务：<code>chkconfig –add keepalived</code></li><li>启动、关闭、重启<code>service keepalived start|stop|restart</code></li></ul><h2 id="配置文件参数介绍"><a href="#配置文件参数介绍" class="headerlink" title="配置文件参数介绍"></a>配置文件参数介绍</h2><p><b style="font-size:18px;">5.</b>&nbsp;&nbsp;配置文件参数介绍</p><pre class="line-numbers language-ini"><code class="language-ini"># 全局定义块global_defs {   notification_email {     #指定keepalived在发生事件时，发送邮件给哪些用户       1551685913@qq.com          #设置报警邮件地址，可以设置多个，每行一个。 需开启本机的sendmail服务。 建议用独立的监控或第三方 SMTP   }   notification_email_from 1551685913@qq.com    #指定发件人   smtp_server 192.168.200.1           #指定发送email的smtp服务器   smtp_connect_timeout 30          #设置连接smtp server的超时时间   router_id LVS_DEVEL         #运行keepalived的机器的一个标识，通常可设为hostname。   vrrp_skip_check_adv_addr   #默认是不跳过检查。检查收到的VRRP通告中的所有地址可能会比较耗时，设置此命令的意思是，如果通告与接收的上一个通告来自相同的master路由器，则不执行检查(跳过检查)。   vrrp_strict              #严格遵守VRRP协议。下列情况将会阻止启动Keepalived：1. 没有VIP地址。2. 单播邻居。3. 在VRRP版本2中有IPv6地址。   vrrp_garp_interval 0   #在一个接口发送的两个免费ARP之间的延迟。可以精确到毫秒级。默认是0.   vrrp_gna_interval 0}# 定义虚拟路由， VI_1 为虚拟路由的标示符，自己定义名称vrrp_instance VI_1 {  #keepalived在同一virtual_router_id中priority（0-255）最大的会成为master，也就是接管VIP，当priority最大的主机发生故障后次priority将会接管    state MASTER    #主节点为 MASTER， 对应的备份节点为 BACKUP    interface eth0   #绑定虚拟 IP 的网络接口，与本机 IP 地址所在的网络接口相同， 如：eth0，eth1。可通过ip addr查看    virtual_router_id 51  #虚拟路由的ID号，每个节点设置必须一样，可选择IP最后一段使用，相同的 VRID 为一个组，他将决定多播的 MAC 地址。MASTER和BACKUP必须是一致的,范围是0-255.    priority 100   #指定优先级，优先级高的将成为MASTER。    advert_int 1    # 设定MASTER与BACKUP负载均衡器之间同步检查的时间间隔，单位是秒    authentication {   # 验证类型和验证密码,主从必须一样        auth_type PASS   #设置vrrp验证类型，主要有PASS和AH两种        auth_pass 1111   #设置vrrp验证密码，在同一个vrrp_instance下，MASTER与BACKUP必须使用相同的密码才能正常通信    }    #虚拟 IP 池, 两个节点设置必须一样    virtual_ipaddress {        192.168.200.16          192.168.200.17   虚拟 ip，可以定义多个        192.168.200.18    }}#定义一个虚拟服务器，这个ip是virtual_ipaddress中定义的其中一个，后面一个空格，然后加上虚拟服务的端口号。virtual_server 192.168.200.100 443 {    #VIP地址，要和vrrp_instance模块中的virtual_ipaddress地址一致    delay_loop 6   #健康检查时间间隔，单位：秒    lb_algo rr  # 负载均衡调度算法，互联网应用常用方式为wlc或rr。rr|wrr|lc|wlc|lblc|sh|dh     lb_kind NAT  #负载均衡转发规则NAT|DR|RUN     persistence_timeout 50  #会话保持时间     protocol TCP  #转发协议，分为TCP和UDP两种    sorry_server 192.168.200.200 1358    #备用机，所有realserver失效后启用    #真实服务器IP和端口，可以定义多个    real_server 192.168.201.100 443 {        weight 1  #  负载权重，值越大，转发的优先级越高        SSL_GET {            url {  #检查url，可以指定多个              path /                digest ff20ad2481f97b1754ef3e12ecd3a9cc  #检查后的摘要信息            }            url {              path /mrtg/              digest 9b3a0c85a887a256d6939da88aabd8cd            }            connect_timeout 3  #连接超时时间            retry 3            delay_before_retry 3  #重连间隔时间        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">6.</b>&nbsp;&nbsp;修改keepalived配置文件</p><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/keepalived/keepalived.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>&nbsp;&nbsp;<b style="font-size:16px;">6.1</b>&nbsp;&nbsp;MASTER 节点配置文件（192.168.178.129）</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_one  #标识本节点的字条串，通常为 hostname}# keepalived 会定时执行脚本并对脚本执行的结果进行分析，动态调整 vrrp_instance 的优先级。如果脚本执行结果为 0，并且 weight 配置的值大于 0，则优先级相应的增加。如果脚本执行结果非 0，并且 weight配置的值小于 0，则优先级相应的减少。其他情况，维持原本配置的优先级，即配置文件中 priority 对应的值。vrrp_script chk_nginx{    script "/etc/keepalived/nginx_check.sh"  #检测nginx状态脚本路径    interval 2  #检测时间间隔    weight -20  #如果条件成立，权重-20}#定义虚拟路由，VI_I为虚拟路由标示符，自己定义vrrp_instance VI_1 {    state MASTER      #主节点为MASTER ,对应的备份节点是BACKUP    interface ens33  #绑定虚拟IP的网络接口，与本机的IP地址所在的网卡接口相同    virtual_router_id 51  #虚拟路由的ID号，两个节点必须一致    mcast_src_ip 192.168.178.129 ## 本机 IP 地址    priority 100   #节点优先级，范围在0-254     nopreempt  #优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题    advert_int 1  # 组播信息发送间隔，两个节点设置必须一样， 默认 1s    # 设置验证信息，两个节点必须一致    authentication {        auth_type PASS        auth_pass 1111    }    #将 track_script 块加入 instance 配置块    track_script{        chk_nginx   # 执行 Nginx 监控的服务    }    # 虚拟 IP 池, 两个节点设置必须一样    virtual_ipaddress {        192.168.178.125   # 虚拟IP，可以定义多个    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>&nbsp;&nbsp;<b style="font-size:16px;">6.2</b>&nbsp;&nbsp;BACKUP  节点配置文件（192.168.178.130）</p><pre class="line-numbers language-ini"><code class="language-ini">! Configuration File for keepalivedglobal_defs {   router_id number_two}vrrp_script chk_nginx{        script "/etc/keepalived/nginx_check.sh"        interval 2        weight -20}vrrp_instance VI_1 {    state BACKUP    interface ens33    virtual_router_id 51    mcast_src_ip 192.168.178.130    priority 90    nopreempt    advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script{        chk_nginx    }       virtual_ipaddress {        192.168.178.125    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="编写-Nginx-状态检测脚本"><a href="#编写-Nginx-状态检测脚本" class="headerlink" title="编写 Nginx 状态检测脚本"></a>编写 Nginx 状态检测脚本</h2><p>编写 Nginx 状态检测脚本 /etc/keepalived/nginx_check.sh (已在 keepalived.conf 中配置)脚本要求：如果 nginx 停止运行，尝试启动，如果无法启动则杀死本机的 keepalived 进程， keepalied将虚拟 ip 绑定到 BACKUP 机器上。 内容如下：</p><pre class="line-numbers language-ini"><code class="language-ini"># 编辑nginx_check.sh文件vi /etc/keepalived/nginx_check.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-ini"><code class="language-ini">#!/bin/bash<span class="token constant">A</span><span class="token attr-value"><span class="token punctuation">=</span>`ps -C nginx –no-header |wc -l`</span>if [ $A -eq 0 ];then/usr/local/nginx/sbin/nginx  sleep 2if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then    killall keepalivedfifi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>保存后，给脚本赋执行权限： </p><pre class="line-numbers language-ini"><code class="language-ini">chmod +x /etc/keepalived/nginx_check.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="启动-Keepalived"><a href="#启动-Keepalived" class="headerlink" title="启动 Keepalived"></a>启动 Keepalived</h2><pre class="line-numbers language-ini"><code class="language-ini">service keepalived start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502152245.png" alt="Starting keepalived: [ OK ]"></p><h2 id="Keepalived-Nginx-的高可用测试"><a href="#Keepalived-Nginx-的高可用测试" class="headerlink" title="Keepalived+Nginx 的高可用测试"></a>Keepalived+Nginx 的高可用测试</h2><p><span style="font-size:18px;"><b>1.<b></b></b></span>同时启动192.168.178.129和192.168.178.130上的Nginx和Keepalived，我们通过VIP(192.168.178.125)来访问Nginx,如下：<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502165703.png" alt></p><p><span style="font-size:18px;"><b>2.<b></b></b></span>我们关闭192.168.178.129上的Keepalived和Nginx</p><pre class="line-numbers language-ini"><code class="language-ini">service keepalived stop/usr/sbin/nginx -s stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><span style="font-size:18px;"><b>3.<b></b></b></span>此时，再通过VIP(192.168.178.125)来访问Nginx,如下<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502173819.png" alt><br>我这个显示结果和上面一样是因为我这台服务器没绑，结果是成功得。</p><p><span style="font-size:18px;"><b>4.<b></b></b></span>我们再开启192.168.178.129上的Keepalived和Nginx</p><pre class="line-numbers language-ini"><code class="language-ini">/usr/sbin/nginxservice keepalived start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或者只执行</p><pre class="line-numbers language-ini"><code class="language-ini">service keepalived start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为我们写了脚本nginx_check.sh，这个脚本会为我们自动启动nginx<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200502181315.png" alt></p><p>到此为止,keepalived+nginx实现高可用web负载均衡搭建完毕。</p><p>参考：<br>(主参考)<a href="https://blog.csdn.net/l1028386804/article/details/72801492" target="_blank" rel="noopener">https://blog.csdn.net/l1028386804/article/details/72801492</a><br>(附参考)<a href="https://blog.csdn.net/u012599988/article/details/82152224?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3" target="_blank" rel="noopener">https://blog.csdn.net/u012599988/article/details/82152224?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3</a><br>(主配置详解参考)<a href="https://blog.csdn.net/mofiu/article/details/76644012" target="_blank" rel="noopener">https://blog.csdn.net/mofiu/article/details/76644012</a><br>(附配置详解参考)<a href="https://www.cnblogs.com/along1226/p/5027838.html" target="_blank" rel="noopener">https://www.cnblogs.com/along1226/p/5027838.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="keepalived" scheme="http://chiwai.tang99.club/categories/keepalived/"/>
    
    
      <category term="keepalived" scheme="http://chiwai.tang99.club/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>nginx+keepalived可用热备负载均衡</title>
    <link href="http://chiwai.tang99.club/posts/2236109518.html"/>
    <id>http://chiwai.tang99.club/posts/2236109518.html</id>
    <published>2020-04-28T15:33:28.000Z</published>
    <updated>2020-05-02T10:20:06.988Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="nginx-keepalived可用热备负载均衡"><a href="#nginx-keepalived可用热备负载均衡" class="headerlink" title="nginx+keepalived可用热备负载均衡"></a>nginx+keepalived可用热备负载均衡</h1><h1 id="Linux下安装nginx"><a href="#Linux下安装nginx" class="headerlink" title="Linux下安装nginx"></a>Linux下安装nginx</h1><p>安装方法请查看我另外写的一篇内容。<br><a href="http://chiwai.tang99.club/posts/3979785611.html">http://chiwai.tang99.club/posts/3979785611.html</a></p><h1 id="什么是负载均衡呢？"><a href="#什么是负载均衡呢？" class="headerlink" title="什么是负载均衡呢？"></a>什么是负载均衡呢？</h1><p>经过资料查阅，做一个简单的总结。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;负载均衡是集群技术的一种应用。负载均衡可以将工作任务分摊到多个处理单元。就是我们需要一个调度者，保证所有后端服务器都能将性能充分发挥，从而保持服务器集群的整体性能。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;由于单个处理节点发生故障不影响整个服务，负载均衡集群同时也实现了<span style="color:red;">高可用性</span>。</p><p>举个简单的例子，我们每天早上上班挤地铁，由于人特别多，你会注意到地铁工作人员拿个大喇叭喊话:着急的人请走B口，B口人少。而这个地铁工作人员就是负载均衡，负责分发客流量。</p><h1 id="集群分类"><a href="#集群分类" class="headerlink" title="集群分类"></a>集群分类</h1><ul><li><p><span style="color:red;">高性能集群</span>：将多台计算机的计算能力合并到一起，就像是一个超级计算机，从而实现一个超越单台计算机计算能力的强力系统。</p></li><li><p><span style="color:red;">高可用集群</span>：当其中一个服务出现故障时，系统会立刻分发到另外一个服务。提高冗余单元，避免单点故障。</p></li><li><p><span style="color:red;">负载均衡集群</span>：将大量的并发请求分担到多个处理节点。</p></li></ul><h1 id="常用的负载均衡"><a href="#常用的负载均衡" class="headerlink" title="常用的负载均衡"></a>常用的负载均衡</h1><ul><li><p><span style="color:red;">HTTP重定向</span><br>&nbsp;&nbsp;&nbsp;在日常web开发中，我们常用会用它来完成自动跳转，比如登录成功后跳转到其他页面。<br>&nbsp;&nbsp;&nbsp;这种重定向完全由HTTP定义，并且由HTTP代理和web服务器共同实现。简单来说当浏览器向web服务器请求某个URL后，Web服务器可以通过HTTP响应头信息中的Location标记来返回一个新的URL，这就意味着HTTP代理需要继续请求这个新的URL，这便完成了自动跳转。也正是因为这种重定向具备请求转移和自动跳转的本领，可以用来实现负载均衡。</p></li><li><p><span style="color:red;">DNS负载均衡</span><br>&nbsp;&nbsp;&nbsp;以域名作为访问入口，通过配置多条DNS A记录使得请求可以分配到不同的服务器。<br>&nbsp;&nbsp;&nbsp;但是有一个问题，似乎是解决了负载均衡，但是怎么保持你的会话在一台服务器上，还有一个问题就是，当服务器出现问题后，是不是还要改DNS配置，我们都知道，在配置当中有一个TTL时间，是不能将时间改为0的，所以，这是一种弊端。</p></li><li><p><span style="color:red;">反向代理负载均衡</span></p><blockquote><p>代理分为<span style="color:red;">正向代理</span>和<span style="color:red;">反向代理</span><br><span style="color:red;">正向代理</span>：用户将请求交给代理服务器，代理服务器访问网站获取数据，之后代理服务器在将数据返回给用户。在这个过程中，应用服务器并不知道用户的存在，只知道代理服务器的访问。VPN就是我们常用的一种代理，正向代理。<br><span style="color:red;">反向代理</span>：是服务器端的代理，代理服务器接收用户的请求，再转发给真实服务器，之后在返回给代理服务器，由代理服务器返回给用户，在这个过程中，用户并不知道真实服务器的存在。</p></blockquote></li></ul><p>&nbsp;&nbsp;&nbsp;一句话概括为代理服务器将请求均匀转发给内部多台Web服务器之一，从而达到负载均衡的目的。</p><h1 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h1><ul><li><p><span style="color:red;">轮询法</span><br>将请求按顺序轮流分配到后端服务器上，它均衡的对待后端的每一台服务器，而不关心服务器的实际连接数和当前系统的负载。<span style="color:red;">(默认为轮询法)</span><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501095119.png" alt="轮询法"></p></li><li><p><span style="color:red;">加权轮询法</span><br>不同的后端服务器可能机器的配置不同和当前系统的负载也不同，因此他们的服务器性能不统一。将性能好的服务器分配更高的权重，让其处理更多的请求，将性能低的服务器分配较低的权重，降低服务器的压力。<br>属性：<span style="color:red;">(weight)</span><br>如下配置轮询三台服务。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501105229.png" alt="加权轮询法"></p></li><li><p><span style="color:red;">源地址哈希法</span><br>通过对访问用户的IP进行哈希计算，根据得出的结果进行分配该请求哪台服务器，这样每一个用户固定请求同一个后端服务器，能够保持用户的会话存储。例如：用户A第一次访问的是列表中第一台服务器，那么用户第二次请求还会访问第一台服务器。（ip_hash可以和weight配合使用）<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501111113.png" alt="源地址哈希法"></p></li><li><p><span style="color:red;">最少连接法</span><br>将请求分配到连接数最少的服务上。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501121147.png" alt="最少连接法"></p></li><li><p><span style="color:red;">fair法</span><br>按照服务器响应时间的长短来进行分发的，服务器响应时间越短，优先分发</p><blockquote><p>fair为非官方模块，如过没有安装会报错，安装方法自行百度，挺简单的。</p></blockquote></li></ul><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501141826.png" alt="fair法"></p><h1 id="负载均衡实现方式"><a href="#负载均衡实现方式" class="headerlink" title="负载均衡实现方式"></a>负载均衡实现方式</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;我有3台虚拟主机和一台服务器，IP分别为：<span style="color:red;">192.168.178.129</span>，<span style="color:red;">192.168.178.130</span>，<span style="color:red;">192.168.**.1</span>，<span style="color:red;">47.103.*.**</span>端口号都默认为80端口。<br>&nbsp;&nbsp;&nbsp;&nbsp;其中，我以IP为<span style="color:red;">192.168.178.129</span>的作为负载均衡服务器，分别将请求分发给另外三个服务器。配置方式如下：</p><ol><li>进入到nginx安装目录，找到<code>nginx.conf</code>配置文件。编辑nginx.conf文件(192.168.178.129)<pre class="line-numbers language-ini"><code class="language-ini">vi nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501091046.png" alt><br>在http配置项里面将会看到include到其它配置文件，根据引入的地址，找到.conf相关文件。这里不是唯一的，根据每个人配置情况而定，也可以不引入，直接在里面配置也行。</li></ol><pre class="line-numbers language-ini"><code class="language-ini">cd conf.dvi default.conf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501092007.png" alt></p><ol start="2"><li><p>配置如下代码<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501092804.png" alt></p></li><li><p>结果说明，在浏览器中输入IP为<code>192.168.178.129</code>，第一次请求将展示<code>upstream</code>模块的第一个ip地址，刷新浏览器，第二次将转换到<code>upstream</code>模块的第二个ip地址，第三次为第三个地址，以此类推，按顺序轮询展示，这是因为<code>upstream</code>模块默认就是轮询法，每个ip分发一次。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501094400.png" alt="第一次"><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501094511.png" alt="第二次"><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200501094534.png" alt="第三次"></p></li><li><p>默认为轮询法，其它方法请看上面的<code># 负载均衡算法</code> 说明。</p></li></ol><h1 id="高可用keepalived安装与搭建"><a href="#高可用keepalived安装与搭建" class="headerlink" title="高可用keepalived安装与搭建"></a>高可用keepalived安装与搭建</h1><p>地址：<a href="http://chiwai.tang99.club/posts/2566092336.html#toc-heading-2">http://chiwai.tang99.club/posts/2566092336.html#toc-heading-2</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="nginx" scheme="http://chiwai.tang99.club/categories/nginx/"/>
    
    
      <category term="负载均衡" scheme="http://chiwai.tang99.club/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>Linux下安装nginx</title>
    <link href="http://chiwai.tang99.club/posts/3979785611.html"/>
    <id>http://chiwai.tang99.club/posts/3979785611.html</id>
    <published>2020-04-27T17:27:23.000Z</published>
    <updated>2020-05-01T10:20:54.050Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux-下安装nginx"><a href="#Linux-下安装nginx" class="headerlink" title="Linux 下安装nginx"></a>Linux 下安装nginx</h1><p>两种安装方式:第一种是通过nginx官网提供的存储库安装，第二种是编译安装。</p><h1 id="yum存储库安装nginx"><a href="#yum存储库安装nginx" class="headerlink" title="yum存储库安装nginx"></a>yum存储库安装nginx</h1><p><b style="font-size:18px;">1.</b>&nbsp;&nbsp;通过nginx官网安装最新稳定版nginx，上面提供了安装方法,地址:<a href="http://nginx.org/en/linux_packages.html#stable" target="_blank" rel="noopener">http://nginx.org/en/linux_packages.html#stable</a></p><p><b style="font-size:18px;">2.</b>&nbsp;&nbsp;找到以下位置：</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428014416.png" alt><br><b style="font-size:16px;">2.1.</b>&nbsp;&nbsp;分为几种不同的操作系统安装方式，是CentOS系统就选CentOS的,然后执行以下命令。</p><pre class="line-numbers language-ini"><code class="language-ini">sudo yum install yum-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="color:red;">yum-utils</span>表示是用于管理yum 存储库，安装调试软件包，源软件包，来自存储库的扩展信息和管理的工具和程序的集合。</p><p><b style="font-size:16px;">2.2.</b>&nbsp;&nbsp;<span style="color:red;">To set up the yum repository, create the file named /etc/yum.repos.d/nginx.repo with the following contents</span></p><p>这句话的意思是在<code>/etc/yum.repos.d</code>这个目录下创建<code>nginx.repo</code>文件。</p><pre class="line-numbers language-ini"><code class="language-ini"># 创建nginx.repo文件touch nginx.repo   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>创建完之后将以下内容写入到<code>nginx.repo</code>文件。</p><p>其中<code>[nginx-stable]</code>表示稳定仓库，而<code>[nginx-mainline]</code>表示主线仓库，用哪个仓库写哪个仓库。</p><pre class="line-numbers language-ini"><code class="language-ini"># 将以下内容写入到nginx.repo文件。<span class="token selector">[nginx-stable]</span><span class="token constant">name</span><span class="token attr-value"><span class="token punctuation">=</span>nginx stable repo</span><span class="token constant">baseurl</span><span class="token attr-value"><span class="token punctuation">=</span>http://nginx.org/packages/centos/$releasever/$basearch/</span><span class="token constant">gpgcheck</span><span class="token attr-value"><span class="token punctuation">=</span>1</span><span class="token constant">enabled</span><span class="token attr-value"><span class="token punctuation">=</span>1</span><span class="token constant">gpgkey</span><span class="token attr-value"><span class="token punctuation">=</span>https://nginx.org/keys/nginx_signing.key</span><span class="token constant">module_hotfixes</span><span class="token attr-value"><span class="token punctuation">=</span>true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:16px;">2.3.</b>&nbsp;&nbsp;执行以下命令安装nginx</p><pre class="line-numbers language-ini"><code class="language-ini">sudo yum install nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:16px;">2.4.</b>&nbsp;&nbsp;查看nginx版本</p><pre class="line-numbers language-ini"><code class="language-ini"># 查看nginx版本nginx -v# 查看编译参数nginx -V<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:16px;">2.5.</b>&nbsp;&nbsp;查看安装目录</p><pre class="line-numbers language-ini"><code class="language-ini">rpm -ql nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">3.</b>&nbsp;&nbsp;一键安装依赖包，执行以下命令:</p><pre class="line-numbers language-ini"><code class="language-ini">yum -y install gcc pcre-devel zlib-devel openssl openssl-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">4.</b>&nbsp;&nbsp;测试一下是否安装成功，进入<code>cd usr/sbin/</code>这个目录，不一定都是这个目录，根据你安装路径来确定。</p><pre class="line-numbers language-ini"><code class="language-ini">nginx -t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>出现以下内容，则成功<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428021621.png" alt="成功效果"></p><p><b style="font-size:18px;">5.</b>&nbsp;&nbsp;查看nginx进程是否启动：</p><pre class="line-numbers language-ini"><code class="language-ini">ps -ef | grep nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428021750.png" alt></p><p>如果没启动，启动nginx</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/sbin/# 启动nginx./nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">6.</b>&nbsp;&nbsp;这个时候，如果你想要在浏览器中访问nginx是访问不了的，因为你的80端口还没有启动。</p><p>验证80端口是否启动：</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --query-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428224920.png" alt="no表示没启动"></p><p><b style="font-size:18px;">7.</b>&nbsp;&nbsp;开启80端口,重启防火墙</p><pre class="line-numbers language-ini"><code class="language-ini"># 开端口, --permanent表示永久生效，没有此参数重启后失效firewall-cmd --add-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp --permanent </span># 重启防火墙systemctl restart firewalld     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428022324.png" alt="访问成功"></p><h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><p><b style="font-size:18px;">1.</b>&nbsp;&nbsp;一键安装依赖包，执行以下命令:</p><pre class="line-numbers language-ini"><code class="language-ini">yum -y install gcc pcre-devel zlib-devel openssl openssl-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">2.</b>&nbsp;&nbsp;在usr/local目录下新建nginx文件夹</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/localmkdir nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">3.</b>&nbsp;&nbsp;进入nginx文件夹，下载nginx的tar包，可以去<a href="http://nginx.org" target="_blank" rel="noopener">http://nginx.org</a> 里面找你想要的版本。</p><pre class="line-numbers language-ini"><code class="language-ini">cd nginxwget http://nginx.org/download/nginx-1.18.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">4.</b>&nbsp;&nbsp;解压tar</p><pre class="line-numbers language-ini"><code class="language-ini">tar -xvf nginx-1.18.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b style="font-size:18px;">5.</b>&nbsp;&nbsp;配置安装nginx，执行make，执行make install</p><pre class="line-numbers language-ini"><code class="language-ini">./configure --prefix<span class="token attr-value"><span class="token punctuation">=</span>/usr/local/nginx</span>makemake install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">6.</b>&nbsp;&nbsp;测试是否安装成功,进入到刚才配置的安装目录</p><pre class="line-numbers language-ini"><code class="language-ini">./sbin/nginx -t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428224426.png" alt="安装成功!"></p><p><b style="font-size:18px;">7.</b>&nbsp;&nbsp;启动nginx</p><pre class="line-numbers language-ini"><code class="language-ini">cd /usr/local/nginx/sbin# 启动nginx./nginx <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><b style="font-size:18px;">8.</b>&nbsp;&nbsp;这个时候如果你去网页上输入ip地址是打不开的，因为你的80端口还没有启动。<br>因为我使用的linux系统版本是CentOS7，所以可以在服务器中执行如下命令来验证</p><pre class="line-numbers language-ini"><code class="language-ini">firewall-cmd --query-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428224920.png" alt="no表示没启用"><br>显然80端口没有开启</p><p><b style="font-size:18px;">9.</b>&nbsp;&nbsp;开启80端口,重启防火墙</p><pre class="line-numbers language-ini"><code class="language-ini"># 开端口, --permanent表示永久生效，没有此参数重启后失效firewall-cmd --add-port<span class="token attr-value"><span class="token punctuation">=</span>80/tcp --permanent </span># 重启防火墙systemctl restart firewalld     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428225218.png" alt="访问成功!"></p><p><b style="font-size:18px;">10.</b>&nbsp;&nbsp;配置开机自启</p><pre class="line-numbers language-ini"><code class="language-ini">vi /etc/rc.d/rc.local/usr/local/nginx/sbin/nginx   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200428225728.png" alt></p><h1 id="常用命令说明"><a href="#常用命令说明" class="headerlink" title="常用命令说明:"></a>常用命令说明:</h1><p>nginx相关命令：<br>进入到安装目录中,<code>cd usr/sbin/</code>。</p><pre class="line-numbers language-ini"><code class="language-ini">./nginx 启动./nginx -s stop 关闭./nginx -s reload 重启<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>防火墙相关命令：</p><pre class="line-numbers language-ini"><code class="language-ini"># 重启防火墙systemctl restart firewalld  centOS6及以前版本使用命令： systemctl stop iptables.servicecentOS7关闭防火墙命令： systemctl stop firewalld.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考：<br><a href="https://www.cnblogs.com/xxoome/p/5866475.html" target="_blank" rel="noopener">https://www.cnblogs.com/xxoome/p/5866475.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="nginx" scheme="http://chiwai.tang99.club/categories/nginx/"/>
    
    
      <category term="安装nginx" scheme="http://chiwai.tang99.club/tags/%E5%AE%89%E8%A3%85nginx/"/>
    
  </entry>
  
  <entry>
    <title>centos7 ip addr 无法查看虚拟机IP解决办法</title>
    <link href="http://chiwai.tang99.club/posts/3053597239.html"/>
    <id>http://chiwai.tang99.club/posts/3053597239.html</id>
    <published>2020-04-27T13:12:11.000Z</published>
    <updated>2020-04-27T17:28:43.258Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="centos7-ip-addr-无法查看虚拟机IP解决办法"><a href="#centos7-ip-addr-无法查看虚拟机IP解决办法" class="headerlink" title="centos7 ip addr 无法查看虚拟机IP解决办法"></a>centos7 ip addr 无法查看虚拟机IP解决办法</h1><p>在centos7中查看ip地址，输入<code>ifconfig</code>命令会报以下错误:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/1587995740(1).jpg" alt></p><p>原因是centos7中已经不适用<code>ifconfig</code>命令。已经用<span style="color:red;">ip addr</span>命令代替，同时网卡名也由eth0改为eno。但是以往输入ip addr 会出现以下结果:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427223713.png" alt><br>会发现ens33没有inet这个属性，那么就没法通过IP地址连接虚拟机。</p><p>解决方式:<br>进入到网卡目录<br><code>cd /etc/sysconfig/network-scripts/</code><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427224125.png" alt><br>编辑<code>ifcfg-ens33</code>这个文件,输入<code>vi ifcfg-ens33</code><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427224547.png" alt></p><p>从以上配置信息中可以发现 CentOS 7 默认是不启动网卡的(ONBOOT=no),把这一项改为YES(ONBOOT=yes)即可。</p><p>然后重启网络服务： <code>sudo service network restart</code><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200427224920.png" alt></p><p>重启后在输入<code>ip addr</code>命令后会看到ens33下面 inet后面就是ip地址</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;中间出现了个小插曲，虚拟机异常关机,再次打开后出现以下错误:<span style="color:red;">该虚拟机似乎正在使用中。如果该虚拟机未在使用，请按“获取所有权(T)”按钮获取它的所有权</span>的错误。</p><p>经过百度得知，这是虚拟机的锁机制导致，同时在虚拟机的安装目录生成带.lck后缀的文件名。</p><p>解决办法:<br><span style="color:red;">找到虚拟机的安装目录下，删除带有.lck的文件，重启虚拟机即可。</span></p><p>参考<br><a href="https://blog.csdn.net/anshengsuiyeu/article/details/83549438" target="_blank" rel="noopener">https://blog.csdn.net/anshengsuiyeu/article/details/83549438</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://chiwai.tang99.club/categories/Linux/"/>
    
    
      <category term="无法查看虚拟机IP解决办法" scheme="http://chiwai.tang99.club/tags/%E6%97%A0%E6%B3%95%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BAIP%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Linux Crontab 定时任务</title>
    <link href="http://chiwai.tang99.club/posts/2326891732.html"/>
    <id>http://chiwai.tang99.club/posts/2326891732.html</id>
    <published>2020-04-18T13:50:43.000Z</published>
    <updated>2020-04-18T16:01:07.788Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Linux-Crontab-定时任务"><a href="#Linux-Crontab-定时任务" class="headerlink" title="Linux Crontab 定时任务"></a>Linux Crontab 定时任务</h4><h2 id="语法"><a href="#语法" class="headerlink" title="语法:"></a>语法:</h2><p>crontab [-u username] [-l|-e|-r]&nbsp;&nbsp;&nbsp;&nbsp;</p><blockquote><p>省略用户[-u username]表示操作当前用户的crontab</p></blockquote><p>选项说明:<br>  -u指定一个用户<br>  -l列出某个用户的任务计划<br>  -r删除某个用户的任务<br>  -e编辑某个用户的任务</p><p>例如:<br>①root用户查看自己的cron设置:</p><pre class="line-numbers language-ini"><code class="language-ini">crontab -u root -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>②root想删除fred的cron设置:</p><pre class="line-numbers language-ini"><code class="language-ini">crontab -u fred -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>③表示查看当前用户cron设置</p><pre class="line-numbers language-ini"><code class="language-ini">crontab -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="编辑计划任务"><a href="#编辑计划任务" class="headerlink" title="编辑计划任务"></a>编辑计划任务</h2><ul><li>执行<code>crontab -e</code>进入当前用户的工作表编辑</li><li>计划任务的规则语法格式，以行为单位，一行则为一个计划。</li><li>格式：<code>分 时 日 月 周 需要执行的命令</code><br>例如：<br>如果想要每天0点0分执行reboot指令，则可以写成<br><code>0 0 * * * reboot</code></li></ul><h2 id="取值范围"><a href="#取值范围" class="headerlink" title="取值范围"></a>取值范围</h2><blockquote><p>分：0-59<br>时：0-23<br>日：1-31<br>月：1-12<br>周：0-7，0和7表示星期天</p></blockquote><h2 id="四个符号"><a href="#四个符号" class="headerlink" title="四个符号"></a>四个符号</h2><blockquote><p>*：表示取值范围中的每一个数字<br>-：做连续区间表达式，要想表示1-7，则可以写成：1-7<br>/：表示每多少个，例如：想每10分钟一次，则可以在分的位置写：*/10<br>,：表示多个取值，比如想在1点，2点，5点执行，则可以在时的位置写：1，2，6</p></blockquote><p>问题1：每月1、10、22日的4:45重启network服务<br><code>45 4 1,10,22 * * service network restart</code></p><p>问题2：每周六，周日的1:10重启network服务<br><code>10 1 * * 6,7 service network restart</code></p><p>问题3：每天18:00至23:00之间每隔30分钟重启network服务<br><code>/30 18-23 * * * service network restart</code></p><p>问题4：每隔两天的上午8点到11点的第3和第15分钟执行一次重启<br><code>3,15 8-11 */2 * * service network restart</code></p><p>案例：每1分钟往root家目录中rt.txt中输出一个1，使用追加的方式输出<br><code>*/1 * * * * echo &#39;1&#39; &gt;&gt; /root/rt.txt</code></p><blockquote><p>对于linux中&gt;跟 &gt;&gt; 区别 ，2&gt;&amp;1 是什么意思，参考以下文档说明<br><a href="https://blog.csdn.net/junge1545/article/details/80838554" target="_blank" rel="noopener">https://blog.csdn.net/junge1545/article/details/80838554</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://chiwai.tang99.club/categories/Linux/"/>
    
    
      <category term="定时任务" scheme="http://chiwai.tang99.club/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>微信公众号封装CURL请求</title>
    <link href="http://chiwai.tang99.club/posts/1881859890.html"/>
    <id>http://chiwai.tang99.club/posts/1881859890.html</id>
    <published>2020-04-15T08:39:25.000Z</published>
    <updated>2020-04-17T10:09:39.752Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>微信公众号封装CURL请求方法，结合Redis缓存获取access_token</p></blockquote><h1 id="封装CURL请求方法"><a href="#封装CURL请求方法" class="headerlink" title="封装CURL请求方法"></a>封装CURL请求方法</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * @param $api 接口地址 * @param array $data 数据信息 * @param string $method 请求方法 * @param string $returnType 返回类型 */</span><span class="token keyword">function</span> <span class="token function">http_url</span><span class="token punctuation">(</span><span class="token variable">$api</span><span class="token punctuation">,</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$method</span> <span class="token operator">=</span> <span class="token string">"get"</span><span class="token punctuation">,</span><span class="token variable">$returnType</span> <span class="token operator">=</span> <span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//开启会话</span>    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//设置url</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span><span class="token variable">$api</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//设置数据流不直接输出</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//规避ssl证书检查</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYPEER</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//跳过host验证</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYHOST</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">!=</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//如果你想PHP去做一个正规的HTTP POST，设置这个选项为一个非零值</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_POST</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//传递一个作为HTTP “POST”操作的所有数据的字符串。</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span><span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//执行会话</span>    <span class="token variable">$jsonInfo</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//关闭会话</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$returnType</span> <span class="token operator">==</span> <span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$jsonInfo</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$jsonInfo</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Redis缓存获取access-token"><a href="#Redis缓存获取access-token" class="headerlink" title="Redis缓存获取access_token"></a>Redis缓存获取access_token</h1><blockquote><p>access_token的有效期为2小时，每天请求次数有限，所以存到redis里面。</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">get_access_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//微信appid</span>    <span class="token variable">$appid</span> <span class="token operator">=</span> <span class="token string">'你的微信appid'</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//用户唯一凭证密钥</span>    <span class="token variable">$secret</span> <span class="token operator">=</span> <span class="token string">'你的密钥'</span><span class="token punctuation">;</span>    <span class="token variable">$get_access_token</span> <span class="token operator">=</span> \<span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'get_access_token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$get_access_token</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$api</span> <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid='.$appid .'&amp;secret='.$secret;</span>        <span class="token variable">$get_access_token</span> <span class="token operator">=</span> <span class="token function">http_url</span><span class="token punctuation">(</span><span class="token variable">$api</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        \<span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token string">'get_access_token'</span><span class="token punctuation">,</span><span class="token number">7200</span><span class="token punctuation">,</span><span class="token variable">$get_access_token</span><span class="token punctuation">[</span><span class="token string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$get_access_token</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="微信公众号" scheme="http://chiwai.tang99.club/categories/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/"/>
    
    
      <category term="CURL" scheme="http://chiwai.tang99.club/tags/CURL/"/>
    
      <category term="获取token" scheme="http://chiwai.tang99.club/tags/%E8%8E%B7%E5%8F%96token/"/>
    
  </entry>
  
  <entry>
    <title>git操作实战</title>
    <link href="http://chiwai.tang99.club/posts/3559721766.html"/>
    <id>http://chiwai.tang99.club/posts/3559721766.html</id>
    <published>2020-04-03T04:26:41.000Z</published>
    <updated>2020-04-17T08:06:59.247Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;实战模拟场景说明，创建<span style="color:red;">w1(组长)</span>,<span style="color:red;">w2(组员)</span>两个工作区。</p><h1 id="1-组长在w1工作区搭建一个Laravel项目。"><a href="#1-组长在w1工作区搭建一个Laravel项目。" class="headerlink" title="1.组长在w1工作区搭建一个Laravel项目。"></a>1.组长在w1工作区搭建一个Laravel项目。</h1><h2 id="1-1安装laravel命令"><a href="#1-1安装laravel命令" class="headerlink" title="1.1安装laravel命令"></a>1.1安装laravel命令</h2><pre class="line-numbers language-text"><code class="language-text">Composer create-project Laravel/Laravel=5.5.* --prefer-dist mylaravel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-2本地项目创建git仓库"><a href="#1-2本地项目创建git仓库" class="headerlink" title="1.2本地项目创建git仓库"></a>1.2本地项目创建git仓库</h2><p>进入项目目录，执行<b>git init</b>命令<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417152128.png" alt="本地创建git仓库"><br>仓库创建好以后，会在本地生成.git文件夹。</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417152159.png" alt></p><h2 id="1-3将项目从工作区加入暂存区"><a href="#1-3将项目从工作区加入暂存区" class="headerlink" title="1.3将项目从工作区加入暂存区"></a>1.3将项目从工作区加入暂存区</h2><pre class="line-numbers language-text"><code class="language-text">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看当前操作状态</p><pre class="line-numbers language-text"><code class="language-text">git status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417153329.png" alt="会看到刚才加入到暂存区的文件"></p><h2 id="1-4将暂存区加入到版本库"><a href="#1-4将暂存区加入到版本库" class="headerlink" title="1.4将暂存区加入到版本库"></a>1.4将暂存区加入到版本库</h2><pre class="line-numbers language-text"><code class="language-text">git commit -m '初始化laravel项目'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-5将项目添加到远程仓库"><a href="#1-5将项目添加到远程仓库" class="headerlink" title="1.5将项目添加到远程仓库"></a>1.5将项目添加到远程仓库</h2><p>先去GitHub上创建一个远程仓库,创建好之后，在仓库中会显示你以什么样的方式提交说明。</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417153400.png" alt></p><h2 id="1-6本地仓库与远程仓库建立连接"><a href="#1-6本地仓库与远程仓库建立连接" class="headerlink" title="1.6本地仓库与远程仓库建立连接"></a>1.6本地仓库与远程仓库建立连接</h2><pre class="line-numbers language-text"><code class="language-text">git remote add origin git@github.com：zhiweiUU9 / mylaravel.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-7将本地仓库的内容上传到远程仓库"><a href="#1-7将本地仓库的内容上传到远程仓库" class="headerlink" title="1.7将本地仓库的内容上传到远程仓库"></a>1.7将本地仓库的内容上传到远程仓库</h2><pre class="line-numbers language-text"><code class="language-text">git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果出现错误<span style="color:red;">fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists.</span></p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417153429.png" alt="错误提示"></p><p>解决方法:</p><h3 id="1-7-1-检查中文符号和空格"><a href="#1-7-1-检查中文符号和空格" class="headerlink" title="1.7.1 检查中文符号和空格"></a>1.7.1 检查中文符号和空格</h3><p>先检查第<b>1.6</b>项本地与远程仓库建立连接时复制的git命令不能有中文符号或空格。</p><h3 id="1-7-2-检验ssh"><a href="#1-7-2-检验ssh" class="headerlink" title="1.7.2 检验ssh"></a>1.7.2 检验ssh</h3><p>如果git命令没有问题，检查是否生成ssh并添加到GitHub上。</p><pre class="line-numbers language-text"><code class="language-text">//查看是否生成过密钥ls -al ~/.ssh/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果存在，执行以下命令将内容复制添加到GitHub的ssh上，然后在执行<b>1.7</b>项，看看是否还报错。</p><pre class="line-numbers language-ini"><code class="language-ini">cat ~/.ssh/id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果不存在，看<b>1.7.3</b>项</p><h3 id="1-7-3-生成ssh"><a href="#1-7-3-生成ssh" class="headerlink" title="1.7.3 生成ssh"></a>1.7.3 生成ssh</h3><p>第一步：先验证一下用户名邮箱</p><pre class="line-numbers language-ini"><code class="language-ini">git config --global --list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二步：设置全局用户名和邮箱</p><pre class="line-numbers language-ini"><code class="language-ini">git config --global user.name "your name"git config --global user.email "your email"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>第三步：生成密钥</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-keygen -t rsa -C "这里换上你的邮箱"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第四步：复制密钥到GitHub上，然后在执行<b>1.7</b>项，看看是否还报错。</p><p>如果还报错，看1.7.4</p><h3 id="1-7-4-继续报错解决"><a href="#1-7-4-继续报错解决" class="headerlink" title="1.7.4 继续报错解决"></a>1.7.4 继续报错解决</h3><p>首先执行以下代码测试一下</p><pre class="line-numbers language-ini"><code class="language-ini">ssh git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>出现错误：<span style="color:red">Warning: Permanently added the RSA host key for IP address ‘13.250.000.000’ to the list of known hosts.PTY allocation request failed on channel 0</span><br>大概意思就是这个IP地址RSA主机密钥永久的添加到了你的主机列表中，您已经成功地进行了身份验证，但GITHUB不提供shell访问。</p><p>解决办法：<br>第一步：测试ssh连接是否成功</p><pre class="line-numbers language-ini"><code class="language-ini">ssh -v git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二步：<br>先执行:</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-agent -s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在执行:</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-add ~/.ssh/id_rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果出现错误:<span>Could not open a connection to your authentication agent</span><br>执行下面命令，然后再执行一遍(ssh-add ~/.ssh/id_rsa)命令</p><pre class="line-numbers language-ini"><code class="language-ini">ssh-agent bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后</p><pre class="line-numbers language-ini"><code class="language-ini">ssh -T git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><span style="color:red;">Hi nitt! You’ve successfully authenticated, but GitHub does not provide shell access.</span><br>到这里的时候就完事了，然后再去执行<b>1.7</b>项，就完事了。<br>错误问题参考资料：<br><a href="https://www.cnblogs.com/jenkin1991/p/9604054.html" target="_blank" rel="noopener">https://www.cnblogs.com/jenkin1991/p/9604054.html</a><br><a href="https://www.cnblogs.com/sheldonxu/archive/2012/09/17/2688281.html" target="_blank" rel="noopener">https://www.cnblogs.com/sheldonxu/archive/2012/09/17/2688281.html</a></p><h1 id="2-组员在w2工作区进行项目功能开发"><a href="#2-组员在w2工作区进行项目功能开发" class="headerlink" title="2.组员在w2工作区进行项目功能开发"></a>2.组员在w2工作区进行项目功能开发</h1><h2 id="2-1克隆项目到本地"><a href="#2-1克隆项目到本地" class="headerlink" title="2.1克隆项目到本地"></a>2.1克隆项目到本地</h2><p>在远端仓库获取仓库地址，然后执行</p><pre class="line-numbers language-ini"><code class="language-ini">git clone https://github.com/****/mylaravel.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>由于从git拉取下来的项目缺少vendor目录，需要重新下</p><pre class="line-numbers language-ini"><code class="language-ini">cd mylaravelcomposer install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="3-场景模拟"><a href="#3-场景模拟" class="headerlink" title="3.场景模拟"></a>3.场景模拟</h1><h2 id="3-1-组长在-readme-md创建内容"><a href="#3-1-组长在-readme-md创建内容" class="headerlink" title="3.1 组长在 readme.md创建内容"></a>3.1 组长在 <span style="color:red;">readme.md</span>创建内容</h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417154114.png" alt></p><h3 id="3-1-1将修改的内容提交到暂存区"><a href="#3-1-1将修改的内容提交到暂存区" class="headerlink" title="3.1.1将修改的内容提交到暂存区"></a>3.1.1将修改的内容提交到暂存区</h3><pre class="line-numbers language-ini"><code class="language-ini">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-1-2将暂存区的文件提交到版本库"><a href="#3-1-2将暂存区的文件提交到版本库" class="headerlink" title="3.1.2将暂存区的文件提交到版本库"></a>3.1.2将暂存区的文件提交到版本库</h3><pre class="line-numbers language-ini"><code class="language-ini">git commit -m "组长添加内容到readme.md文件"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-1-3提交到远程仓库"><a href="#3-1-3提交到远程仓库" class="headerlink" title="3.1.3提交到远程仓库"></a>3.1.3提交到远程仓库</h3><pre class="line-numbers language-ini"><code class="language-ini">git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-2-组员也在-readme-md创建内容"><a href="#3-2-组员也在-readme-md创建内容" class="headerlink" title="3.2 组员也在 readme.md创建内容"></a>3.2 组员也在 <span style="color:red;">readme.md</span>创建内容</h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417154547.png" alt></p><h3 id="3-2-1将修改的内容提交到暂存区"><a href="#3-2-1将修改的内容提交到暂存区" class="headerlink" title="3.2.1将修改的内容提交到暂存区"></a>3.2.1将修改的内容提交到暂存区</h3><pre class="line-numbers language-ini"><code class="language-ini">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-2将暂存区的文件提交到版本库"><a href="#3-2-2将暂存区的文件提交到版本库" class="headerlink" title="3.2.2将暂存区的文件提交到版本库"></a>3.2.2将暂存区的文件提交到版本库</h3><pre class="line-numbers language-ini"><code class="language-ini">git commit -m "组员添加内容到readme.md文件"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-3那么问题来了，组员使用什么分支提交呢？"><a href="#3-2-3那么问题来了，组员使用什么分支提交呢？" class="headerlink" title="3.2.3那么问题来了，组员使用什么分支提交呢？"></a>3.2.3那么问题来了，组员使用什么分支提交呢？</h3><p>查看当前分支</p><pre class="line-numbers language-ini"><code class="language-ini">git branch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果：<span style="color:red">* master</span><br>会显示到当前使用的master分支，如果组长和组员都推送到master分支，那么会存在冲突问题,解决创建新的分支</p><p>创建zhangsan分支</p><pre class="line-numbers language-ini"><code class="language-ini">git branch zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后切换到zhangsan分支</p><pre class="line-numbers language-ini"><code class="language-ini">git checkout zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后提交到远程仓库</p><pre class="line-numbers language-ini"><code class="language-ini">git push -u origin zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-3组长合并分支"><a href="#3-3组长合并分支" class="headerlink" title="3.3组长合并分支"></a>3.3组长合并分支</h2><h3 id="3-3-1-先查看一下服务器有哪些分支更新，并拉取到本地"><a href="#3-3-1-先查看一下服务器有哪些分支更新，并拉取到本地" class="headerlink" title="3.3.1 先查看一下服务器有哪些分支更新，并拉取到本地"></a>3.3.1 先查看一下服务器有哪些分支更新，并拉取到本地</h3><pre class="line-numbers language-ini"><code class="language-ini">git fetch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-2-然后合并zhangsan的分支"><a href="#3-3-2-然后合并zhangsan的分支" class="headerlink" title="3.3.2 然后合并zhangsan的分支"></a>3.3.2 然后合并zhangsan的分支</h3><pre class="line-numbers language-ini"><code class="language-ini">git merge origin/zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417160650.png" alt></p><h3 id="3-3-3-然后查看一下是否有冲突"><a href="#3-3-3-然后查看一下是否有冲突" class="headerlink" title="3.3.3 然后查看一下是否有冲突"></a>3.3.3 然后查看一下是否有冲突</h3><pre class="line-numbers language-ini"><code class="language-ini">git diff<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-4-如果没有冲突，组长把合并文件推送到服务器master分支"><a href="#3-3-4-如果没有冲突，组长把合并文件推送到服务器master分支" class="headerlink" title="3.3.4 如果没有冲突，组长把合并文件推送到服务器master分支"></a>3.3.4 如果没有冲突，组长把合并文件推送到服务器master分支</h3><pre class="line-numbers language-ini"><code class="language-ini">git push origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-4-组员拉取组长合并完的内容"><a href="#3-4-组员拉取组长合并完的内容" class="headerlink" title="3.4 组员拉取组长合并完的内容"></a>3.4 组员拉取组长合并完的内容</h2><h3 id="3-4-1-先查看一下是否有最新提交并拉取到本地"><a href="#3-4-1-先查看一下是否有最新提交并拉取到本地" class="headerlink" title="3.4.1 先查看一下是否有最新提交并拉取到本地"></a>3.4.1 先查看一下是否有最新提交并拉取到本地</h3><pre class="line-numbers language-ini"><code class="language-ini">git fetch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-4-2-组员合并分支"><a href="#3-4-2-组员合并分支" class="headerlink" title="3.4.2 组员合并分支"></a>3.4.2 组员合并分支</h3><pre class="line-numbers language-ini"><code class="language-ini">git merge origin/master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-4-3-然后查看一下是否有冲突"><a href="#3-4-3-然后查看一下是否有冲突" class="headerlink" title="3.4.3 然后查看一下是否有冲突"></a>3.4.3 然后查看一下是否有冲突</h3><pre class="line-numbers language-ini"><code class="language-ini">git diff<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后组员开发完进行提交，提交到远程服务器后，组长fetch一下，然后组长进行merge合并，合并完之后看看diff有无冲突，没有冲突add，然后commit，然后push<br>到master远程，然后组员fetch，然后组员merge，然后开发，add，commit，push到zhangsan分支，以此类推，情况而定。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Git" scheme="http://chiwai.tang99.club/categories/Git/"/>
    
    
      <category term="Git实战" scheme="http://chiwai.tang99.club/tags/Git%E5%AE%9E%E6%88%98/"/>
    
  </entry>
  
  <entry>
    <title>openlayers3简单demo实现</title>
    <link href="http://chiwai.tang99.club/posts/2687365199.html"/>
    <id>http://chiwai.tang99.club/posts/2687365199.html</id>
    <published>2020-03-13T01:34:02.000Z</published>
    <updated>2020-03-16T08:05:31.160Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;OpenLayers 初始化一幅地图(map)，至少需要一个可视区域(view)，一个或多个图层( layer)， 和 一个地图加载的目标 HTML 标签(target)，其中最重要的是图层( layer)。<br>&nbsp;&nbsp;&nbsp;&nbsp;其中Source和Layer是一对一的关系，有一个Source，必然需要一个Layer，然后把这个Layer添加到Map上，就可以显示出来了。通过官网的API搜索ol.source可以发现有很多不同的Source，但归纳起来共三种：ol.source.Tile，ol.source.Image和ol.source.Vector。</p><h2 id="可视区域"><a href="#可视区域" class="headerlink" title="可视区域"></a>可视区域</h2><pre class="line-numbers language-html"><code class="language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span><span class="token number">800</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="初始化图层"><a href="#初始化图层" class="headerlink" title="初始化图层"></a>初始化图层</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//初始化图层</span><span class="token function">bindmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 创建地图</span>    that<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        target<span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>        renderer<span class="token punctuation">:</span> <span class="token string">'canvas'</span><span class="token punctuation">,</span>        controls<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            zoom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            attribution<span class="token punctuation">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        logo<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        view<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">117.0</span><span class="token punctuation">,</span> <span class="token number">39.77</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">//设置香河为中心点，此处进行坐标转换， 把EPSG:4326的坐标，转换为EPSG:3857坐标，因为ol默认使用的是EPSG:38 57坐标</span>            <span class="token comment" spellcheck="true">// center: ol.proj.transform([117.0, 39.77], 'EPSG:4326', 'EPSG:3857'),</span>            projection<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"EPSG:4326"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// extent:[0,0,117.0,39.77],</span>            <span class="token comment" spellcheck="true">// minZoom:7,</span>            <span class="token comment" spellcheck="true">// maxZoom:18,</span>            zoom<span class="token punctuation">:</span> <span class="token number">12</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 设置地图图层</span>    <span class="token comment" spellcheck="true">// 创建一个使用Open Street Map地图源的瓦片图层</span>    <span class="token keyword">let</span> layers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        source<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// source: new ol.source.TileSuperMapRest({</span>        <span class="token comment" spellcheck="true">//     url: 'http://000.000.000.00:45622/iserver/services/map-HT_Map_SL/rest/maps/HT_Map_Blue',</span>        <span class="token comment" spellcheck="true">//     wrapX: false,</span>        <span class="token comment" spellcheck="true">//     transparent: true</span>        <span class="token comment" spellcheck="true">// })</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    that<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>layers<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成地图点位信息"><a href="#生成地图点位信息" class="headerlink" title="生成地图点位信息"></a>生成地图点位信息</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 创建地图点位信息  */</span><span class="token function">createMark</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> Features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> option<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> startMarker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span> <span class="token string">"p1"</span><span class="token punctuation">,</span>            type<span class="token punctuation">:</span> <span class="token string">"icon"</span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>            geometry<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>point<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Features<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>startMarker<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// var vectorSource = new ol.source.Vector({});</span>        <span class="token comment" spellcheck="true">// vectorSource.addFeature(startMarker);</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        source<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            features<span class="token punctuation">:</span> Features        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Icon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                anchor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                src<span class="token punctuation">:</span> option<span class="token punctuation">.</span>src<span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">// size: [50, 20],</span>                scale<span class="token punctuation">:</span> <span class="token number">1</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        visible<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>    that<span class="token punctuation">.</span>layer_list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// type: option.p1id,</span>        <span class="token comment" spellcheck="true">// type2: option.p2id,</span>        layer<span class="token punctuation">:</span> vectorLayer<span class="token punctuation">,</span>        show<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//地图点位点击事件</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> feature <span class="token operator">=</span> that<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">forEachFeatureAtPixel</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>pixel<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>            feature<span class="token punctuation">,</span>            layer        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> feature<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> feature<span class="token punctuation">.</span>N<span class="token punctuation">;</span>        that<span class="token punctuation">.</span>info <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">;</span>        that<span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//data 为 写入的数据</span>        <span class="token comment" spellcheck="true">// that.tu_list = data.data.info;</span>        <span class="token comment" spellcheck="true">// that.showtable = true;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//pc端加载页面时窗口大小发生变化，导致无法点击点位信息</span>    window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成多边形"><a href="#生成多边形" class="headerlink" title="生成多边形"></a>生成多边形</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 根据点位生成多边形 */</span><span class="token function">createPolygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>SList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> _points <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//点位</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token keyword">in</span> _points<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span> wrapX<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//创建用于绘制形状的图层</span>            <span class="token keyword">var</span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                source<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>siteStyle<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置图层样式</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将图层添加至地图</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>mapLayer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//获取点位对象</span>            <span class="token comment" spellcheck="true">// console.log(_points);</span>            <span class="token keyword">var</span> feature <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                geometry<span class="token punctuation">:</span> geometry            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//点位转换为图形对象</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>SList<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addFeatures</span><span class="token punctuation">(</span><span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将图形添加至目标图层</span>            c<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="获取图形坐标值"><a href="#获取图形坐标值" class="headerlink" title="获取图形坐标值"></a>获取图形坐标值</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* * 获取图形值 */</span><span class="token function">getMapInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token function">postRequest</span><span class="token punctuation">(</span><span class="token string">'/Huanbao/getMapPoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            that<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            that<span class="token punctuation">.</span>pointList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            that<span class="token punctuation">.</span>siteStyle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                that<span class="token punctuation">.</span>pointList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lnglat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">let</span> color <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"rgb("</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/ /g</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>siteStyle<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>                    <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                        fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            color<span class="token punctuation">:</span>                                <span class="token string">"rgba("</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">","</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">","</span> <span class="token operator">+</span>                                color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span>                                <span class="token string">",0.1)"</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">// color:</span>                            <span class="token comment" spellcheck="true">//     "rgba(" +</span>                            <span class="token comment" spellcheck="true">//     color[0] +</span>                            <span class="token comment" spellcheck="true">//     "," +</span>                            <span class="token comment" spellcheck="true">//     color[1] +</span>                            <span class="token comment" spellcheck="true">//     "," +</span>                            <span class="token comment" spellcheck="true">//     color[2] +</span>                            <span class="token comment" spellcheck="true">//     ",0.8)",</span>                            color<span class="token punctuation">:</span> that<span class="token punctuation">.</span>color1<span class="token punctuation">,</span>                            width<span class="token punctuation">:</span> <span class="token number">1</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token comment" spellcheck="true">//在地图上显示文字信息</span>                        text<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                             text<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentName<span class="token punctuation">,</span>                             scale<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">,</span>                             fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                               color<span class="token punctuation">:</span> <span class="token string">'#000000'</span>                             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                             stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                               color<span class="token punctuation">:</span> <span class="token string">'#FFFF99'</span><span class="token punctuation">,</span>                               width<span class="token punctuation">:</span> <span class="token number">3.5</span>                             <span class="token punctuation">}</span><span class="token punctuation">)</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            that<span class="token punctuation">.</span><span class="token function">createPolygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="根据经纬度定位"><a href="#根据经纬度定位" class="headerlink" title="根据经纬度定位"></a>根据经纬度定位</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @param {array} viewCenter 经纬度 * @param {int} viewZoom * 根据经纬度定位 */</span><span class="token function">changeMapView</span><span class="token punctuation">(</span>viewCenter<span class="token punctuation">,</span> viewZoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> viewOptions <span class="token operator">=</span> <span class="token punctuation">{</span>        duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>        center<span class="token punctuation">:</span> viewCenter<span class="token punctuation">,</span>        zoom<span class="token punctuation">:</span> viewZoom    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>viewOptions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="地图放大"><a href="#地图放大" class="headerlink" title="地图放大"></a>地图放大</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="地图缩小"><a href="#地图缩小" class="headerlink" title="地图缩小"></a>地图缩小</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="回到起始位置"><a href="#回到起始位置" class="headerlink" title="回到起始位置"></a>回到起始位置</h2><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">initAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeMapView</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">117.0</span><span class="token punctuation">,</span> <span class="token number">39.77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>参考附件下载<br><a href="/download/index.vue" ">点击下载</a><br><a href="/download/index1.vue" ">点击下载</a><br><a href="/download/index2.vue" ">点击下载</a></p><blockquote><p>参考资料:<br><a href="https://www.cnblogs.com/benmumu/p/8081068.html" target="_blank" rel="noopener">https://www.cnblogs.com/benmumu/p/8081068.html</a><br><a href="https://blog.csdn.net/qingyafan/article/details/45398131" target="_blank" rel="noopener">https://blog.csdn.net/qingyafan/article/details/45398131</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="地图" scheme="http://chiwai.tang99.club/categories/%E5%9C%B0%E5%9B%BE/"/>
    
    
      <category term="Openlayers3" scheme="http://chiwai.tang99.club/tags/Openlayers3/"/>
    
  </entry>
  
  <entry>
    <title>Windows2012安装IIS中.NET Framework3.5报错</title>
    <link href="http://chiwai.tang99.club/posts/724213894.html"/>
    <id>http://chiwai.tang99.club/posts/724213894.html</id>
    <published>2020-03-06T13:29:36.000Z</published>
    <updated>2020-04-17T04:29:25.517Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Windows2012安装IIS中-NET-Framework3-5报错"><a href="#Windows2012安装IIS中-NET-Framework3-5报错" class="headerlink" title="Windows2012安装IIS中.NET Framework3.5报错"></a>Windows2012安装IIS中.NET Framework3.5报错</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;windows2012安装IIS中.net framework3.5报错，提示：安装安装一个或多个角色、角色服务或功能失败或者一个或多个安装选项在目标服务器上缺少源文件，或者找不到源文件等错误信息。<br>原因是.net framework3.5程序源文件找不到所导致的。<br>如图所示:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417122913.png" alt><br>解决方法为可以通过PowerShell 脚本进行安装。<br>1.在开始菜单中找到PowerShell，右键单击选择以管理员身份运行。<br>2.输入以下脚本，按回车执行。</p><pre class="line-numbers language-ini"><code class="language-ini">Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU' -Name UseWUServer -Value 0Restart-Service -Name wuauservInstall-WindowsFeature Net-Framework-CoreSet-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU' -Name UseWUServer -Value 1Restart-Service -Name wuauserv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此刻再回到服务管理器-&gt;添加角色功能-&gt;功能中，就看到.Net Framework 3.5安装成功。</p><p>参考文章:<br><a href="https://www.wanweiwang.cn/FAQ/view/1006.html" target="_blank" rel="noopener">https://www.wanweiwang.cn/FAQ/view/1006.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="服务器" scheme="http://chiwai.tang99.club/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="安装" scheme="http://chiwai.tang99.club/tags/%E5%AE%89%E8%A3%85/"/>
    
      <category term="IIS" scheme="http://chiwai.tang99.club/tags/IIS/"/>
    
  </entry>
  
  <entry>
    <title>PHP导入功能</title>
    <link href="http://chiwai.tang99.club/posts/549686560.html"/>
    <id>http://chiwai.tang99.club/posts/549686560.html</id>
    <published>2020-03-02T00:42:19.000Z</published>
    <updated>2020-03-14T00:52:41.919Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>PHP实现导入功能，功能简单大众化，简单记录方便后续使用。</p></blockquote><p>前端部分</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>upload-demo<span class="token punctuation">"</span></span>    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/index.php/admin/Auditors/importTable2<span class="token punctuation">"</span></span>    <span class="token attr-name">:show-file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>    <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleAvatarSuccessq<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn-look<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Excel导入<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//导入</span>    <span class="token function">handleAvatarSuccessq</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"导入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> searchData <span class="token operator">=</span> <span class="token punctuation">{</span>          pageNow<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          company_id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>companyId        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userlist</span><span class="token punctuation">(</span>searchData<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>后端</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">importTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$param</span><span class="token operator">=</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">'./static/upload/importfile'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$zhui</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$zhui</span><span class="token operator">!=</span><span class="token string">'xls'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$zhui</span><span class="token operator">!=</span><span class="token string">'xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'请上传正确的模板文件'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./static/upload/importfile/'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"PHPExcel"</span><span class="token punctuation">,</span> <span class="token constant">EXTEND_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'xlsx'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$objReader</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReader</span><span class="token punctuation">(</span><span class="token string">'Excel2007'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$objReader</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReader</span><span class="token punctuation">(</span><span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$objPHPExcel</span> <span class="token operator">=</span> <span class="token variable">$objReader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$encode</span> <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sheet</span> <span class="token operator">=</span> <span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$highestRow</span> <span class="token operator">=</span> <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHighestRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 取得总行数</span>        <span class="token variable">$highestColumn</span> <span class="token operator">=</span> <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHighestColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 取得总列数</span>        <span class="token comment" spellcheck="true">//验证</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$highestRow</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//涉及企业级次</span>            <span class="token variable">$cname</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getLevelZhuanName</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，C列输入的涉及企业级次不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否上市公司</span>                <span class="token variable">$isShang</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token variable">$isShang</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，D列输入的是否上市公司不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//问题线索来源</span>                <span class="token variable">$source</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanSourceName</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，E列输入的问题线索来源不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//问题类别</span>                <span class="token variable">$qtype</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"H"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanQtypeName</span><span class="token punctuation">(</span><span class="token variable">$qtype</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，H列输入的问题类别不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//境内（外）</span>                <span class="token variable">$jing</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"J"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanJnInfo</span><span class="token punctuation">(</span><span class="token variable">$jing</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，J列输入的境内（外）不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否完成核查</span>                <span class="token variable">$he</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"M"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanCheck</span><span class="token punctuation">(</span><span class="token variable">$he</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，M列输入的是否完成核查不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//核查主体</span>                <span class="token variable">$main</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"N"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanCheckMain</span><span class="token punctuation">(</span><span class="token variable">$main</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，N列输入的核查主体不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//损失认定类别</span>                <span class="token variable">$sun</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"W"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanLossTypeName</span><span class="token punctuation">(</span><span class="token variable">$sun</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，W列输入的损失认定类别不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//是否完成</span>                <span class="token variable">$iswan</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token variable">$iswan</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'第'</span><span class="token punctuation">.</span><span class="token variable">$i</span><span class="token punctuation">.</span><span class="token string">'行，BK列输入的是否完成不存在'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//插入</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$highestRow</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$cname</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$cname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//基本信息</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及企业名称</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'level'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getLevelZhuanName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及企业级次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'isShang'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否上市公司</span>                <span class="token comment" spellcheck="true">//问题受理</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanSourceName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题线索来源</span>                <span class="token variable">$acceptTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"F"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$acceptTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'acceptTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$acceptTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题受理时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'descript'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"G"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题简要描述</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'qtype'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanQtypeName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"H"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题类别</span>                <span class="token variable">$occurTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"I"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$occurTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'occurTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$occurTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//问题发生时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'domestic'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanJnInfo</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"J"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//境内（外）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'riskLose'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"K"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//预估损失风险（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'measures'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"L"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采取的应对措施</span>                <span class="token comment" spellcheck="true">//核查情况</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'ischeck'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanCheck</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"M"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否完成核查</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkMain'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanCheckMain</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"N"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查主体</span>                <span class="token variable">$checkEndTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"O"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$checkEndTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkEndTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$checkEndTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查结束时间</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//违规事实</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'checkResultDescript'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"P"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//核查结果简要简要描述</span>                <span class="token variable">$name</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Q"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$names</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$whedd</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'in'</span><span class="token punctuation">,</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$ppid</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'duty_report_involved'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$whedd</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$personIds</span><span class="token operator">=</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token variable">$ppid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$personIds</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'involved'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$personIds</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//涉及人员</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'violation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"R"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//违反具体规定</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'violationType'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"S"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//违反规定类别</span>                <span class="token comment" spellcheck="true">//损失认定</span>                <span class="token variable">$lossTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"T"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$lossTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$lossTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失确认时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"U"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失金额（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'loseRiskPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"V"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失风险金额（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'lossType'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanLossTypeName</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"W"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失认定类别</span>                <span class="token comment" spellcheck="true">//责任认定</span>                <span class="token variable">$responTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"X"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$responTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'responTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$responTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责任认定时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'totalNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Y"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'mtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"Z"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//中管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'wtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AA"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//委管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'qtubeNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AB"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//企业管理干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'totalVisits'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AC"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'mleaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AD"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//重要领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'fleaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AE"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//分管领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'leaderRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AF"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//领导责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'superRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AG"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//主管责任</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'dircetRes'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AH"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//直接责任</span>                <span class="token comment" spellcheck="true">//责任追究</span>                <span class="token variable">$accountabilityTime</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AI"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$accountabilityTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'accountabilityTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$accountabilityTime</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责任追究时间</span>                <span class="token punctuation">}</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atotalNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AJ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//中管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'awtubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AL"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//委管干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'aqtubeLeader'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AM"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//企业管理干部</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'atotalVisits'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AN"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//总人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'aztNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AO"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'comEducation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AP"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//批评教育</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'inspection'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AQ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责令书面检查</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'criticism'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AR"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//通报批评</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'exhortation'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AS"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//诫勉</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'suspend'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AT"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//停职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'outOfWork'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AU"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//调离工作岗位</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'demote'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AV"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//降职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'nonLeadership'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AW"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//改任非领导职务</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'resign'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AX"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//责令辞职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'remove'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AY"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//免职</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'krtotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"AZ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'deductionAmount'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BA"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//扣减金额(万元)</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'zjtotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BB"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'noEntryTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BC"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//禁入时间(年)</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'zjltotal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BD"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//人次</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'warn'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BE"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//警告</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'impWarn'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BF"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//严重警告</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'revPosition'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BG"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//撤销党内职务</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'stayInspection'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BH"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//留党察看</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'expel'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BI"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开除党籍</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'judicial'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BJ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//移送国家监察机关或司法机关人次</span>                <span class="token comment" spellcheck="true">//整改落实</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'isOver'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getZhuanIs</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BK"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//是否完成</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'reason'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BL"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//未完成原因</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cLossPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BM"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cLossRiskPrice'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BN"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//损失风险（万元）</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'cwNum'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BO"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//个数</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'releaseTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BP"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//制度名称及出台时间</span>                <span class="token comment" spellcheck="true">//备注</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'note'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$objPHPExcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token string">"BQ"</span> <span class="token punctuation">.</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//备注</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'rid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'rid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'update_by'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'update_date'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'create_by'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'create_date'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'company_id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.company_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'duty_report_detail'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'导入成功'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="http://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="http://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="导入" scheme="http://chiwai.tang99.club/tags/%E5%AF%BC%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统上安装git</title>
    <link href="http://chiwai.tang99.club/posts/3327442321.html"/>
    <id>http://chiwai.tang99.club/posts/3327442321.html</id>
    <published>2020-02-16T04:51:37.000Z</published>
    <updated>2020-04-17T06:52:06.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;分为两种安装方式:1、yum安装，2、在GitHub下载最新的源码安装</p><h1 id="一、使用yum安装"><a href="#一、使用yum安装" class="headerlink" title="一、使用yum安装"></a>一、使用yum安装</h1><blockquote><p>使用yum安装的缺点是版本不好控制，安装的版本比较旧。</p></blockquote><pre class="line-numbers language-text"><code class="language-text">yum -y install git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144630.png" alt></p><p>输入 <b>git - -version</b>查看git安装的版本号<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144741.png" alt><br>这里由于我已经通过下载源码方式安装了最新的版本，正常使用yum安装完后版本不会这么高，例如下面图片是安装时显示的版本号。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144704.png" alt></p><p>作为了解，使用yum安装git的安装路径为<b>/usr/libexec/git-core</b>目录下。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144814.png" alt></p><p>到这里就已经安装完成。</p><h1 id="二、在GitHub上下载最新的源码进行安装。"><a href="#二、在GitHub上下载最新的源码进行安装。" class="headerlink" title="二、在GitHub上下载最新的源码进行安装。"></a>二、在GitHub上下载最新的源码进行安装。</h1><p>1.进入git在GitHub发布的版本页面<b><a href="https://github.com/git/git/releases" target="_blank" rel="noopener">https://github.com/git/git/releases</a></b>,在里面找到找到想要安装的版本，然后下载tar.gz包到本地。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144842.png" alt><br>2.使用FlashFXP工具将下载好的压缩包上传到Linux服务器的<b>/usr</b>目录下<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417144905.png" alt><br>3.解压压缩包</p><pre class="line-numbers language-text"><code class="language-text">tar -zxvf git-2.26.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.进入到解压后的文件夹</p><pre class="line-numbers language-text"><code class="language-text">cd git-2.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.拿到解压后的源码后需要进行编译，不过在此之前需要安装编译所需依赖。中途如出现提示时输入y，按回车。</p><pre class="line-numbers language-text"><code class="language-text">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>6.因为在安装所需要的依赖时，yum自动安装了git，这时需要先卸载这个旧版本git。</p><pre class="line-numbers language-text"><code class="language-text">yum -y remover git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>7.编译git源码</p><pre class="line-numbers language-text"><code class="language-text">make prefix=/usr/local/git all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>8.安装git到<b>/usr/local/git</b>路径</p><pre class="line-numbers language-text"><code class="language-text">make prefix=/usr/local/git install<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>9.配置环境变量</p><pre class="line-numbers language-text"><code class="language-text">vi /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在最后一行加上<b>(输入:wq 保存修改)<b></b></b></p><pre class="line-numbers language-text"><code class="language-text">export PATH=$PATH:/usr/local/git/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>10.刷新环境变量</p><pre class="line-numbers language-text"><code class="language-text">source /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>11.查看Git安装情况</p><pre class="line-numbers language-text"><code class="language-text">git --version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>至此，使用下载源码方式安装完成。</p><h1 id="三、git生成密钥"><a href="#三、git生成密钥" class="headerlink" title="三、git生成密钥"></a>三、git生成密钥</h1><p>1.查看是否有密钥文件,如果存在密钥，将密钥复制粘贴到git云上。</p><pre class="line-numbers language-text"><code class="language-text">ls -al ~/.ssh/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145026.png" alt></p><p>2.配置git</p><pre class="line-numbers language-text"><code class="language-text">git config --global user.name "名称"git config --global user.email "邮箱"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3.生成密钥</p><pre class="line-numbers language-text"><code class="language-text">ssh-keygen -C '邮箱' -t rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.查看文件位置</p><pre class="line-numbers language-text"><code class="language-text">find / -name id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.进入文件，复制密钥</p><pre class="line-numbers language-text"><code class="language-text">vi ~/.ssh/id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145053.png" alt><br>6.将内容复制到git云上，例如码云。<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145127.png" alt></p><h1 id="四、git拉取远程代码"><a href="#四、git拉取远程代码" class="headerlink" title="四、git拉取远程代码"></a>四、git拉取远程代码</h1><p>1.拉取远程代码</p><pre class="line-numbers language-text"><code class="language-text">git clone 这里填写要拉取项目的ssh链接<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.(进入到工程目录下)查看本地分支和远程分支</p><pre class="line-numbers language-text"><code class="language-text">cd tejiangit branch -al 查看本地和远程的所有分支<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417145155.png" alt></p><blockquote><p>master表示本地分支，前面*号表示正在使用的分支<br>  带有remotes的分支都是远程分支。</p></blockquote><p>3.将修改文件上传到本地</p><pre class="line-numbers language-text"><code class="language-text">git add abc.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.添加到本地分支上</p><pre class="line-numbers language-text"><code class="language-text">git commit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.上传到远端仓库</p><pre class="line-numbers language-text"><code class="language-text">git push<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参考资料:<br><a href="https://www.cnblogs.com/wulixia/p/11016684.html" target="_blank" rel="noopener">https://www.cnblogs.com/wulixia/p/11016684.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://chiwai.tang99.club/categories/Linux/"/>
    
    
      <category term="Git" scheme="http://chiwai.tang99.club/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>PHP基于phpqrcode类生成二维码</title>
    <link href="http://chiwai.tang99.club/posts/123876002.html"/>
    <id>http://chiwai.tang99.club/posts/123876002.html</id>
    <published>2020-01-31T06:06:29.000Z</published>
    <updated>2020-01-31T12:40:06.606Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="phpqrcode下载地址"><a href="#phpqrcode下载地址" class="headerlink" title="phpqrcode下载地址"></a>phpqrcode下载地址</h1><blockquote><p>地址：<a href="http://phpqrcode.sourceforge.net/" target="_blank" rel="noopener">http://phpqrcode.sourceforge.net/</a><br>下载：<a href="http://sourceforge.net/projects/phpqrcode/" target="_blank" rel="noopener">http://sourceforge.net/projects/phpqrcode/</a></p></blockquote><p>&emsp;&emsp;下载官网提供的类库后，只需要使用<span style="color:red;font-weight:bold;">phpqrcode.php</span>就可以生成二维码了，当然您的PHP环境必须开启支持GD2。它是一个多个类的集合文件，我们需要用到里边的<span style="color:red;font-weight:bold;">QRcode类的png()</span>方法;</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token variable">$outfile</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$level</span> <span class="token operator">=</span> <span class="token constant">QR_ECLEVEL_L</span><span class="token punctuation">,</span> <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token variable">$margin</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token variable">$saveandprint</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$enc</span> <span class="token operator">=</span> QRencode<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token punctuation">,</span> <span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token variable">$margin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$enc</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encodePNG</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token variable">$outfile</span><span class="token punctuation">,</span> <span class="token variable">$saveandprint</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><blockquote><p><span style="color:red;font-weight:bold;">$text</span>表示生成二位的的信息文本<br> <span style="color:red;font-weight:bold;">$outfile</span>表示是否输出二维码图片文件，默认否<br> <span style="color:red;font-weight:bold;">$level</span>表示容错率，也就是有被覆盖的区域还能识别，分别:L（QR_ECLEVEL_L，7%），M（QR_ECLEVEL_M，15%），Q（QR_ECLEVEL_Q，25%），H（QR_ECLEVEL_H，30%）<br> <span style="color:red;font-weight:bold;">$size</span>表示生成图片大小，默认是3<br> <span style="color:red;font-weight:bold;">$margin</span>表示二维码周围边框空白区域间距值<br> <span style="color:red;font-weight:bold;">$saveandprint</span>表示是否保存二维码并显示</p></blockquote><h1 id="调用-PHP-QRcode类"><a href="#调用-PHP-QRcode类" class="headerlink" title="调用 PHP QRcode类"></a>调用 PHP QRcode类</h1><pre class="line-numbers language-php"><code class="language-php">Loader<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'phpqrcode.phpqrcode'</span><span class="token punctuation">,</span><span class="token constant">EXTEND_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例:"></a>使用示例:</h1><h2 id="生成带有LOGO的二维码"><a href="#生成带有LOGO的二维码" class="headerlink" title="生成带有LOGO的二维码"></a>生成带有LOGO的二维码</h2><p>&emsp;&emsp;其实原理很简单，先使用QRcode类生成一张二维码图片，然后再利用php的image相关函数，将事先准备好的logo图片加入到刚生成的原始二维码图片中间，然后重新生成一张新的二维码图片。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//二维码内容</span>        <span class="token variable">$value</span> <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//chiwai.tang99.club';</span>        <span class="token variable">$errorCorrectionLevel</span> <span class="token operator">=</span> <span class="token string">'L'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//容错级别</span>        <span class="token variable">$matrixPointSize</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//生成图片大小</span>        <span class="token comment" spellcheck="true">//生成二维码图片</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./qrcode/'</span><span class="token punctuation">.</span><span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.png'</span><span class="token punctuation">;</span>        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'./qrcode'</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断是否存在上传到的目录</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        \<span class="token package">QRcode</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$errorCorrectionLevel</span><span class="token punctuation">,</span> <span class="token variable">$matrixPointSize</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//准备好的logo图片</span>        <span class="token variable">$logo</span> <span class="token operator">=</span> <span class="token string">'./static/logo1.png'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$logo</span> <span class="token operator">!==</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$QR</span> <span class="token operator">=</span> <span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$logo</span> <span class="token operator">=</span> <span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//二维码图片宽度</span>            <span class="token variable">$QR_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//二维码图片高度</span>            <span class="token variable">$QR_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//logo图片宽度</span>            <span class="token variable">$logo_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//logo图片高度</span>            <span class="token variable">$logo_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$logo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$logo_qr_width</span> <span class="token operator">=</span> <span class="token variable">$QR_width</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">;</span>            <span class="token variable">$scale</span> <span class="token operator">=</span> <span class="token variable">$logo_width</span><span class="token operator">/</span><span class="token variable">$logo_qr_width</span><span class="token punctuation">;</span>            <span class="token variable">$logo_qr_height</span> <span class="token operator">=</span> <span class="token variable">$logo_height</span><span class="token operator">/</span><span class="token variable">$scale</span><span class="token punctuation">;</span>            <span class="token variable">$from_width</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$QR_width</span> <span class="token operator">-</span> <span class="token variable">$logo_qr_width</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//重新组合图片并调整大小</span>            <span class="token function">imagecopyresampled</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span> <span class="token variable">$logo</span><span class="token punctuation">,</span> <span class="token variable">$from_width</span><span class="token punctuation">,</span> <span class="token variable">$from_width</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$logo_qr_width</span><span class="token punctuation">,</span> <span class="token variable">$logo_qr_height</span><span class="token punctuation">,</span> <span class="token variable">$logo_width</span><span class="token punctuation">,</span> <span class="token variable">$logo_height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//输出图片</span>        <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">'&lt;img src="'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span> <span class="token punctuation">.</span> <span class="token string">'">'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成二维码直接输出"><a href="#生成二维码直接输出" class="headerlink" title="生成二维码直接输出"></a>生成二维码直接输出</h2><blockquote><p>直接输出二维码只需要将参数二改为false。写die()是因为防止乱码</p></blockquote><pre class="line-numbers language-php"><code class="language-php">        <span class="token variable">$value</span><span class="token operator">=</span>"https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//chiwai.tang99.club";</span>        <span class="token variable">$errorCorrectionLevel</span><span class="token operator">=</span><span class="token string">"L"</span><span class="token punctuation">;</span>        <span class="token variable">$matrixPointSize</span><span class="token operator">=</span><span class="token string">"4"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//生成图片大小 ：1到10</span>        \<span class="token package">QRcode</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">png</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token variable">$errorCorrectionLevel</span><span class="token punctuation">,</span><span class="token variable">$matrixPointSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="更改二维码的颜色"><a href="#更改二维码的颜色" class="headerlink" title="更改二维码的颜色"></a>更改二维码的颜色</h2><blockquote><p>$QR表示生成的二维码</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$indexColor</span> <span class="token operator">=</span> <span class="token function">imagecolorexact</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">imagecolorset</span><span class="token punctuation">(</span><span class="token variable">$QR</span><span class="token punctuation">,</span><span class="token variable">$indexColor</span><span class="token punctuation">,</span><span class="token number">148</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">211</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>参考资料:<br> <a href="http://phpqrcode.sourceforge.net/examples/index.php" target="_blank" rel="noopener">http://phpqrcode.sourceforge.net/examples/index.php</a><br> <a href="https://www.php.cn/php-weizijiaocheng-402924.html" target="_blank" rel="noopener">https://www.php.cn/php-weizijiaocheng-402924.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="http://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="http://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="二维码" scheme="http://chiwai.tang99.club/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Vue简单功能汇总</title>
    <link href="http://chiwai.tang99.club/posts/2780046153.html"/>
    <id>http://chiwai.tang99.club/posts/2780046153.html</id>
    <published>2020-01-30T08:40:05.000Z</published>
    <updated>2020-04-17T04:52:49.818Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="下拉刷新-加载分页"><a href="#下拉刷新-加载分页" class="headerlink" title="下拉刷新 加载分页"></a>下拉刷新 加载分页</h1><blockquote><p>引入两个文件<br>flush.js<br>PullUpReload.js</p></blockquote><h2 id="flush-js"><a href="#flush-js" class="headerlink" title="flush.js"></a>flush.js</h2><pre class="line-numbers language-html"><code class="language-html">Vue.component("flush", {    template: `<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>refresh-moudle<span class="token punctuation">"</span></span> <span class="token attr-name">@touchstart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchStart($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchmove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchMove($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchend</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchEnd($event)<span class="token punctuation">"</span></span> <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token string">'translate3d(0,'</span> + top + <span class="token string">'px, 0)'</span><span class="token punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pull-refresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pull-refresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>down-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropDownState<span class="token punctuation">=</span><span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;img v-if="dropDownInfo.downImg" class="down-img" :src="require('../../assets/images/refreshAndReload/'+dropDownInfo.downImg)">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>down-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{dropDownInfo.downText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>up-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropDownState<span class="token punctuation">=</span><span class="token punctuation">=</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;img v-if="dropDownInfo.upImg" class="up-img" :src="require('../../assets/images/refreshAndReload/'+dropDownInfo.upImg)">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>up-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{dropDownInfo.upText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>refresh-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropDownState<span class="token punctuation">=</span><span class="token punctuation">=</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;img v-if="dropDownInfo.refreshImg" class="refresh-img" :src="require('../../assets/images/loading/'+dropDownInfo.refreshImg)">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>refresh-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{dropDownInfo.refreshText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>`,    props: {        onRefresh: {            type: Function,            required: false        }    },    data() {        return {            defaultOffset: 50, // 默认高度, 相应的修改.releshMoudle的margin-top和.down-tip, .up-tip, .refresh-tip的height            top: 0,            scrollIsToTop: 0,            startY: 0,            isDropDown: false, // 是否下拉            isRefreshing: false, // 是否正在刷新            dropDownState: 1, // 显示1:下拉可以刷新, 2:松开立即刷新, 3:正在刷新数据中...            dropDownInfo: {                downText: '',                downImg: 'arrow.png',                upText: '松开立即刷新',                upImg: 'arrow.png',                refreshText: '正在刷新数据...',                refreshImg: 'loading.png'            }        }    },    created() {        if (document.querySelector('.down-tip')) {            // 获取不同手机的物理像素（dpr）,以便适配rem            this.defaultOffset = document.querySelector('.down-tip').clientHeight || this.defaultOffset        }    },    methods: {        /**         * 触摸开始，手指点击屏幕时         * @param {object} e Touch 对象包含的属性            */        touchStart(e) {            this.startY = e.targetTouches[0].pageY            // console.log(666);        },        /**         * 接触点改变，滑动时         * @param {object} e Touch 对象包含的属性         */        touchMove(e) {            this.scrollIsToTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop // safari 获取scrollTop用window.pageYOffset            if (e.targetTouches[0].pageY > this.startY) {                // 下拉                this.isDropDown = true                if (this.scrollIsToTop === 0 &amp;&amp; !this.isRefreshing) {                    // 拉动的距离                    let diff = e.targetTouches[0].pageY - this.startY - this.scrollIsToTop                    this.top = Math.pow(diff, 0.8) + (this.dropDownState === 3 ? this.defaultOffset : 0)                    if (this.top >= this.defaultOffset) {                        this.dropDownState = 2                        e.preventDefault()                    } else {                        this.dropDownState = 1                        // 去掉会导致ios无法刷新                        e.preventDefault()                    }                }            } else {                this.isDropDown = false                this.dropDownState = 1            }        },        /**         * 触摸结束，手指离开屏幕时         * @param {object} e Touch 对象包含的属性         */        touchEnd(e) {            if (this.isDropDown &amp;&amp; !this.isRefreshing) {                if (this.top >= this.defaultOffset) {                    // do refresh                    this.refresh()                    this.isRefreshing = true                } else {                    // cancel refresh                    this.isRefreshing = false                    this.isDropDown = false                    this.dropDownState = 1                    this.top = 0                }            }        },        /**         * 刷新         */        refresh() {            this.dropDownState = 3            this.top = this.defaultOffset            // 这是全是静态数据,延时1200毫秒，给用户一个刷新的感觉，如果是接口数据的话，直接调接口即可            // setTimeout(() => {                this.onRefresh(this.refreshDone)            // }, 1200)        },        /**         * 刷新完成         */        refreshDone() {            this.isRefreshing = false            this.isDropDown = false            this.dropDownState = 1            this.top = 0        }    }});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PullUpReload-js"><a href="#PullUpReload-js" class="headerlink" title="PullUpReload.js"></a>PullUpReload.js</h2><pre class="line-numbers language-html"><code class="language-html">Vue.component('pull',{    template:`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>load-moudle<span class="token punctuation">"</span></span> <span class="token attr-name">@touchstart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchStart($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchmove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchMove($event)<span class="token punctuation">"</span></span> <span class="token attr-name">@touchend</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>touchend($event)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>load-more<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;slot name="load-more">--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>more-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pullUpState<span class="token punctuation">=</span><span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>more-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{pullUpInfo.moreText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-tip<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pullUpState<span class="token punctuation">=</span><span class="token punctuation">=</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-icon<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{pullUpInfo.loadingText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- &lt;div class="no-more-tip" v-if="pullUpState==3">    &lt;span class="connecting-line">&lt;/span>    &lt;span class="no-more-text">{{pullUpInfo.noMoreText}}&lt;/span>&lt;span class="connecting-line">&lt;/span>    &lt;/div>--></span><span class="token comment" spellcheck="true">&lt;!--    &lt;/slot>--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>`,    props: {        parentPullUpState: {            default: 0        },        onInfiniteLoad: {            type: Function,            require: false        }    },    data () {        return {            top: 0,            pullUpState: 0, // 1:上拉加载更多, 2:加载中……, 3:我是有底线的            isLoading: false, // 是否正在加载            pullUpInfo: {                moreText: '上拉加载更多',                loadingText: '数据加载中...',                noMoreText: '我是有底线的'            },            startX: 0,            startY: 0,            endX: 0,            endY: 0        }    },    methods: {        /**         * 触摸开始，手指点击屏幕时         * @param {object} e Touch 对象包含的属性         */        touchStart (e) {            this.startX = e.touches[0].pageX            this.startY = e.touches[0].pageY        },        /**         * 接触点改变，滑动时         * @param {object} e Touch 对象包含的属性         */        touchMove (e) {            this.endX = e.changedTouches[0].pageX            this.endY = e.changedTouches[0].pageY            let direction = this.getSlideDirection(this.startX, this.startY, this.endX, this.endY)            switch (direction) {                case 0:                    // console.log('没滑动')                    break                case 1:                    // console.log('向上')                    this.scrollToTheEnd()                    break                case 2:                    // console.log('向下')                    break                case 3:                    // console.log('向左')                    break                case 4:                    // console.log('向右')                    break                default:            }        },        /**         * 触摸结束，手指离开屏幕时         * @param {object} e Touch 对象包含的属性         */        touchend (e) {            this.isLoading = false        },        /**         * 判断滚动条是否到底         */        scrollToTheEnd () {            let innerHeight = document.querySelector('.load-moudle').clientHeight            // 变量scrollTop是滚动条滚动时，距离顶部的距离            let scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop            // 变量scrollHeight是滚动条的总高度            let scrollHeight = document.documentElement.clientHeight || document.body.scrollHeight            // 滚动条到底部的条件            if (scrollTop + scrollHeight >= innerHeight) {                if (this.pullUpState !== 3 &amp;&amp; !this.isLoading) {                    this.infiniteLoad()                }                // console.log('距顶部' + scrollTop + '滚动条总高度' + scrollHeight + '内容高度' + innerHeight)            }        },        /**         * 上拉加载数据         */        infiniteLoad () {            if (this.pullUpState !== 0) {                this.pullUpState = 2                this.isLoading = true                this.onInfiniteLoad(this.infiniteLoadDone)            }        },        /**         * 加载数据完成         */        infiniteLoadDone () {            this.pullUpState = 1        },        /**         * 返回角度         */        getSlideAngle (dx, dy) {            return Math.atan2(dy, dx) * 180 / Math.PI        },        /**         * 根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动         * @param {number} startX X轴开始位置         * @param {number} startY X轴结束位置         * @param {number} endX Y轴开始位置         * @param {number} endY Y轴结束位置         */        getSlideDirection (startX, startY, endX, endY) {            let dy = startY - endY            let dx = endX - startX            let result = 0            // 如果滑动距离太短            if (Math.abs(dx) &lt; 2 &amp;&amp; Math.abs(dy) &lt; 2) {                return result            }            let angle = this.getSlideAngle(dx, dy)            if (angle >= -45 &amp;&amp; angle &lt; 45) {                result = 4            } else if (angle >= 45 &amp;&amp; angle &lt; 135) {                result = 1            } else if (angle >= -135 &amp;&amp; angle &lt; -45) {                result = 2            } else if ((angle >= 135 &amp;&amp; angle &lt;= 180) || (angle >= -180 &amp;&amp; angle &lt; -135)) {                result = 3            }            return result        }    },    watch: {        parentPullUpState (curVal, oldVal) {            this.pullUpState = curVal        }    }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><blockquote><p>将需要滑动的地方套上以下闭合代码</p></blockquote><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flush</span> <span class="token attr-name">:on-refresh</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onRefresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pull</span> <span class="token attr-name">:on-infinite-load</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onInfiniteLoad<span class="token punctuation">"</span></span> <span class="token attr-name">:parent-pull-up-state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>infiniteLoadData.pullUpState<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pull</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flush</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>例如、</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>new-list<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">padding-top</span><span class="token punctuation">:</span><span class="token number">40</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flush</span> <span class="token attr-name">:on-refresh</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onRefresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pull</span> <span class="token attr-name">:on-infinite-load</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onInfiniteLoad<span class="token punctuation">"</span></span> <span class="token attr-name">:parent-pull-up-state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>infiniteLoadData.pullUpState<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          &lt;div class="a-list" v-for="item in pic":key="item.index" @click="getPic(item)">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-span<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-tit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.created_at}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-list-img<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.thumbnail<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>无法加载<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pull</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flush</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>然后写入vue.js中写入如下</p></blockquote><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                show<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                activeIndex1<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                pic<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                showList<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                active<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                activeIndex<span class="token punctuation">:</span> <span class="token string">'j'</span><span class="token punctuation">,</span>                townIndex<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                villageIndex<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>                area<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// id:370321001,</span>                    <span class="token comment" spellcheck="true">// name:"索镇",</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                areaList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                villageList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                isShowVillage<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//镇</span>                zhen<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//村</span>                cun<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                infiniteLoadData<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    initialShowNum<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 初始显示多少条</span>                    everyLoadingNum<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 每次加载的个数</span>                    pullUpState<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 子组件的pullUpState状态</span>                    pullUpList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 上拉加载更多数据的数组</span>                    showPullUpListLength<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>initialShowNum <span class="token comment" spellcheck="true">// 上拉加载后所展示的个数</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                search<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                    limit<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>                    total<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    none<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                    area<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        mounted<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token function">onRefresh</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 如果下拉刷新和上拉加载同时使用，下拉时初始化上拉的数据</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reflush</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">onInfiniteLoad</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">reflush</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//刷新数据  下拉刷新</span>                <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>pic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>none <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//有下一页</span>                that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//有下一页</span>                that<span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">//发送数据请求方法</span>            <span class="token function">http</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                <span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token string">'/Wenming/lists'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    town<span class="token punctuation">:</span> that<span class="token punctuation">.</span>zhen<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                    villagei<span class="token punctuation">:</span> that<span class="token punctuation">.</span>cun<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                    page<span class="token punctuation">:</span> that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>page<span class="token punctuation">,</span>                    limit<span class="token punctuation">:</span> that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>limit<span class="token punctuation">,</span>                    activeIndex<span class="token punctuation">:</span> that<span class="token punctuation">.</span>activeIndex<span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>none<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>pic <span class="token operator">=</span> that<span class="token punctuation">.</span>pic<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>pic<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>page<span class="token operator">++</span><span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>total <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//还可以加载</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>search<span class="token punctuation">.</span>none <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>infiniteLoadData<span class="token punctuation">.</span>pullUpState <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//没有数据了</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> done <span class="token operator">==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> done <span class="token operator">==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">getActive</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">==</span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//切换选项卡时重新回到顶部</span>                window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//重新刷新</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reflush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">cities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                <span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token string">'/Wenming/zhen'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        that<span class="token punctuation">.</span>areaList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>                        that<span class="token punctuation">.</span>area <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        that<span class="token punctuation">.</span><span class="token function">reflush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>errcode<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">'code '</span> <span class="token operator">+</span> errcode <span class="token operator">+</span> <span class="token string">' ,meaasge '</span> <span class="token operator">+</span> errmsg<span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">black</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShowVillage<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>x <span class="token operator">></span> <span class="token number">261</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>x <span class="token operator">></span> <span class="token number">132</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="在滑动加载分页数据时遇到的问题！"><a href="#在滑动加载分页数据时遇到的问题！" class="headerlink" title="在滑动加载分页数据时遇到的问题！"></a>在滑动加载分页数据时遇到的问题！</h2><blockquote><p>&emsp;&emsp;默认情况下，向上滑动加载分页的承载体默认会找到body元素。但是由于我们的页面书写方式变化多样，会导致承载体发生改变，会出现滑动时滚动载体触发无效果！</p></blockquote><p>解决方式如下:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417122959.png" alt></p><blockquote><p>以div class=”main_content”为载体，创建一个id=”main_content”,名字可以随便取<span style="color:red;">(创建id的原因是不影响其它地方使用)</span></p></blockquote><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417125243.png" alt></p><blockquote><p>增加getid=”main_content”，getid名字任意，是为了要向组件传递main_content这个信息，要以这个为载体。</p></blockquote><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417125222.png" alt></p><blockquote><p>在pullupreload.js这个文件内接收创建的getid信息。这里的require参数的意思是不是必须的</p></blockquote><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417123223.png" alt></p><blockquote><p>加了个if判断，如果body不存在，使用默认的方法，否则使用我们自定义的元素为载体</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="http://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Vue" scheme="http://chiwai.tang99.club/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Js+Jquery简单功能汇总</title>
    <link href="http://chiwai.tang99.club/posts/1554494174.html"/>
    <id>http://chiwai.tang99.club/posts/1554494174.html</id>
    <published>2020-01-29T06:43:11.000Z</published>
    <updated>2020-01-29T07:30:26.975Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jq实现动态删除元素后，重新排列序号"><a href="#Jq实现动态删除元素后，重新排列序号" class="headerlink" title="Jq实现动态删除元素后，重新排列序号"></a>Jq实现动态删除元素后，重新排列序号</h1><pre class="line-numbers language-javascript"><code class="language-javascript">option_select_id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">".model-select-group-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">" .model-select-group"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">rank1</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> that<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>option_val_id<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                newoption_val_id <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">".model-radio-group-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">".model-radio-group"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.options'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"选项"</span><span class="token operator">+</span>newoption_val_id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这里的that 代表动态添加或者删除时传进来的$(this)</p></blockquote><h1 id="Jq实现城市三级联动"><a href="#Jq实现城市三级联动" class="headerlink" title="Jq实现城市三级联动"></a>Jq实现城市三级联动</h1><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//省</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=country]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getProvince')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择省/直辖市--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=province]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择市--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">!=</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//市</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=province]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getRetion')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'province'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择市--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=city]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;option value='</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">'>市辖区&lt;/option>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//县</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span><span class="token string">'select[name=city]'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> load <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:U('Index/getRetion')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>id<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'city'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;option value="">--请选择区（县）--&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    html <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;option value="'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'">'</span><span class="token operator">+</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'simple_cn'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/option>'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=county]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="前端" scheme="http://chiwai.tang99.club/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Javascript" scheme="http://chiwai.tang99.club/tags/Javascript/"/>
    
      <category term="Jquery" scheme="http://chiwai.tang99.club/tags/Jquery/"/>
    
  </entry>
  
  <entry>
    <title>PHP简单功能汇总</title>
    <link href="http://chiwai.tang99.club/posts/346954664.html"/>
    <id>http://chiwai.tang99.club/posts/346954664.html</id>
    <published>2020-01-26T04:47:05.000Z</published>
    <updated>2020-04-17T05:33:07.760Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>简单做个记录，初学者，也算是记录成长的过程！</p></blockquote><h1 id="TP5-图片上传"><a href="#TP5-图片上传" class="headerlink" title="TP5 图片上传"></a>TP5 图片上传</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">files</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token string">'请上传头像'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'/mobile/header'</span><span class="token punctuation">;</span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$imgpath</span> <span class="token operator">=</span> <span class="token variable">$path</span> <span class="token punctuation">.</span><span class="token string">'/'</span> <span class="token punctuation">.</span><span class="token variable">$url</span><span class="token punctuation">;</span>            <span class="token variable">$re</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string">'image'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$imgpath</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$title</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$imgpath</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'上传成功'</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$imgpath</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$imgpath</span><span class="token punctuation">;</span>                <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$imgpath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'系统繁忙'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$err</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token variable">$err</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="/download/file_upload.php" ">点击下载</a></p><h1 id="layui-TP5多文件上传"><a href="#layui-TP5多文件上传" class="headerlink" title="layui + TP5多文件上传"></a>layui + TP5多文件上传</h1><h2 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h2><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bg-header-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header-main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>innerList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inner<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>baojian<span class="token punctuation">"</span></span> <span class="token attr-name">cellpadding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table30<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jvform<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{:url(<span class="token punctuation">'</span>updo<span class="token punctuation">'</span>)}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slmark<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slmark<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!--一上传附件--></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>equ_id[]<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chuan<span class="token punctuation">"</span></span> <span class="token attr-name">rowspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">rowspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>opp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zz<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn layui-btn-normal testList<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>选择多文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-upload-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-table<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>文件名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>大小<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>状态<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demoList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn testListAction<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>开始上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span>right<span class="token punctuation">;</span><span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span><span class="token hexcode">#FF3030</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layui-btn clo<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./static/layui/layui.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery            <span class="token punctuation">,</span>upload <span class="token operator">=</span> layui<span class="token punctuation">.</span>upload<span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".testList"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> demoListView <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.layui-upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demoList'</span><span class="token punctuation">)</span>                <span class="token punctuation">,</span>uploadListIns <span class="token operator">=</span> upload<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                elem<span class="token punctuation">:</span> <span class="token keyword">this</span>                <span class="token punctuation">,</span>url<span class="token punctuation">:</span> <span class="token string">"index.php/index/index/affix"</span>                <span class="token punctuation">,</span>accept<span class="token punctuation">:</span> <span class="token string">'file'</span>                <span class="token punctuation">,</span>multiple<span class="token punctuation">:</span> <span class="token boolean">true</span>                <span class="token punctuation">,</span>auto<span class="token punctuation">:</span> <span class="token boolean">false</span>                <span class="token punctuation">,</span>bindAction<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.layui-upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.testListAction'</span><span class="token punctuation">)</span>                <span class="token punctuation">,</span>choose<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> files <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">pushFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将每次选择的文件追加到文件队列</span>                    <span class="token comment" spellcheck="true">//读取本地文件</span>                    obj<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> file<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">var</span> tr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'&lt;tr id="upload-'</span><span class="token operator">+</span> index <span class="token operator">+</span><span class="token string">'">'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span><span class="token operator">+</span> file<span class="token punctuation">.</span>name <span class="token operator">+</span><span class="token string">'&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span><span class="token operator">+</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>size<span class="token operator">/</span><span class="token number">1014</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'kb&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>等待上传&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;button class="layui-btn layui-btn-xs demo-reload layui-hide">重传&lt;/button>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除&lt;/button>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;/td>'</span>                            <span class="token punctuation">,</span><span class="token string">'&lt;/tr>'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//单个重传</span>                        tr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            obj<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//删除</span>                        tr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-delete'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">delete</span> files<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除对应的文件</span>                            tr<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            uploadListIns<span class="token punctuation">.</span>config<span class="token punctuation">.</span>elem<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//清空 input file 值，以免删除后出现同名文件不可选</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        demoListView<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">,</span>done<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//上传成功</span>                        <span class="token keyword">var</span> htm <span class="token operator">=</span><span class="token string">'&lt;input name="affix[title][]" type="hidden" value="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">'" />'</span><span class="token punctuation">;</span>                        htm <span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;input name="affix[url][]" type="hidden" value="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'" />'</span><span class="token punctuation">;</span>                        html <span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;a href="'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'" target="_blank">'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>message<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">' &lt;/a>&lt;br/>'</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".chuan"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jvform"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>htm<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> tr <span class="token operator">=</span> demoListView<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'tr#upload-'</span><span class="token operator">+</span> index<span class="token punctuation">)</span>                            <span class="token punctuation">,</span>tds <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;span style="color: #5FB878;">上传成功&lt;/span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//清空操作</span>                        <span class="token keyword">return</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除文件队列已经上传成功的文件</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">,</span>error<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> upload<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> tr <span class="token operator">=</span> demoListView<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'tr#upload-'</span><span class="token operator">+</span> index<span class="token punctuation">)</span>                        <span class="token punctuation">,</span>tds <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;span style="color: #FF5722;">上传失败&lt;/span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    tds<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.demo-reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'layui-hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//显示重传</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP部分"><a href="#PHP部分" class="headerlink" title="PHP部分"></a>PHP部分</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">affix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"请上传图片"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$title</span><span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$path</span><span class="token operator">=</span> <span class="token string">'/mobile/upload/'</span><span class="token punctuation">;</span>            <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$dat</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$title</span><span class="token punctuation">;</span>                <span class="token variable">$dat</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$path</span><span class="token punctuation">.</span><span class="token variable">$url</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$dat</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$da</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token variable">$da</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$da</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>提交入库</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'affix'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'equ_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'equ_id'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filepath'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'affix'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span>            <span class="token variable">$buu</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'createtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$jj</span> <span class="token operator">=</span> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tj_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$jj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"提交成功"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$nn</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"异常稍后再试"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$nn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="layui-TP5-分页"><a href="#layui-TP5-分页" class="headerlink" title="layui + TP5 分页"></a>layui + TP5 分页</h1><h2 id="前端部分-1"><a href="#前端部分-1" class="headerlink" title="前端部分"></a>前端部分</h2><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list lch hideone<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#cccccc</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>two<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>2019-06-29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>产后随访表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>__SUIFANG__/images/shouye/tb_12.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>details2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    {notempty name="$v.chanhou"}        {volist name="$v.chanhou" id="chanhou_v"}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#cccccc</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>two<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{$chanhou_v.time | date="Y-m-d"}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>产后随访表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhou_v.btn_kkid}<span class="token punctuation">"</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9<span class="token punctuation">"</span></span> <span class="token attr-name">del-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhou_v.id}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;img src="__SUIFANG__/images/shouye/tb_12.png" alt=""style="margin-right: 30px;"   class="details2">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>__SUIFANG__/images/shouye/dlete_03.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deletech<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        {/volist}    {/notempty}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--分页--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hideonech<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">data-page</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{$chanhoucount}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token comment" spellcheck="true">//分页</span>    layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'laypage'</span><span class="token punctuation">,</span> <span class="token string">'layer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> laypage <span class="token operator">=</span> layui<span class="token punctuation">.</span>laypage<span class="token punctuation">,</span>            layer <span class="token operator">=</span> layui<span class="token punctuation">.</span>layer<span class="token punctuation">;</span>        laypage<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            elem<span class="token punctuation">:</span> <span class="token string">'demo0'</span><span class="token punctuation">,</span>            limit<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>            count<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#demo0'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//数据总数,</span>            jump<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>first<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//首次不执行</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>first<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">var</span> parent_id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.parent_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"{:url('/index/pages')}"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token punctuation">:</span>res<span class="token punctuation">.</span>curr<span class="token punctuation">,</span>limit<span class="token punctuation">:</span>res<span class="token punctuation">.</span>limit<span class="token punctuation">,</span>parent_id<span class="token punctuation">:</span>parent_id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'li:first'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token string">"&lt;li style=\"border-top: 1px solid #cccccc;\">"</span> <span class="token operator">+</span> li <span class="token operator">+</span> <span class="token string">"&lt;/li>"</span><span class="token punctuation">;</span>                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>                        $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token keyword">var</span> html <span class="token operator">=</span>  <span class="token string">'&lt;li style="border-top: 1px solid #cccccc;">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;div class="two">&lt;i class="circle">&lt;/i>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;p>'</span><span class="token operator">+</span> v<span class="token punctuation">.</span>time <span class="token operator">+</span><span class="token string">'&lt;/p>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;p>产后随访表&lt;/p>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;div data-id="'</span><span class="token operator">+</span>v<span class="token punctuation">.</span>btn_kkid<span class="token operator">+</span><span class="token string">'" data-type="9" del-id="'</span><span class="token operator">+</span> v<span class="token punctuation">.</span>id <span class="token operator">+</span><span class="token string">'">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;img src="__SUIFANG__/images/shouye/tb_12.png" alt=""style="margin-right: 30px;"   class="details2">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;img src="__SUIFANG__/images/shouye/dlete_03.png" alt="" class="deletech">'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span>                            <span class="token string">'&lt;/li>'</span><span class="token punctuation">;</span>                            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP部分-1"><a href="#PHP部分-1" class="headerlink" title="PHP部分"></a>PHP部分</h2><pre class="line-numbers language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$Chanhou_module</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chanhou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$chanhou</span> <span class="token operator">=</span> <span class="token variable">$Chanhou_module</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$chanhou</span> <span class="token operator">=</span> <span class="token variable">$chanhou</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'data'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$chanhou</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP5-1中间件定义使用"><a href="#TP5-1中间件定义使用" class="headerlink" title="TP5.1中间件定义使用"></a>TP5.1中间件定义使用</h1><blockquote><p>有时间可以看看手册，还是很完整的。</p></blockquote><h2 id="在配置文件中定义"><a href="#在配置文件中定义" class="headerlink" title="在配置文件中定义"></a>在配置文件中定义</h2><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417132914.png" alt><br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417133200.png" alt></p><h2 id="在对应的中间件中写功能"><a href="#在对应的中间件中写功能" class="headerlink" title="在对应的中间件中写功能"></a>在对应的中间件中写功能</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>middleware</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">CheckIndexAuth</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> \<span class="token package">Closure</span> <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user_index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取当前登录信息</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span> <span class="token operator">||</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user_index_sign'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//验证是否登录</span><span class="token comment" spellcheck="true">//            alert_error('登录后查看', url('/login'));</span>            <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="配合路由使用"><a href="#配合路由使用" class="headerlink" title="配合路由使用"></a>配合路由使用</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 后台管理路由 * 免权限验证路由 */</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'login$'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/Login/login'</span><span class="token punctuation">,</span>                                         <span class="token comment" spellcheck="true">//登录</span>    <span class="token string">'editPassword'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/User/editPassword'</span><span class="token punctuation">,</span>                             <span class="token comment" spellcheck="true">//重置密码</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 需要权限验证路由 */</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'index$'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'admin/Index/index'</span><span class="token punctuation">,</span>                                           <span class="token comment" spellcheck="true">//首页</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token string">'CheckAuth'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//使用中间件验证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="TP5多数据库配置及使用-sqlsrv"><a href="#TP5多数据库配置及使用-sqlsrv" class="headerlink" title="TP5多数据库配置及使用(sqlsrv)"></a>TP5多数据库配置及使用(sqlsrv)</h1><h2 id="在config-php文件中配置"><a href="#在config-php文件中配置" class="headerlink" title="在config.php文件中配置"></a>在config.php文件中配置</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token punctuation">[</span>    db1' <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>            <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'sqlsrv'</span><span class="token punctuation">,</span>            <span class="token string">'hostname'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'60.60.60.60,8090'</span><span class="token punctuation">,</span>            <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'数据库名'</span><span class="token punctuation">,</span>            <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'密码'</span><span class="token punctuation">,</span>            <span class="token string">'hostport'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'1433'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'db2'</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>            <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'sqlsrv'</span><span class="token punctuation">,</span>            <span class="token string">'hostname'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'61.61.61.60,8090'</span><span class="token punctuation">,</span>            <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'数据库名'</span><span class="token punctuation">,</span>            <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'密码'</span><span class="token punctuation">,</span>            <span class="token string">'hostport'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'1433'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><pre class="line-numbers language-php"><code class="language-php"> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tbs_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'db2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'tbs_upload'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertAll</span><span class="token punctuation">(</span><span class="token variable">$buu</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="从身份证号-残疾证号获取-年龄-生日"><a href="#从身份证号-残疾证号获取-年龄-生日" class="headerlink" title="从身份证号/残疾证号获取(年龄/生日)"></a>从身份证号/残疾证号获取(年龄/生日)</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 从身份证号/残疾证号获取(年龄/生日) * @param $Idcard 身份证号 * @param bool $b true为生日 false为年龄 * @return bool|int|string */</span><span class="token keyword">function</span> <span class="token function">getAgeFromIdcard</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$birthday</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$birthday</span><span class="token punctuation">;</span>    <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$birthday</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$age</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="从身份证号获取性别"><a href="#从身份证号获取性别" class="headerlink" title="从身份证号获取性别"></a>从身份证号获取性别</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 从身份证号获取性别 * @param $Idcard 身份证号 * @return bool|int 1男 2女 */</span><span class="token keyword">function</span> <span class="token function">getSexFromIdcard</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">18</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$Idcard</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="返回一个随机字符串"><a href="#返回一个随机字符串" class="headerlink" title="返回一个随机字符串"></a>返回一个随机字符串</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 返回一个随机字符串 * @param $type 支持 number 数字 string 字符串 mix 混合 默认混合 * @param $size 设置字段长度 默认32 * @return string */</span><span class="token keyword">function</span> <span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token string">'mix'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'number'</span><span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'string'</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'mix'</span><span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">default</span> <span class="token punctuation">:</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token variable">$size</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$num</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="获取处理后的时间"><a href="#获取处理后的时间" class="headerlink" title="获取处理后的时间"></a>获取处理后的时间</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">time2string</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$day</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整天之后剩余的时间</span>    <span class="token variable">$hour</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token number">3600</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整小时之后剩余的时间</span>    <span class="token variable">$minute</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token variable">$second</span><span class="token operator">%</span><span class="token number">60</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//除去整分钟之后剩余的时间</span>    <span class="token comment" spellcheck="true">//返回字符串</span>    <span class="token keyword">return</span> <span class="token variable">$day</span><span class="token punctuation">.</span><span class="token string">'天'</span><span class="token punctuation">.</span><span class="token variable">$hour</span><span class="token punctuation">.</span><span class="token string">'小时'</span><span class="token punctuation">.</span><span class="token variable">$minute</span><span class="token punctuation">.</span><span class="token string">'分'</span><span class="token punctuation">.</span><span class="token variable">$second</span><span class="token punctuation">.</span><span class="token string">'秒'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="手动计算分页"><a href="#手动计算分页" class="headerlink" title="手动计算分页"></a>手动计算分页</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$aa</span> <span class="token operator">=</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$aa</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$ly</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token variable">$aa</span><span class="token punctuation">;</span>        <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jsr_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token variable">$ly</span><span class="token punctuation">,</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$list</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jsr_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'per_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$aa</span><span class="token punctuation">;</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'current_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'查询成功'</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP实现二维数组去重"><a href="#PHP实现二维数组去重" class="headerlink" title="PHP实现二维数组去重"></a>PHP实现二维数组去重</h1><h2 id="一维数组去重，PHP内置了去重函数。"><a href="#一维数组去重，PHP内置了去重函数。" class="headerlink" title="一维数组去重，PHP内置了去重函数。"></a>一维数组去重，PHP内置了去重函数。</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二维数组去重"><a href="#二维数组去重" class="headerlink" title="二维数组去重"></a>二维数组去重</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token number">0</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">'sp_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$sp_list_value</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'sp_id'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$sp_list_value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$sp_list_value</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP上传视频"><a href="#PHP上传视频" class="headerlink" title="PHP上传视频"></a>PHP上传视频</h1><blockquote><p>上传视频可以使用之前的上传多图片的方法，还可以同时上传多个视频</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** *视频上传 * @param $files * @param string $path * @param array $imagesExt * @return string */</span><span class="token keyword">function</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">,</span> <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">"./upload/video"</span><span class="token punctuation">,</span><span class="token variable">$imagesExt</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mp4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 判断错误号</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">00</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断文件类型</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token variable">$imagesExt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//非法文件类型</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 判断是否存在上传到的目录</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 生成唯一的文件名</span>        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token function">microtime</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$ext</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将文件名拼接到指定的目录下</span>        <span class="token variable">$destName</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token variable">$fileName</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 进行文件移动</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$destName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">1001</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件上传失败</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$destName</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//上传成功，返回上传路径</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 根据错误号返回提示信息</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2001</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2002</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件只有部分被上传</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2003</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//没有文件被上传</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">6</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2004</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//找不到临时文件夹</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">7</span><span class="token punctuation">:</span>                <span class="token keyword">echo</span> <span class="token number">2005</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件写入错误</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">video_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$video</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token variable">$video</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP时间字段查询方法"><a href="#PHP时间字段查询方法" class="headerlink" title="PHP时间字段查询方法"></a>PHP时间字段查询方法</h1><blockquote><p>一般用做查询 开始时间和结束时间</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 时间字段查询方法 * @param $stime 开始时间 * @param $etime 结束时间 * @return array 获得可放入where中的数组 */</span><span class="token keyword">function</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">,</span> <span class="token variable">$etime</span><span class="token punctuation">,</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$stime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'egt'</span><span class="token punctuation">,</span> <span class="token variable">$stime</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$etime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'elt'</span><span class="token punctuation">,</span> <span class="token variable">$etime</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$stime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$stime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$etime</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$etime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'between'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$stime</span><span class="token punctuation">,</span> <span class="token variable">$etime</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP-递归树方法"><a href="#PHP-递归树方法" class="headerlink" title="PHP 递归树方法"></a>PHP 递归树方法</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 递归树 * @param $data * @param $pId * @return array */</span><span class="token keyword">function</span> <span class="token function">getTree</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$pId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$tree</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$pId</span> <span class="token punctuation">.</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//父亲找到儿子</span>            <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'children'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getTree</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'children'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'children'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$tree</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$tree</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP-实现历史变更记录功能"><a href="#PHP-实现历史变更记录功能" class="headerlink" title="PHP 实现历史变更记录功能"></a>PHP 实现历史变更记录功能</h1><p>效果图:<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417133232.png" alt></p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417133300.png" alt></p><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//历史记录,查询要更新的数据</span>    <span class="token variable">$coo</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_business_registration'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'cname'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'tuserid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token string">'create_by'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'euserid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'addtime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$coo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token string">'companyid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin_user.company_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//存储到变更记录表</span>    <span class="token variable">$tnid</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_business_history'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertGetId</span><span class="token punctuation">(</span><span class="token variable">$hh</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//key字段  name字段名称  type（是否关联其他表 1:是  2：否） function关联表示调用该方法获取值</span>        <span class="token variable">$jian</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'ctype'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'单位类型'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getOfficeType'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'reg_authority'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'登记机关'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'legal_person'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'法人代表'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'phone'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'联系电话'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'reg_capital'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'注册资本'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'currency'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'注册资本'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getMoneyType'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'credit'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'统一社会信用代码'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'red_address'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'注册地址'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'place'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'营业场所'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'scale'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营规模'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getModel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'range'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营范围'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'num'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'企业人数'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'state'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营状态'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'getJyState'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'style'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营方式'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'stime'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营期限开始'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'etime'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'经营期限结束'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'note'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'备注'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'function'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//$coo = 原始数据    $param = 要更新的数据  $tnid = 变更记录表id  qy_business_history = 表名(把表 insertChangeInfo 存到历史信息详情表里)</span>        <span class="token function">insertChangeInfo</span><span class="token punctuation">(</span><span class="token variable">$jian</span><span class="token punctuation">,</span><span class="token variable">$coo</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">,</span><span class="token variable">$tnid</span><span class="token punctuation">,</span><span class="token string">'qy_business_history'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//更新表数据</span>        <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_business_registration'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>insertChangeInfo 方法</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 添加记录 */</span><span class="token keyword">function</span> <span class="token function">insertChangeInfo</span><span class="token punctuation">(</span><span class="token variable">$jian</span><span class="token punctuation">,</span><span class="token variable">$coo</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">,</span><span class="token variable">$tnid</span><span class="token punctuation">,</span><span class="token variable">$tabelname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$jian</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//历史信息表明</span>            <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'table_name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$tabelname</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//历史信息表id</span>            <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'tnid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$tnid</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//变更的模块</span>            <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con1'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con2'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//变更前</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con1'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$coo</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//变更后</span>                <span class="token variable">$iin</span><span class="token punctuation">[</span><span class="token string">'con2'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'qy_change_info'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$iin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>function方法里面getOfficeType</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/** * 获取单位类型 */</span><span class="token keyword">function</span> <span class="token function">getOfficeType</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'法人单位'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'非法人单位'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$name</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="生成UUID"><a href="#生成UUID" class="headerlink" title="生成UUID"></a>生成UUID</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token variable">$namespace</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token variable">$guid</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$uid</span> <span class="token operator">=</span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$namespace</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'LOCAL_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'LOCAL_PORT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_PORT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$hash</span> <span class="token operator">=</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token string">'ripemd128'</span><span class="token punctuation">,</span> <span class="token variable">$uid</span> <span class="token punctuation">.</span> <span class="token variable">$guid</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$guid</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>        <span class="token string">''</span> <span class="token punctuation">.</span>        <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$guid</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PHP计算两个日期相隔多少年-多少月-多少日的函数"><a href="#PHP计算两个日期相隔多少年-多少月-多少日的函数" class="headerlink" title="PHP计算两个日期相隔多少年,多少月,多少日的函数"></a>PHP计算两个日期相隔多少年,多少月,多少日的函数</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">diffDate</span><span class="token punctuation">(</span><span class="token variable">$date1</span><span class="token punctuation">,</span><span class="token variable">$date2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$date1</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$date2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$tmp</span><span class="token operator">=</span><span class="token variable">$date2</span><span class="token punctuation">;</span>        <span class="token variable">$date2</span><span class="token operator">=</span><span class="token variable">$date1</span><span class="token punctuation">;</span>        <span class="token variable">$date1</span><span class="token operator">=</span><span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$Y1</span><span class="token punctuation">,</span><span class="token variable">$m1</span><span class="token punctuation">,</span><span class="token variable">$d1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token variable">$date1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$Y2</span><span class="token punctuation">,</span><span class="token variable">$m2</span><span class="token punctuation">,</span><span class="token variable">$d2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token variable">$date2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$Y</span><span class="token operator">=</span><span class="token variable">$Y2</span><span class="token operator">-</span><span class="token variable">$Y1</span><span class="token punctuation">;</span>    <span class="token variable">$m</span><span class="token operator">=</span><span class="token variable">$m2</span><span class="token operator">-</span><span class="token variable">$m1</span><span class="token punctuation">;</span>    <span class="token variable">$d</span><span class="token operator">=</span><span class="token variable">$d2</span><span class="token operator">-</span><span class="token variable">$d1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$d</span><span class="token operator">+</span><span class="token operator">=</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"-1 month $date2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$m</span><span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$m</span><span class="token operator">+</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>        <span class="token variable">$y</span><span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'year'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$Y</span><span class="token punctuation">,</span><span class="token string">'month'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token string">'day'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用方法:</p><blockquote><p>diffDate(date(‘Y-m-d’,$start_time),date(‘Y-m-d’,$end_time));</p></blockquote><h1 id="PHP项目功能案例-根据日、月、季度，获取相关的数据信息"><a href="#PHP项目功能案例-根据日、月、季度，获取相关的数据信息" class="headerlink" title="PHP项目功能案例(根据日、月、季度，获取相关的数据信息)"></a>PHP项目功能案例(根据日、月、季度，获取相关的数据信息)</h1><p>根据日、月、季度，获取相关的数据信息。<br>如果选择的是日,展示从开始日到结束日的每天的数据。<br>如果是月，且开始和结束月是两个月，汇总这两个月的数据，展示两条。<br>如果是季度，按照选择开始和结束月份自动计算季度。几个季度汇总几个季度的数据。</p><blockquote><p>写这个案例的原因是，当时对这块改动超级大，印象极为深厚。</p></blockquote><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">6</span> <span class="token operator">||</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'user_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'ssz'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adminUser</span><span class="token punctuation">[</span><span class="token string">'zhen_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$start_time</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$end_time</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'end_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//开始时间大于结束时间，开始时间变更今天日期</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$start_time</span> <span class="token operator">></span> <span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$start_time</span><span class="token operator">=</span><span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'日'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$st</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ed</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$st</span> <span class="token operator">!=</span> <span class="token variable">$ed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token variable">$ed</span><span class="token operator">-</span><span class="token variable">$st</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'月'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$st</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ed</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$st</span> <span class="token operator">==</span> <span class="token variable">$ed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$as</span> <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token variable">$ed</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token variable">$st</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'季度'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$st</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ed</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$st</span> <span class="token operator">&lt;</span> <span class="token variable">$ed</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$st</span> <span class="token operator">!=</span> <span class="token variable">$ed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$bs</span> <span class="token operator">=</span> <span class="token variable">$ed</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token variable">$st</span><span class="token punctuation">;</span>                    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$bs</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token variable">$as</span> <span class="token operator">++</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'日'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$as</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$start_time</span> <span class="token operator">=</span> <span class="token variable">$start_time</span> <span class="token operator">+</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">;</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'月'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$as</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$as</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//先获取第二月的开始时间</span>                    <span class="token variable">$ii</span> <span class="token operator">=</span> <span class="token variable">$i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-1 00:00:00'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"+"</span> <span class="token punctuation">.</span> <span class="token variable">$ii</span> <span class="token punctuation">.</span> <span class="token string">" month"</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$eed</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"$start_time1 +1 month -1 second"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$eed</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d 23:59:59'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token variable">$eed</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time1</span><span class="token punctuation">,</span><span class="token variable">$end_time1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$start_time1</span><span class="token punctuation">.</span><span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token variable">$end_time1</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'time_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'季度'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$as</span> <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$season</span> <span class="token operator">=</span> <span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$kaishi</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$season</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$jieshu</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token variable">$season</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token function">mktime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$season</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"Y"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$kaishi</span><span class="token punctuation">,</span><span class="token variable">$jieshu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$kaishi</span> <span class="token punctuation">.</span> <span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token variable">$jieshu</span><span class="token punctuation">;</span>                <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token variable">$as</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$ii</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$start_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-1 00:00:00'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"+"</span> <span class="token punctuation">.</span> <span class="token variable">$ii</span> <span class="token punctuation">.</span> <span class="token string">" month"</span><span class="token punctuation">,</span><span class="token variable">$start_time</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$eed</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string">"$start_time1 +3 month -1 second"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$eed</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'Y-m-d 23:59:59'</span><span class="token punctuation">,</span><span class="token variable">$end_time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token variable">$end_time1</span> <span class="token operator">=</span> <span class="token variable">$eed</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token string">'create_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SearchTime</span><span class="token punctuation">(</span><span class="token variable">$start_time1</span><span class="token punctuation">,</span><span class="token variable">$end_time1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$start_time1</span><span class="token punctuation">.</span><span class="token string">'-'</span> <span class="token punctuation">.</span> <span class="token variable">$end_time1</span><span class="token punctuation">;</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'anjian'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//立案数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//派遣数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//处置数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">75</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//核查数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//结案数</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span> <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$count</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'mm'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="/download/Reseau.php" ">点击下载</a></p><h1 id="setReturn-返回函数封装"><a href="#setReturn-返回函数封装" class="headerlink" title="setReturn 返回函数封装"></a>setReturn 返回函数封装</h1><p>方便使用，直接复制粘贴</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">setReturn</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">,</span><span class="token variable">$message</span><span class="token operator">=</span><span class="token string">"查询成功"</span><span class="token punctuation">,</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$message</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$return</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="http://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="http://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="汇总" scheme="http://chiwai.tang99.club/tags/%E6%B1%87%E6%80%BB/"/>
    
  </entry>
  
  <entry>
    <title>thinkphp5+workerman的定时器实现定时任务</title>
    <link href="http://chiwai.tang99.club/posts/2129457668.html"/>
    <id>http://chiwai.tang99.club/posts/2129457668.html</id>
    <published>2020-01-13T12:07:19.000Z</published>
    <updated>2020-04-17T05:27:38.886Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>1.首先需要安装，或者下载完整版tp框架里面会自带。(tp5教程<a href="https://www.kancloud.cn/manual/thinkphp5/235128" target="_blank" rel="noopener">https://www.kancloud.cn/manual/thinkphp5/235128</a>)</p><pre class="line-numbers language-text"><code class="language-text">composer require topthink/think-worker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.在项目根目录(不是public目录)创建服务启动文件 server.php<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417132312.png" alt></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'APP_PATH'</span><span class="token punctuation">,</span> <span class="token constant">__DIR__</span> <span class="token punctuation">.</span> <span class="token string">'/application/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"BIND_MODULE"</span><span class="token punctuation">,</span> <span class="token string">"server/Worker"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 加载框架引导文件</span><span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span class="token punctuation">.</span> <span class="token string">'/thinkphp/start.php'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.在application里创建server模块，并在server里创建控制器 Worker.php<br><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417132352.png" alt></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>server<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>worker<span class="token punctuation">\</span>Server</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller<span class="token punctuation">\</span>Index</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">Server</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$processes</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onWorkerStart</span><span class="token punctuation">(</span><span class="token variable">$work</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$handle</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$handle</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add_timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.创建Index.php控制器.定义一个每秒钟执行一次的定时器，在定时器里增加条件判断，如果当前时间等于要执行的时间时，就执行此任务</p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417132416.png" alt></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Workerman<span class="token punctuation">\</span>Lib<span class="token punctuation">\</span>Timer</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">add_timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Timer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//每天0点执行任务</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">86400</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"Y-m-d H:i:s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//每天8点执行任务</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">86400</span> <span class="token operator">===</span> <span class="token number">28800</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"Y-m-d H:i:s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5.启动服务 <b>php server.php start -d</b></p><p><img src="/images/447.gif" data-original="http://chiwaifigurebed.tang99.club/myblog_picgo/20200417132724.png" alt></p><blockquote><p>workerman定时器方法不止这些，具体可以看看文档。<br><a href="http://doc3.workerman.net/315179" target="_blank" rel="noopener">http://doc3.workerman.net/315179</a></p></blockquote><p>参考资料:<br><a href="https://www.cnblogs.com/goufugui/p/9391035.html" target="_blank" rel="noopener">https://www.cnblogs.com/goufugui/p/9391035.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="http://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="Tp5.0" scheme="http://chiwai.tang99.club/tags/Tp5-0/"/>
    
      <category term="Workerman定时器" scheme="http://chiwai.tang99.club/tags/Workerman%E5%AE%9A%E6%97%B6%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Laravel 出现 No application encryption key has been specified.</title>
    <link href="http://chiwai.tang99.club/posts/3359811951.html"/>
    <id>http://chiwai.tang99.club/posts/3359811951.html</id>
    <published>2019-12-20T10:02:49.000Z</published>
    <updated>2020-04-07T07:11:39.525Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&nbsp;&nbsp;&nbsp;&nbsp;Linux服务器部署Laravel项目，从git克隆项目时会缺少.env文件，导致出现出现 <span style="color:red;">No application encryption key has been specified.</span></p><p><b>1.</b>如果没有.env文件，执行以下命令</p><pre class="line-numbers language-ini"><code class="language-ini">cp -a .env.example .env<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b>2.</b>如果有,执行以下</p><pre class="line-numbers language-ini"><code class="language-ini">php artisan key:generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><b>3.</b>将密码复制到config/app.php 中的key里面</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="http://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="Laravel" scheme="http://chiwai.tang99.club/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>php将导出文件生成压缩包并下载</title>
    <link href="http://chiwai.tang99.club/posts/3149816056.html"/>
    <id>http://chiwai.tang99.club/posts/3149816056.html</id>
    <published>2019-12-09T13:14:31.000Z</published>
    <updated>2020-03-14T13:31:10.714Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>#php实现将导出文件生成压缩包并下载</p><blockquote><p>这里我用到了模板，首先获取其数据，加载模板，生成excel文件，获取其路径，将生成的excel文件生成压缩包。</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//血糖数据</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ExportXuetang</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//患者id</span>        <span class="token variable">$parent_id</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$table_xuetang</span> <span class="token operator">=</span> FixedTableTable<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'parent_id'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$parent_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'btn_kkid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'json_info'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table_xuetang</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'json_info'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//数据量过大，这里我只取简单的几条数据，做记录</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'L_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'L_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'K_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'K_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'ZH_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'ZH_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WUQ_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WUQ_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WUH_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WUH_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$fixed_arr</span><span class="token punctuation">[</span><span class="token string">'WAQ_1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table_xuetang</span><span class="token punctuation">[</span><span class="token string">'WAQ_1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//引入PHPExcel导出类</span>        <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>PHPExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$temPath</span> <span class="token operator">=</span> <span class="token string">"./template/xuetang.xlsx"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//模板路径</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'模板不存在!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//加载模板</span>        <span class="token variable">$excel</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createReaderForFile</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$phpexcel</span> <span class="token operator">=</span> <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$temPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$fixed_arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//横向循环，我这里的数据是横向排列，动态横向输出</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$fixed_arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//当excel列超过26列大于Z时，将列的数字序号转成字母使用</span>            <span class="token variable">$pCoordinate</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_Cell</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">stringFromColumnIndex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'8'</span><span class="token punctuation">;</span>            <span class="token variable">$pValue</span>      <span class="token operator">=</span> <span class="token variable">$hh</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$phpexcel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCellValue</span><span class="token punctuation">(</span><span class="token variable">$pCoordinate</span><span class="token punctuation">,</span> <span class="token variable">$pValue</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//清除缓冲区，避免乱码</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string">"xuetang.xlsx"</span><span class="token punctuation">;</span>        <span class="token variable">$file_path</span> <span class="token operator">=</span> <span class="token string">"./upload/template/"</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span> <span class="token operator">=</span> \<span class="token package">PHPExcel_IOFactory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createWriter</span><span class="token punctuation">(</span><span class="token variable">$phpexcel</span><span class="token punctuation">,</span> <span class="token string">'Excel5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$objWriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//将写好的模板保存到指定目录</span>        <span class="token comment" spellcheck="true">//生成excel路径</span>        <span class="token variable">$exct</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string">'title'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'血糖数据.xlsx'</span><span class="token punctuation">,</span>            <span class="token string">'url'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$file_path</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将路径返回</span>        <span class="token keyword">return</span> <span class="token variable">$exct</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>上面的方法是我要导出一部分的数据，实际上有很多不同的数据要合并，有多个方法，这里只取其中一个方法</p></blockquote><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">//下载excel并压缩包打包</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$zip_xuetang</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">ExportXuetang</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将生成的excel生成压缩包</span>        <span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>ZipArchive</span><span class="token punctuation">;</span>        <span class="token variable">$zip_name</span> <span class="token operator">=</span> <span class="token string">'./upload/zip/'</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.zip'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//压缩包名称</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">,</span>\<span class="token package">ZipArchive</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//循环生成excel的路径</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$zip_arr</span> <span class="token keyword">as</span> <span class="token variable">$k1</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token variable">$tpfile</span><span class="token operator">=</span><span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                 <span class="token variable">$new_filename</span> <span class="token operator">=</span> <span class="token variable">$v1</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFile</span><span class="token punctuation">(</span><span class="token variable">$tpfile</span><span class="token punctuation">,</span><span class="token variable">$new_filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">/*$zip->close();        $kkp='/static/upload/zip/'.time().'.zip';;        $file = $_SERVER['HTTP_HOST'].$kkp;                header('Location:http://'.$file);*/</span>        <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$kkp</span><span class="token operator">=</span><span class="token string">'./upload/zip/'</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.zip'</span><span class="token punctuation">;</span>        <span class="token function">ob_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-type: application/vnd.ms-word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition:attachment;filename="</span><span class="token punctuation">.</span><span class="token variable">$kkp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Cache-Control: max-age=0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$zip_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="后端" scheme="http://chiwai.tang99.club/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="http://chiwai.tang99.club/tags/PHP/"/>
    
      <category term="Excel" scheme="http://chiwai.tang99.club/tags/Excel/"/>
    
      <category term="压缩包" scheme="http://chiwai.tang99.club/tags/%E5%8E%8B%E7%BC%A9%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Win10 Nginx+PHP+MySQL 开机自启</title>
    <link href="http://chiwai.tang99.club/posts/2324507981.html"/>
    <id>http://chiwai.tang99.club/posts/2324507981.html</id>
    <published>2019-12-08T14:57:08.000Z</published>
    <updated>2020-04-03T13:11:45.691Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Win10-Nginx-PHP-MySQL-开机自启"><a href="#Win10-Nginx-PHP-MySQL-开机自启" class="headerlink" title="Win10 Nginx+PHP+MySQL 开机自启"></a>Win10 Nginx+PHP+MySQL 开机自启</h3><h5 id="1-MySQL"><a href="#1-MySQL" class="headerlink" title="1.MySQL"></a>1.MySQL</h5><pre><code>如: 用管理员运行cmd到MySql目录 C:\WNPM\MySQL\bin     执行 mysqld install 生成windows服务  </code></pre><h5 id="2-Nginx"><a href="#2-Nginx" class="headerlink" title="2.Nginx"></a>2.Nginx</h5><pre><code>将 winsw-1.18-bin.exe 复制到Nginx根目录 重命名为 nginx-service.exe并创建nginx-service.exe.config、nginx-service.xml两个文件内容如下：nginx-service.exe.config    &lt;configuration&gt;        &lt;startup&gt;            &lt;supportedRuntime version=&quot;v2.0.50727&quot; /&gt;            &lt;supportedRuntime version=&quot;v4.0&quot; /&gt;        &lt;/startup&gt;        &lt;runtime&gt;            &lt;generatePublisherEvidence enabled=&quot;false&quot;/&gt;        &lt;/runtime&gt;    &lt;/configuration&gt;    nginx-service.xml    &lt;service&gt;        &lt;id&gt;nginx&lt;/id&gt;        &lt;name&gt;Nginx Service&lt;/name&gt;        &lt;description&gt;High Performance Nginx Service&lt;/description&gt;        &lt;logpath&gt;C:\WNPM\nginx\logs&lt;/logpath&gt;        &lt;log mode=&quot;roll-by-size&quot;&gt;            &lt;sizeThreshold&gt;10240&lt;/sizeThreshold&gt;            &lt;keepFiles&gt;8&lt;/keepFiles&gt;        &lt;/log&gt;        &lt;executable&gt;C:\WNPM\nginx\nginx.exe&lt;/executable&gt;        &lt;startarguments&gt;C:\WNPM\nginx\nginx&lt;/startarguments&gt;        &lt;stopexecutable&gt;C:\WNPM\nginx\nginx.exe&lt;/stopexecutable&gt;        &lt;stoparguments&gt;-p C:\WNPM\nginx -s stop&lt;/stoparguments&gt;    &lt;/service&gt;执行 nginx-service.exe install 生成windows服务     </code></pre><h5 id="3-PHP"><a href="#3-PHP" class="headerlink" title="3.PHP"></a>3.PHP</h5><pre><code>将 WinSW.NET4.exe、xxfpm.exe、pthreadGC2.dll复制到PHP根目录 WinSW.NET4.exe 重命名为 php-cgi-servic.exe(xxfpm，用来开启 php-cgi 多进程)并创建php-cgi-service.xml文件php-cgi-service.xml&lt;service&gt;    &lt;id&gt;php-cgi&lt;/id&gt;    &lt;name&gt;php-cgi&lt;/name&gt;    &lt;description&gt;PHP-CGI.&lt;/description&gt;    &lt;executable&gt;xxfpm.exe&lt;/executable&gt;    &lt;!-- 启动参数 --&gt;    &lt;startargument&gt;&quot;C:\WNPM\php-7.2.1\php-cgi.exe -c C:\WNPM\php-            7.2.1\php.ini&quot;&lt;/startargument&gt;    &lt;startargument&gt;-n&lt;/startargument&gt;    &lt;!-- 启动进程数量，可修改，建议大于 1 --&gt;    &lt;startargument&gt;3&lt;/startargument&gt;    &lt;startargument&gt;-i&lt;/startargument&gt;    &lt;!-- 监听IP，默认一般都用 127.0.0.1 --&gt;    &lt;startargument&gt;127.0.0.1&lt;/startargument&gt;    &lt;startargument&gt;-p&lt;/startargument&gt;    &lt;!-- 监听端口，默认一般都用 9000 --&gt;    &lt;startargument&gt;9000&lt;/startargument&gt;    &lt;!-- 停止参数 --&gt;    &lt;stopexecutable&gt;taskkill&lt;/stopexecutable&gt;    &lt;stopargument&gt;/F&lt;/stopargument&gt;    &lt;stopargument&gt;/IM&lt;/stopargument&gt;    &lt;stopargument&gt;xxfpm.exe&lt;/stopargument&gt;    &lt;logpath&gt;logs&lt;/logpath&gt;&lt;/service&gt;php-cgi-service.exe install，生成windows服务</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="配置" scheme="http://chiwai.tang99.club/categories/%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="环境搭建" scheme="http://chiwai.tang99.club/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
</feed>
